<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>pcilib: bar.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">pcilib
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0b5c8f32f3013e7b96dc99509907414c.html">pcilib</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">bar.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p><a href="bar_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpcilib__bar__info__t.html">pcilib_bar_info_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ada12ff3f649350f51cd027faa4dc84e1"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pcilib_8h.html#ad5e21847906003557a26779731243927">pcilib_bar_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bar_8h.html#ada12ff3f649350f51cd027faa4dc84e1">pcilib_detect_bar</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, uintptr_t addr, size_t size)</td></tr>
<tr class="memdesc:ada12ff3f649350f51cd027faa4dc84e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Detects in which PCI BAR the specified buffer is residing.  <a href="bar_8h.html#ada12ff3f649350f51cd027faa4dc84e1">More...</a><br /></td></tr>
<tr class="separator:ada12ff3f649350f51cd027faa4dc84e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a803f5e0c0ea90b723f268916c5410b23"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bar_8h.html#a803f5e0c0ea90b723f268916c5410b23">pcilib_map_bar</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="pcilib_8h.html#ad5e21847906003557a26779731243927">pcilib_bar_t</a> bar)</td></tr>
<tr class="memdesc:a803f5e0c0ea90b723f268916c5410b23"><td class="mdescLeft">&#160;</td><td class="mdescRight">Maps the specified bar to the address space of the process.  <a href="bar_8h.html#a803f5e0c0ea90b723f268916c5410b23">More...</a><br /></td></tr>
<tr class="separator:a803f5e0c0ea90b723f268916c5410b23"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4ce1cd3017c15f543dc5b6bce5d5081f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bar_8h.html#a4ce1cd3017c15f543dc5b6bce5d5081f">pcilib_unmap_bar</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="pcilib_8h.html#ad5e21847906003557a26779731243927">pcilib_bar_t</a> bar, void *data)</td></tr>
<tr class="memdesc:a4ce1cd3017c15f543dc5b6bce5d5081f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unmaps the specified bar from the address space of the process.  <a href="bar_8h.html#a4ce1cd3017c15f543dc5b6bce5d5081f">More...</a><br /></td></tr>
<tr class="separator:a4ce1cd3017c15f543dc5b6bce5d5081f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adc26724ec81b49c188ef1945b9e1c36f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bar_8h.html#adc26724ec81b49c188ef1945b9e1c36f">pcilib_detect_address</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="pcilib_8h.html#ad5e21847906003557a26779731243927">pcilib_bar_t</a> *bar, uintptr_t *addr, size_t size)</td></tr>
<tr class="memdesc:adc26724ec81b49c188ef1945b9e1c36f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Detects the BAR and mapping offset of the specified PCI buffer.  <a href="bar_8h.html#adc26724ec81b49c188ef1945b9e1c36f">More...</a><br /></td></tr>
<tr class="separator:adc26724ec81b49c188ef1945b9e1c36f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8988c9237b29e2f7d34e5ca5d61d6aac"><td class="memItemLeft" align="right" valign="top">char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bar_8h.html#a8988c9237b29e2f7d34e5ca5d61d6aac">pcilib_resolve_data_space</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, uintptr_t addr, size_t *size)</td></tr>
<tr class="memdesc:a8988c9237b29e2f7d34e5ca5d61d6aac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resolves the virtual address and the size of PCI BAR space used for data exchange.  <a href="bar_8h.html#a8988c9237b29e2f7d34e5ca5d61d6aac">More...</a><br /></td></tr>
<tr class="separator:a8988c9237b29e2f7d34e5ca5d61d6aac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab8bd139474c7094d3fffe92360ee720e"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="structpcilib__bar__info__t.html">pcilib_bar_info_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bar_8h.html#ab8bd139474c7094d3fffe92360ee720e">pcilib_get_bar_info</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="pcilib_8h.html#ad5e21847906003557a26779731243927">pcilib_bar_t</a> bar)</td></tr>
<tr class="memdesc:ab8bd139474c7094d3fffe92360ee720e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return information about the specified BAR or NULL if BAR is not present in hardware.  <a href="bar_8h.html#ab8bd139474c7094d3fffe92360ee720e">More...</a><br /></td></tr>
<tr class="separator:ab8bd139474c7094d3fffe92360ee720e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3f287796a4fd6dee915ea7a412da4add"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="structpcilib__bar__info__t.html">pcilib_bar_info_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="bar_8h.html#a3f287796a4fd6dee915ea7a412da4add">pcilib_get_bar_list</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx)</td></tr>
<tr class="memdesc:a3f287796a4fd6dee915ea7a412da4add"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return a list of BAR memory regions available in the hardware.  <a href="bar_8h.html#a3f287796a4fd6dee915ea7a412da4add">More...</a><br /></td></tr>
<tr class="separator:a3f287796a4fd6dee915ea7a412da4add"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a id="adc26724ec81b49c188ef1945b9e1c36f" name="adc26724ec81b49c188ef1945b9e1c36f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adc26724ec81b49c188ef1945b9e1c36f">&#9670;&#160;</a></span>pcilib_detect_address()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pcilib_detect_address </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#ad5e21847906003557a26779731243927">pcilib_bar_t</a> *&#160;</td>
          <td class="paramname"><em>bar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uintptr_t *&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Detects the BAR and mapping offset of the specified PCI buffer. </p>
<p >The complete specified buffer of <em>size</em> bytes should fit into the BAR. Otherwise, an error will be returned. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">bar</td><td>- the function will check if the buffer belongs to the specified BAR unless bar is PCILIB_BAR_DETECT. It will be set to the actually detected BAR in the last case. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">addr</td><td>- specifies the address to detect. The address may be specified as absolute physical address or offset in the BAR. On success, the addr will contain offset which should be added to the address returned by <a class="el" href="bar_8h.html#a803f5e0c0ea90b723f268916c5410b23" title="Maps the specified bar to the address space of the process.">pcilib_map_bar()</a> to get position of BAR mapping in virtual address space. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>- the size of the buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- error code or 0 in case of success </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   50</span>                                                                                          {</div>
<div class="line"><span class="lineno">   51</span>    <span class="keyword">const</span> pcilib_board_info_t *board_info = <a class="code hl_function" href="pci_8c.html#a74c205347b831faad18ebe3322d715a7">pcilib_get_board_info</a>(ctx);</div>
<div class="line"><span class="lineno">   52</span>    <span class="keywordflow">if</span> (!board_info) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60cad21a896d5d5aaee0682c410b9bed283c">PCILIB_ERROR_NOTFOUND</a>;</div>
<div class="line"><span class="lineno">   53</span>    </div>
<div class="line"><span class="lineno">   54</span>    <span class="keywordflow">if</span> (*bar == <a class="code hl_define" href="pcilib_8h.html#a83586e1dae21eb4c18e1737e33acee79">PCILIB_BAR_DETECT</a>) {</div>
<div class="line"><span class="lineno">   55</span>        *bar = <a class="code hl_function" href="bar_8c.html#ada12ff3f649350f51cd027faa4dc84e1">pcilib_detect_bar</a>(ctx, *addr, size);</div>
<div class="line"><span class="lineno">   56</span>        <span class="keywordflow">if</span> (*bar == <a class="code hl_define" href="pcilib_8h.html#a41d09ac93792dafd7bb449f0c009d0b6">PCILIB_BAR_INVALID</a>) {</div>
<div class="line"><span class="lineno">   57</span>            <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;The requested data block at address 0x%x with size %zu does not belongs to any available memory bar&quot;</span>, *addr, size);</div>
<div class="line"><span class="lineno">   58</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60cad21a896d5d5aaee0682c410b9bed283c">PCILIB_ERROR_NOTFOUND</a>;</div>
<div class="line"><span class="lineno">   59</span>        }</div>
<div class="line"><span class="lineno">   60</span>        <span class="keywordflow">if</span> (*addr &lt; board_info-&gt;bar_start[*bar]) </div>
<div class="line"><span class="lineno">   61</span>            *addr += board_info-&gt;bar_start[*bar];</div>
<div class="line"><span class="lineno">   62</span>    } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   63</span>        <span class="keywordflow">if</span> ((*addr &lt; board_info-&gt;bar_start[*bar])||((board_info-&gt;bar_start[*bar] + board_info-&gt;bar_length[*bar]) &lt; (((uintptr_t)*addr) + size))) {</div>
<div class="line"><span class="lineno">   64</span>            <span class="keywordflow">if</span> ((board_info-&gt;bar_length[*bar]) &gt;= (((uintptr_t)*addr) + size)) {</div>
<div class="line"><span class="lineno">   65</span>                *addr += board_info-&gt;bar_start[*bar];</div>
<div class="line"><span class="lineno">   66</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">   67</span>                <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;The requested data block at address 0x%x with size %zu does not belong the specified memory bar (Bar %i: starting at 0x%x with size 0x%x)&quot;</span>, *addr, size, *bar, board_info-&gt;bar_start[*bar], board_info-&gt;bar_length[*bar]);</div>
<div class="line"><span class="lineno">   68</span>                <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60cad21a896d5d5aaee0682c410b9bed283c">PCILIB_ERROR_NOTFOUND</a>;</div>
<div class="line"><span class="lineno">   69</span>            }</div>
<div class="line"><span class="lineno">   70</span>        }</div>
<div class="line"><span class="lineno">   71</span>    }</div>
<div class="line"><span class="lineno">   72</span> </div>
<div class="line"><span class="lineno">   73</span>    *addr -= board_info-&gt;bar_start[*bar];</div>
<div class="line"><span class="lineno">   74</span>    *addr += board_info-&gt;bar_start[*bar] &amp; ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a3b8d32830b2e29cb8dadcd73bb5fd063">page_mask</a>;</div>
<div class="line"><span class="lineno">   75</span> </div>
<div class="line"><span class="lineno">   76</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">   77</span>}</div>
<div class="ttc" id="abar_8c_html_ada12ff3f649350f51cd027faa4dc84e1"><div class="ttname"><a href="bar_8c.html#ada12ff3f649350f51cd027faa4dc84e1">pcilib_detect_bar</a></div><div class="ttdeci">pcilib_bar_t pcilib_detect_bar(pcilib_t *ctx, uintptr_t addr, size_t size)</div><div class="ttdoc">Detects in which PCI BAR the specified buffer is residing.</div><div class="ttdef"><b>Definition:</b> bar.c:25</div></div>
<div class="ttc" id="aerror_8h_html_a0c59f7091fd2446121868635aca9e60cad21a896d5d5aaee0682c410b9bed283c"><div class="ttname"><a href="error_8h.html#a0c59f7091fd2446121868635aca9e60cad21a896d5d5aaee0682c410b9bed283c">PCILIB_ERROR_NOTFOUND</a></div><div class="ttdeci">@ PCILIB_ERROR_NOTFOUND</div><div class="ttdef"><b>Definition:</b> error.h:25</div></div>
<div class="ttc" id="aerror_8h_html_a2b06064fecffd095efabb752f7b50021"><div class="ttname"><a href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a></div><div class="ttdeci">#define pcilib_error(...)</div><div class="ttdef"><b>Definition:</b> error.h:68</div></div>
<div class="ttc" id="apci_8c_html_a74c205347b831faad18ebe3322d715a7"><div class="ttname"><a href="pci_8c.html#a74c205347b831faad18ebe3322d715a7">pcilib_get_board_info</a></div><div class="ttdeci">const pcilib_board_info_t * pcilib_get_board_info(pcilib_t *ctx)</div><div class="ttdef"><b>Definition:</b> pci.c:272</div></div>
<div class="ttc" id="apcilib_8h_html_a41d09ac93792dafd7bb449f0c009d0b6"><div class="ttname"><a href="pcilib_8h.html#a41d09ac93792dafd7bb449f0c009d0b6">PCILIB_BAR_INVALID</a></div><div class="ttdeci">#define PCILIB_BAR_INVALID</div><div class="ttdef"><b>Definition:</b> pcilib.h:182</div></div>
<div class="ttc" id="apcilib_8h_html_a83586e1dae21eb4c18e1737e33acee79"><div class="ttname"><a href="pcilib_8h.html#a83586e1dae21eb4c18e1737e33acee79">PCILIB_BAR_DETECT</a></div><div class="ttdeci">#define PCILIB_BAR_DETECT</div><div class="ttdef"><b>Definition:</b> pcilib.h:181</div></div>
<div class="ttc" id="astructpcilib__s_html_a3b8d32830b2e29cb8dadcd73bb5fd063"><div class="ttname"><a href="structpcilib__s.html#a3b8d32830b2e29cb8dadcd73bb5fd063">pcilib_s::page_mask</a></div><div class="ttdeci">uintptr_t page_mask</div><div class="ttdoc">Selects bits which define offset within the page.</div><div class="ttdef"><b>Definition:</b> pci.h:52</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__s.html#a3b8d32830b2e29cb8dadcd73bb5fd063">pcilib_s::page_mask</a>, <a class="el" href="pcilib_8h.html#a83586e1dae21eb4c18e1737e33acee79">PCILIB_BAR_DETECT</a>, <a class="el" href="pcilib_8h.html#a41d09ac93792dafd7bb449f0c009d0b6">PCILIB_BAR_INVALID</a>, <a class="el" href="bar_8c.html#ada12ff3f649350f51cd027faa4dc84e1">pcilib_detect_bar()</a>, <a class="el" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60cad21a896d5d5aaee0682c410b9bed283c">PCILIB_ERROR_NOTFOUND</a>, and <a class="el" href="pci_8c.html#a74c205347b831faad18ebe3322d715a7">pcilib_get_board_info()</a>.</p>

<p class="reference">Referenced by <a class="el" href="bar_8c.html#ab8719d195c10a67241594fce48c5a70e">pcilib_map_register_space()</a>, <a class="el" href="group__public__api__pci.html#gaca36d2bf9de2a981e6103c167ba1e540">pcilib_read()</a>, <a class="el" href="group__public__api__pci.html#ga82bca2b1ae797d97f03b68f95eb9c524">pcilib_read_fifo()</a>, <a class="el" href="group__public__api__pci.html#gaf4ecef1d07b5e71c52b8fbee0a3491fa">pcilib_write()</a>, and <a class="el" href="group__public__api__pci.html#ga938537920eaf8eb55468bf7b5ec7161d">pcilib_write_fifo()</a>.</p>

</div>
</div>
<a id="ada12ff3f649350f51cd027faa4dc84e1" name="ada12ff3f649350f51cd027faa4dc84e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ada12ff3f649350f51cd027faa4dc84e1">&#9670;&#160;</a></span>pcilib_detect_bar()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pcilib_8h.html#ad5e21847906003557a26779731243927">pcilib_bar_t</a> pcilib_detect_bar </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uintptr_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Detects in which PCI BAR the specified buffer is residing. </p>
<p >The complete specified buffer of <em>size</em> bytes should fit into the BAR. Otherwise, an error will be returned. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">addr</td><td>- physical address of the begining of the buffer </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>- the size of the buffer </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- return the BAR (numbered from 0) or PCILIB_BAR_INVALID if buffer does not belong to any BAR. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   25</span>                                                                           {</div>
<div class="line"><span class="lineno">   26</span>    <span class="keywordtype">int</span> n = 0;</div>
<div class="line"><span class="lineno">   27</span>    <a class="code hl_typedef" href="pcilib_8h.html#ad5e21847906003557a26779731243927">pcilib_bar_t</a> i = ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a839db099687ecdb586a31b1de2a73da5">reg_bar</a>;</div>
<div class="line"><span class="lineno">   28</span>        </div>
<div class="line"><span class="lineno">   29</span>    <span class="keyword">const</span> pcilib_board_info_t *board_info = <a class="code hl_function" href="pci_8c.html#a74c205347b831faad18ebe3322d715a7">pcilib_get_board_info</a>(ctx);</div>
<div class="line"><span class="lineno">   30</span>    <span class="keywordflow">if</span> (!board_info) <span class="keywordflow">return</span> <a class="code hl_define" href="pcilib_8h.html#a41d09ac93792dafd7bb449f0c009d0b6">PCILIB_BAR_INVALID</a>;</div>
<div class="line"><span class="lineno">   31</span> </div>
<div class="line"><span class="lineno">   32</span>        <span class="comment">// First checking the default register bar</span></div>
<div class="line"><span class="lineno">   33</span>    <span class="keywordflow">if</span> ((addr &gt;= board_info-&gt;bar_start[i])&amp;&amp;((board_info-&gt;bar_start[i] + board_info-&gt;bar_length[i]) &gt;= (addr + size))) <span class="keywordflow">return</span> i;</div>
<div class="line"><span class="lineno">   34</span> </div>
<div class="line"><span class="lineno">   35</span>        <span class="comment">// Otherwise iterate</span></div>
<div class="line"><span class="lineno">   36</span>    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code hl_define" href="pci_8h.html#afba0cbe7c423100d1d6dc2a1475507f4">PCILIB_MAX_BARS</a>; i++) {</div>
<div class="line"><span class="lineno">   37</span>        <span class="keywordflow">if</span> (board_info-&gt;bar_length[i] &gt; 0) {</div>
<div class="line"><span class="lineno">   38</span>            <span class="keywordflow">if</span> ((addr &gt;= board_info-&gt;bar_start[i])&amp;&amp;((board_info-&gt;bar_start[i] + board_info-&gt;bar_length[i]) &gt;= (addr + size))) <span class="keywordflow">return</span> i;</div>
<div class="line"><span class="lineno">   39</span> </div>
<div class="line"><span class="lineno">   40</span>            <span class="keywordflow">if</span> (n) n = -1;</div>
<div class="line"><span class="lineno">   41</span>            <span class="keywordflow">else</span> n = i + 1;</div>
<div class="line"><span class="lineno">   42</span>        }</div>
<div class="line"><span class="lineno">   43</span>    }</div>
<div class="line"><span class="lineno">   44</span> </div>
<div class="line"><span class="lineno">   45</span>    <span class="keywordflow">if</span> (n &gt; 0) <span class="keywordflow">return</span> n - 1;</div>
<div class="line"><span class="lineno">   46</span> </div>
<div class="line"><span class="lineno">   47</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="pcilib_8h.html#a41d09ac93792dafd7bb449f0c009d0b6">PCILIB_BAR_INVALID</a>;</div>
<div class="line"><span class="lineno">   48</span>}</div>
<div class="ttc" id="apci_8h_html_afba0cbe7c423100d1d6dc2a1475507f4"><div class="ttname"><a href="pci_8h.html#afba0cbe7c423100d1d6dc2a1475507f4">PCILIB_MAX_BARS</a></div><div class="ttdeci">#define PCILIB_MAX_BARS</div><div class="ttdoc">this is defined by PCI specification</div><div class="ttdef"><b>Definition:</b> pci.h:9</div></div>
<div class="ttc" id="apcilib_8h_html_ad5e21847906003557a26779731243927"><div class="ttname"><a href="pcilib_8h.html#ad5e21847906003557a26779731243927">pcilib_bar_t</a></div><div class="ttdeci">uint8_t pcilib_bar_t</div><div class="ttdoc">Type holding the PCI Bar number.</div><div class="ttdef"><b>Definition:</b> pcilib.h:14</div></div>
<div class="ttc" id="astructpcilib__s_html_a839db099687ecdb586a31b1de2a73da5"><div class="ttname"><a href="structpcilib__s.html#a839db099687ecdb586a31b1de2a73da5">pcilib_s::reg_bar</a></div><div class="ttdeci">pcilib_bar_t reg_bar</div><div class="ttdoc">Default BAR to look for registers, other BARs will be looked as well.</div><div class="ttdef"><b>Definition:</b> pci.h:65</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="pcilib_8h.html#a41d09ac93792dafd7bb449f0c009d0b6">PCILIB_BAR_INVALID</a>, <a class="el" href="pci_8c.html#a74c205347b831faad18ebe3322d715a7">pcilib_get_board_info()</a>, <a class="el" href="pci_8h.html#afba0cbe7c423100d1d6dc2a1475507f4">PCILIB_MAX_BARS</a>, and <a class="el" href="structpcilib__s.html#a839db099687ecdb586a31b1de2a73da5">pcilib_s::reg_bar</a>.</p>

<p class="reference">Referenced by <a class="el" href="bar_8c.html#adc26724ec81b49c188ef1945b9e1c36f">pcilib_detect_address()</a>, and <a class="el" href="group__public__api__pci.html#ga5b6d816efc737e4f0fce9304001e771b">pcilib_resolve_bar_address()</a>.</p>

</div>
</div>
<a id="ab8bd139474c7094d3fffe92360ee720e" name="ab8bd139474c7094d3fffe92360ee720e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab8bd139474c7094d3fffe92360ee720e">&#9670;&#160;</a></span>pcilib_get_bar_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="structpcilib__bar__info__t.html">pcilib_bar_info_t</a> * pcilib_get_bar_info </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#ad5e21847906003557a26779731243927">pcilib_bar_t</a>&#160;</td>
          <td class="paramname"><em>bar</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return information about the specified BAR or NULL if BAR is not present in hardware. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bar</td><td>- the PCI BAR number (numbered from 0) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- pointer to structure describing the specified BAR or NULL in case of error </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  313</span>                                                                              {</div>
<div class="line"><span class="lineno">  314</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">  315</span> </div>
<div class="line"><span class="lineno">  316</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structpcilib__bar__info__t.html">pcilib_bar_info_t</a> *info = <a class="code hl_function" href="bar_8c.html#a3f287796a4fd6dee915ea7a412da4add">pcilib_get_bar_list</a>(ctx);</div>
<div class="line"><span class="lineno">  317</span>    <span class="keywordflow">if</span> (!info) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  318</span> </div>
<div class="line"><span class="lineno">  319</span>    <span class="keywordflow">for</span> (i = 0; info[i].<a class="code hl_variable" href="structpcilib__bar__info__t.html#ab8d1abb1ff39fc801a03076be817f112">size</a>; i++) {</div>
<div class="line"><span class="lineno">  320</span>        <span class="keywordflow">if</span> (info[i].bar == bar)</div>
<div class="line"><span class="lineno">  321</span>            <span class="keywordflow">return</span> &amp;info[i];</div>
<div class="line"><span class="lineno">  322</span>    }</div>
<div class="line"><span class="lineno">  323</span> </div>
<div class="line"><span class="lineno">  324</span>    <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  325</span>}</div>
<div class="ttc" id="abar_8c_html_a3f287796a4fd6dee915ea7a412da4add"><div class="ttname"><a href="bar_8c.html#a3f287796a4fd6dee915ea7a412da4add">pcilib_get_bar_list</a></div><div class="ttdeci">const pcilib_bar_info_t * pcilib_get_bar_list(pcilib_t *ctx)</div><div class="ttdoc">Return a list of BAR memory regions available in the hardware.</div><div class="ttdef"><b>Definition:</b> bar.c:293</div></div>
<div class="ttc" id="astructpcilib__bar__info__t_html"><div class="ttname"><a href="structpcilib__bar__info__t.html">pcilib_bar_info_t</a></div><div class="ttdef"><b>Definition:</b> bar.h:5</div></div>
<div class="ttc" id="astructpcilib__bar__info__t_html_ab8d1abb1ff39fc801a03076be817f112"><div class="ttname"><a href="structpcilib__bar__info__t.html#ab8d1abb1ff39fc801a03076be817f112">pcilib_bar_info_t::size</a></div><div class="ttdeci">size_t size</div><div class="ttdef"><b>Definition:</b> bar.h:7</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="bar_8c.html#a3f287796a4fd6dee915ea7a412da4add">pcilib_get_bar_list()</a>, and <a class="el" href="structpcilib__bar__info__t.html#ab8d1abb1ff39fc801a03076be817f112">pcilib_bar_info_t::size</a>.</p>

</div>
</div>
<a id="a3f287796a4fd6dee915ea7a412da4add" name="a3f287796a4fd6dee915ea7a412da4add"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3f287796a4fd6dee915ea7a412da4add">&#9670;&#160;</a></span>pcilib_get_bar_list()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="structpcilib__bar__info__t.html">pcilib_bar_info_t</a> * pcilib_get_bar_list </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return a list of BAR memory regions available in the hardware. </p>
<p >The list is terminated by a dummy BAR description with 0 size.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- pointer to structure describing the BARs or NULL in case of error </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  293</span>                                                            {</div>
<div class="line"><span class="lineno">  294</span>    <span class="keywordtype">int</span> i, bars = 0;</div>
<div class="line"><span class="lineno">  295</span> </div>
<div class="line"><span class="lineno">  296</span>    <span class="keyword">const</span> pcilib_board_info_t *board_info = <a class="code hl_function" href="pci_8c.html#a74c205347b831faad18ebe3322d715a7">pcilib_get_board_info</a>(ctx);</div>
<div class="line"><span class="lineno">  297</span>    <span class="keywordflow">if</span> (!board_info) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  298</span> </div>
<div class="line"><span class="lineno">  299</span>    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code hl_define" href="pci_8h.html#afba0cbe7c423100d1d6dc2a1475507f4">PCILIB_MAX_BARS</a>; i++) {</div>
<div class="line"><span class="lineno">  300</span>        <span class="keywordflow">if</span> (board_info-&gt;bar_length[i] &gt; 0) {</div>
<div class="line"><span class="lineno">  301</span>            ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a449e13f9a979d7b03f7050ffa60d560b">bar_info</a>[bars++] = (<a class="code hl_struct" href="structpcilib__bar__info__t.html">pcilib_bar_info_t</a>) {</div>
<div class="line"><span class="lineno">  302</span>                .<a class="code hl_variable" href="structpcilib__bar__info__t.html#a5f53600efa7d5e78c28066ae26305c5b">bar</a> = i,</div>
<div class="line"><span class="lineno">  303</span>                .size = board_info-&gt;bar_length[i],</div>
<div class="line"><span class="lineno">  304</span>                .phys_addr =  board_info-&gt;bar_start[i],</div>
<div class="line"><span class="lineno">  305</span>                .virt_addr = ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#aaee187fc94e8ce9d8666582e95b68d65">bar_space</a>[i]</div>
<div class="line"><span class="lineno">  306</span>            };</div>
<div class="line"><span class="lineno">  307</span>        }</div>
<div class="line"><span class="lineno">  308</span>    }</div>
<div class="line"><span class="lineno">  309</span> </div>
<div class="line"><span class="lineno">  310</span>    <span class="keywordflow">return</span> ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a449e13f9a979d7b03f7050ffa60d560b">bar_info</a>;</div>
<div class="line"><span class="lineno">  311</span>}</div>
<div class="ttc" id="astructpcilib__bar__info__t_html_a5f53600efa7d5e78c28066ae26305c5b"><div class="ttname"><a href="structpcilib__bar__info__t.html#a5f53600efa7d5e78c28066ae26305c5b">pcilib_bar_info_t::bar</a></div><div class="ttdeci">pcilib_bar_t bar</div><div class="ttdef"><b>Definition:</b> bar.h:6</div></div>
<div class="ttc" id="astructpcilib__s_html_a449e13f9a979d7b03f7050ffa60d560b"><div class="ttname"><a href="structpcilib__s.html#a449e13f9a979d7b03f7050ffa60d560b">pcilib_s::bar_info</a></div><div class="ttdeci">pcilib_bar_info_t bar_info[PCILIB_MAX_BARS+1]</div><div class="ttdoc">NULL terminated list of PCI bar descriptions.</div><div class="ttdef"><b>Definition:</b> pci.h:57</div></div>
<div class="ttc" id="astructpcilib__s_html_aaee187fc94e8ce9d8666582e95b68d65"><div class="ttname"><a href="structpcilib__s.html#aaee187fc94e8ce9d8666582e95b68d65">pcilib_s::bar_space</a></div><div class="ttdeci">char * bar_space[PCILIB_MAX_BARS]</div><div class="ttdoc">Pointers to the mapped BARs in virtual address space.</div><div class="ttdef"><b>Definition:</b> pci.h:56</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__bar__info__t.html#a5f53600efa7d5e78c28066ae26305c5b">pcilib_bar_info_t::bar</a>, <a class="el" href="structpcilib__s.html#a449e13f9a979d7b03f7050ffa60d560b">pcilib_s::bar_info</a>, <a class="el" href="structpcilib__s.html#aaee187fc94e8ce9d8666582e95b68d65">pcilib_s::bar_space</a>, <a class="el" href="pci_8c.html#a74c205347b831faad18ebe3322d715a7">pcilib_get_board_info()</a>, and <a class="el" href="pci_8h.html#afba0cbe7c423100d1d6dc2a1475507f4">PCILIB_MAX_BARS</a>.</p>

<p class="reference">Referenced by <a class="el" href="bar_8c.html#ab8bd139474c7094d3fffe92360ee720e">pcilib_get_bar_info()</a>.</p>

</div>
</div>
<a id="a803f5e0c0ea90b723f268916c5410b23" name="a803f5e0c0ea90b723f268916c5410b23"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a803f5e0c0ea90b723f268916c5410b23">&#9670;&#160;</a></span>pcilib_map_bar()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void * pcilib_map_bar </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#ad5e21847906003557a26779731243927">pcilib_bar_t</a>&#160;</td>
          <td class="paramname"><em>bar</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Maps the specified bar to the address space of the process. </p>
<p >This function may be called multiple times for the same bar. It will only map the BAR once. Normally, the required BARs will be automatically mapped when BAR addresses are resolved with <a class="el" href="group__public__api__pci.html#ga5b6d816efc737e4f0fce9304001e771b" title="Resolves the phisycal PCI address to a virtual address in the process address space.">pcilib_resolve_bar_address()</a> and similar. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bar</td><td>- the PCI BAR number (numbered from 0) return - the address where the BAR is mapped. You can't use this address directly, instead pcilib_resolve_register_address(ctx, bar, 0) have to be used to find the start of the BAR in virtual address space. </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><span class="lineno">   79</span>                                                      {</div>
<div class="line"><span class="lineno">   80</span>    <span class="keywordtype">void</span> *res;</div>
<div class="line"><span class="lineno">   81</span>    <span class="keywordtype">int</span> err, ret; </div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>    <span class="keyword">const</span> pcilib_board_info_t *board_info = <a class="code hl_function" href="pci_8c.html#a74c205347b831faad18ebe3322d715a7">pcilib_get_board_info</a>(ctx);</div>
<div class="line"><span class="lineno">   84</span>    <span class="keywordflow">if</span> (!board_info) <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">   85</span> </div>
<div class="line"><span class="lineno">   86</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#aaee187fc94e8ce9d8666582e95b68d65">bar_space</a>[bar]) <span class="keywordflow">return</span> ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#aaee187fc94e8ce9d8666582e95b68d65">bar_space</a>[bar];</div>
<div class="line"><span class="lineno">   87</span> </div>
<div class="line"><span class="lineno">   88</span>    err = <a class="code hl_function" href="locking_8c.html#adbf250829f88c240473e38fc0224ed5f">pcilib_lock_global</a>(ctx);</div>
<div class="line"><span class="lineno">   89</span>    <span class="keywordflow">if</span> (err) {</div>
<div class="line"><span class="lineno">   90</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;Error (%i) acquiring mmap lock&quot;</span>, err);</div>
<div class="line"><span class="lineno">   91</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">   92</span>    }</div>
<div class="line"><span class="lineno">   93</span> </div>
<div class="line"><span class="lineno">   94</span>    ret = ioctl( ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a97959ae9b1ab77309f0afec2b62d283c">handle</a>, PCIDRIVER_IOC_MMAP_MODE, PCIDRIVER_MMAP_PCI );</div>
<div class="line"><span class="lineno">   95</span>    <span class="keywordflow">if</span> (ret) {</div>
<div class="line"><span class="lineno">   96</span>        <a class="code hl_function" href="locking_8c.html#aee7b665a4a015a315d06c5314dc6e1eb">pcilib_unlock_global</a>(ctx);</div>
<div class="line"><span class="lineno">   97</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;PCIDRIVER_IOC_MMAP_MODE ioctl have failed&quot;</span>, bar);</div>
<div class="line"><span class="lineno">   98</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">   99</span>    }</div>
<div class="line"><span class="lineno">  100</span> </div>
<div class="line"><span class="lineno">  101</span>    ret = ioctl( ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a97959ae9b1ab77309f0afec2b62d283c">handle</a>, PCIDRIVER_IOC_MMAP_AREA, PCIDRIVER_BAR0 + bar );</div>
<div class="line"><span class="lineno">  102</span>    <span class="keywordflow">if</span> (ret) {</div>
<div class="line"><span class="lineno">  103</span>        <a class="code hl_function" href="locking_8c.html#aee7b665a4a015a315d06c5314dc6e1eb">pcilib_unlock_global</a>(ctx);</div>
<div class="line"><span class="lineno">  104</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;PCIDRIVER_IOC_MMAP_AREA ioctl have failed for bank %i&quot;</span>, bar);</div>
<div class="line"><span class="lineno">  105</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  106</span>    }</div>
<div class="line"><span class="lineno">  107</span> </div>
<div class="line"><span class="lineno">  108</span><span class="preprocessor">#ifdef PCILIB_FILE_IO</span></div>
<div class="line"><span class="lineno">  109</span>    file_io_handle = open(<span class="stringliteral">&quot;/root/data&quot;</span>, O_RDWR);</div>
<div class="line"><span class="lineno">  110</span>    res = mmap( 0, board_info-&gt;bar_length[bar], PROT_WRITE | PROT_READ, MAP_SHARED, ctx-&gt;file_io_handle, 0 );</div>
<div class="line"><span class="lineno">  111</span><span class="preprocessor">#else</span></div>
<div class="line"><span class="lineno">  112</span>    res = mmap( 0, board_info-&gt;bar_length[bar], PROT_WRITE | PROT_READ, MAP_SHARED, ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a97959ae9b1ab77309f0afec2b62d283c">handle</a>, 0 );</div>
<div class="line"><span class="lineno">  113</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  114</span> </div>
<div class="line"><span class="lineno">  115</span>    <a class="code hl_function" href="locking_8c.html#aee7b665a4a015a315d06c5314dc6e1eb">pcilib_unlock_global</a>(ctx);</div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>    <span class="keywordflow">if</span> ((!res)||(res == MAP_FAILED)) {</div>
<div class="line"><span class="lineno">  118</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;Failed to mmap data bank %i&quot;</span>, bar);</div>
<div class="line"><span class="lineno">  119</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  120</span>    }</div>
<div class="line"><span class="lineno">  121</span> </div>
<div class="line"><span class="lineno">  122</span>    ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#aaee187fc94e8ce9d8666582e95b68d65">bar_space</a>[bar] = res;</div>
<div class="line"><span class="lineno">  123</span>    <span class="keywordflow">return</span> res;</div>
<div class="line"><span class="lineno">  124</span>}</div>
<div class="ttc" id="alocking_8c_html_adbf250829f88c240473e38fc0224ed5f"><div class="ttname"><a href="locking_8c.html#adbf250829f88c240473e38fc0224ed5f">pcilib_lock_global</a></div><div class="ttdeci">int pcilib_lock_global(pcilib_t *ctx)</div><div class="ttdoc">this function use flock locking mechanism on the ALPS platform device file, to make sure to not creat...</div><div class="ttdef"><b>Definition:</b> locking.c:78</div></div>
<div class="ttc" id="alocking_8c_html_aee7b665a4a015a315d06c5314dc6e1eb"><div class="ttname"><a href="locking_8c.html#aee7b665a4a015a315d06c5314dc6e1eb">pcilib_unlock_global</a></div><div class="ttdeci">void pcilib_unlock_global(pcilib_t *ctx)</div><div class="ttdoc">function to remove the lock created by flock on the ALPS platform device file</div><div class="ttdef"><b>Definition:</b> locking.c:90</div></div>
<div class="ttc" id="astructpcilib__s_html_a97959ae9b1ab77309f0afec2b62d283c"><div class="ttname"><a href="structpcilib__s.html#a97959ae9b1ab77309f0afec2b62d283c">pcilib_s::handle</a></div><div class="ttdeci">int handle</div><div class="ttdoc">file handle of device</div><div class="ttdef"><b>Definition:</b> pci.h:48</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__s.html#aaee187fc94e8ce9d8666582e95b68d65">pcilib_s::bar_space</a>, <a class="el" href="structpcilib__s.html#a97959ae9b1ab77309f0afec2b62d283c">pcilib_s::handle</a>, <a class="el" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>, <a class="el" href="pci_8c.html#a74c205347b831faad18ebe3322d715a7">pcilib_get_board_info()</a>, <a class="el" href="locking_8c.html#adbf250829f88c240473e38fc0224ed5f">pcilib_lock_global()</a>, and <a class="el" href="locking_8c.html#aee7b665a4a015a315d06c5314dc6e1eb">pcilib_unlock_global()</a>.</p>

<p class="reference">Referenced by <a class="el" href="bar_8c.html#ab7def3eafcc1c7da9548d35f0357fbd6">pcilib_map_data_space()</a>, <a class="el" href="bar_8c.html#ab8719d195c10a67241594fce48c5a70e">pcilib_map_register_space()</a>, <a class="el" href="group__public__api__pci.html#gaca36d2bf9de2a981e6103c167ba1e540">pcilib_read()</a>, <a class="el" href="group__public__api__pci.html#ga82bca2b1ae797d97f03b68f95eb9c524">pcilib_read_fifo()</a>, <a class="el" href="group__public__api__pci.html#ga5b6d816efc737e4f0fce9304001e771b">pcilib_resolve_bar_address()</a>, <a class="el" href="group__public__api__pci.html#gaf4ecef1d07b5e71c52b8fbee0a3491fa">pcilib_write()</a>, and <a class="el" href="group__public__api__pci.html#ga938537920eaf8eb55468bf7b5ec7161d">pcilib_write_fifo()</a>.</p>

</div>
</div>
<a id="a8988c9237b29e2f7d34e5ca5d61d6aac" name="a8988c9237b29e2f7d34e5ca5d61d6aac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8988c9237b29e2f7d34e5ca5d61d6aac">&#9670;&#160;</a></span>pcilib_resolve_data_space()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char * pcilib_resolve_data_space </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uintptr_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resolves the virtual address and the size of PCI BAR space used for data exchange. </p>
<p >This is left-over from older version of pcilib and currently unused. We may reconsider how it is organized and implemented. The data_space parameter may go into the model definition. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">addr</td><td>- may hint there the data space is located, use 0 to autodetect </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">size</td><td>- the size of data space is returned </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- virtual address of data space (ready to use) or NULL if detection has failed </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  279</span>                                                                             {</div>
<div class="line"><span class="lineno">  280</span>    <span class="keywordtype">int</span> err;</div>
<div class="line"><span class="lineno">  281</span>    </div>
<div class="line"><span class="lineno">  282</span>    err = <a class="code hl_function" href="bar_8c.html#ab7def3eafcc1c7da9548d35f0357fbd6">pcilib_map_data_space</a>(ctx, addr);</div>
<div class="line"><span class="lineno">  283</span>    <span class="keywordflow">if</span> (err) {</div>
<div class="line"><span class="lineno">  284</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;Failed to map the specified address space (%lx)&quot;</span>, addr);</div>
<div class="line"><span class="lineno">  285</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  286</span>    }</div>
<div class="line"><span class="lineno">  287</span>    </div>
<div class="line"><span class="lineno">  288</span>    <span class="keywordflow">if</span> (size) *size = ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#aed7a99716e212d2fb0752fb1746bb06d">board_info</a>.bar_length[ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a4f2d3676a81af2bcd69c1f4372f97d99">data_bar</a>];</div>
<div class="line"><span class="lineno">  289</span>    </div>
<div class="line"><span class="lineno">  290</span>    <span class="keywordflow">return</span> ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#aaee187fc94e8ce9d8666582e95b68d65">bar_space</a>[ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a4f2d3676a81af2bcd69c1f4372f97d99">data_bar</a>] + (ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#aed7a99716e212d2fb0752fb1746bb06d">board_info</a>.bar_start[ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a4f2d3676a81af2bcd69c1f4372f97d99">data_bar</a>] &amp; ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a3b8d32830b2e29cb8dadcd73bb5fd063">page_mask</a>);</div>
<div class="line"><span class="lineno">  291</span>}</div>
<div class="ttc" id="abar_8c_html_ab7def3eafcc1c7da9548d35f0357fbd6"><div class="ttname"><a href="bar_8c.html#ab7def3eafcc1c7da9548d35f0357fbd6">pcilib_map_data_space</a></div><div class="ttdeci">int pcilib_map_data_space(pcilib_t *ctx, uintptr_t addr)</div><div class="ttdef"><b>Definition:</b> bar.c:221</div></div>
<div class="ttc" id="astructpcilib__s_html_a4f2d3676a81af2bcd69c1f4372f97d99"><div class="ttname"><a href="structpcilib__s.html#a4f2d3676a81af2bcd69c1f4372f97d99">pcilib_s::data_bar</a></div><div class="ttdeci">pcilib_bar_t data_bar</div><div class="ttdoc">BAR for large PIO operations.</div><div class="ttdef"><b>Definition:</b> pci.h:67</div></div>
<div class="ttc" id="astructpcilib__s_html_aed7a99716e212d2fb0752fb1746bb06d"><div class="ttname"><a href="structpcilib__s.html#aed7a99716e212d2fb0752fb1746bb06d">pcilib_s::board_info</a></div><div class="ttdeci">pcilib_board_info_t board_info</div><div class="ttdoc">The mandatory information about board as defined by PCI specification.</div><div class="ttdef"><b>Definition:</b> pci.h:54</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__s.html#aaee187fc94e8ce9d8666582e95b68d65">pcilib_s::bar_space</a>, <a class="el" href="structpcilib__s.html#aed7a99716e212d2fb0752fb1746bb06d">pcilib_s::board_info</a>, <a class="el" href="structpcilib__s.html#a4f2d3676a81af2bcd69c1f4372f97d99">pcilib_s::data_bar</a>, <a class="el" href="structpcilib__s.html#a3b8d32830b2e29cb8dadcd73bb5fd063">pcilib_s::page_mask</a>, <a class="el" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>, and <a class="el" href="bar_8c.html#ab7def3eafcc1c7da9548d35f0357fbd6">pcilib_map_data_space()</a>.</p>

</div>
</div>
<a id="a4ce1cd3017c15f543dc5b6bce5d5081f" name="a4ce1cd3017c15f543dc5b6bce5d5081f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4ce1cd3017c15f543dc5b6bce5d5081f">&#9670;&#160;</a></span>pcilib_unmap_bar()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pcilib_unmap_bar </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#ad5e21847906003557a26779731243927">pcilib_bar_t</a>&#160;</td>
          <td class="paramname"><em>bar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unmaps the specified bar from the address space of the process. </p>
<p >Actually, it will only unmap the BAR if it is not used by DMA or Event egines. So, it is fine to include the calls to <a class="el" href="bar_8h.html#a803f5e0c0ea90b723f268916c5410b23" title="Maps the specified bar to the address space of the process.">pcilib_map_bar()</a> / <a class="el" href="bar_8h.html#a4ce1cd3017c15f543dc5b6bce5d5081f" title="Unmaps the specified bar from the address space of the process.">pcilib_unmap_bar()</a> when a specific BAR is needed. On other hand, there is a little point in doing so. The BAR may be left mapped and will be automatically umapped when <a class="el" href="group__public__api.html#ga809b61586ed9c56a7510c607859e75e3" title="Destroy pcilib context and all memory associated with it.">pcilib_close()</a> is called. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">bar</td><td>- BAR number (numbered from 0) </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">data</td><td>- The address returned by <a class="el" href="bar_8h.html#a803f5e0c0ea90b723f268916c5410b23" title="Maps the specified bar to the address space of the process.">pcilib_map_bar()</a> call </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><span class="lineno">  126</span>                                                                   {</div>
<div class="line"><span class="lineno">  127</span>    <span class="keyword">const</span> pcilib_board_info_t *board_info = <a class="code hl_function" href="pci_8c.html#a74c205347b831faad18ebe3322d715a7">pcilib_get_board_info</a>(ctx);</div>
<div class="line"><span class="lineno">  128</span>    <span class="keywordflow">if</span> (!board_info) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  129</span> </div>
<div class="line"><span class="lineno">  130</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#aaee187fc94e8ce9d8666582e95b68d65">bar_space</a>[bar]) <span class="keywordflow">return</span>;</div>
<div class="line"><span class="lineno">  131</span>    </div>
<div class="line"><span class="lineno">  132</span>    munmap(data, board_info-&gt;bar_length[bar]);</div>
<div class="line"><span class="lineno">  133</span><span class="preprocessor">#ifdef PCILIB_FILE_IO</span></div>
<div class="line"><span class="lineno">  134</span>    close(ctx-&gt;file_io_handle);</div>
<div class="line"><span class="lineno">  135</span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="lineno">  136</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__s.html#aaee187fc94e8ce9d8666582e95b68d65">pcilib_s::bar_space</a>, and <a class="el" href="pci_8c.html#a74c205347b831faad18ebe3322d715a7">pcilib_get_board_info()</a>.</p>

<p class="reference">Referenced by <a class="el" href="group__public__api.html#ga809b61586ed9c56a7510c607859e75e3">pcilib_close()</a>, <a class="el" href="group__public__api__pci.html#gaca36d2bf9de2a981e6103c167ba1e540">pcilib_read()</a>, <a class="el" href="group__public__api__pci.html#ga82bca2b1ae797d97f03b68f95eb9c524">pcilib_read_fifo()</a>, <a class="el" href="group__public__api__pci.html#gaf4ecef1d07b5e71c52b8fbee0a3491fa">pcilib_write()</a>, and <a class="el" href="group__public__api__pci.html#ga938537920eaf8eb55468bf7b5ec7161d">pcilib_write_fifo()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 18 2024 22:02:47 for pcilib by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
