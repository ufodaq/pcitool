<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>pcilib: Public DMA API</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">pcilib
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Public DMA API</div></div>
</div><!--header-->
<div class="contents">

<p>High speed interface for reading and writting unstructured data.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga5a92b6019a460bc8809bd270f6d2a845"><td class="memItemLeft" align="right" valign="top"><a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__public__api__dma.html#ga5a92b6019a460bc8809bd270f6d2a845">pcilib_find_dma_by_addr</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="pcilib_8h.html#aae456a435ae9c105b192cb4d35a49b01">pcilib_dma_direction_t</a> direction, <a class="el" href="pcilib_8h.html#aeac14779daa7c1f039bb87e4265992bf">pcilib_dma_engine_addr_t</a> dma)</td></tr>
<tr class="memdesc:ga5a92b6019a460bc8809bd270f6d2a845"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function resolves the ID of DMA engine from its address and direction.  <a href="group__public__api__dma.html#ga5a92b6019a460bc8809bd270f6d2a845">More...</a><br /></td></tr>
<tr class="separator:ga5a92b6019a460bc8809bd270f6d2a845"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3acfaf4ab317d091c72c85bfd9bdde3d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__public__api__dma.html#ga3acfaf4ab317d091c72c85bfd9bdde3d">pcilib_start_dma</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a> dma, <a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4">pcilib_dma_flags_t</a> flags)</td></tr>
<tr class="memdesc:ga3acfaf4ab317d091c72c85bfd9bdde3d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts DMA engine.  <a href="group__public__api__dma.html#ga3acfaf4ab317d091c72c85bfd9bdde3d">More...</a><br /></td></tr>
<tr class="separator:ga3acfaf4ab317d091c72c85bfd9bdde3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga45f2c71c921c37da3a57fdab8c675490"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__public__api__dma.html#ga45f2c71c921c37da3a57fdab8c675490">pcilib_stop_dma</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a> dma, <a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4">pcilib_dma_flags_t</a> flags)</td></tr>
<tr class="memdesc:ga45f2c71c921c37da3a57fdab8c675490"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stops DMA engine or just cleans up the process-specific memory buffers (see <a class="el" href="group__public__api__dma.html#ga3acfaf4ab317d091c72c85bfd9bdde3d" title="Starts DMA engine.">pcilib_start_dma()</a> for details).  <a href="group__public__api__dma.html#ga45f2c71c921c37da3a57fdab8c675490">More...</a><br /></td></tr>
<tr class="separator:ga45f2c71c921c37da3a57fdab8c675490"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga862942eecc274b76d22dea30bce65a0e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__public__api__dma.html#ga862942eecc274b76d22dea30bce65a0e">pcilib_skip_dma</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a> dma)</td></tr>
<tr class="memdesc:ga862942eecc274b76d22dea30bce65a0e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tries to drop all pending data in the DMA channel.  <a href="group__public__api__dma.html#ga862942eecc274b76d22dea30bce65a0e">More...</a><br /></td></tr>
<tr class="separator:ga862942eecc274b76d22dea30bce65a0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga500ad5dc629d20579e83f0df44162bb6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__public__api__dma.html#ga500ad5dc629d20579e83f0df44162bb6">pcilib_stream_dma</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a> dma, uintptr_t addr, size_t size, <a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4">pcilib_dma_flags_t</a> flags, <a class="el" href="pcilib_8h.html#a1d84306119429755a7bfd73b953c01dc">pcilib_timeout_t</a> timeout, <a class="el" href="pcilib_8h.html#abb6d717667ef56a1b73b63f1537bfe20">pcilib_dma_callback_t</a> cb, void *cbattr)</td></tr>
<tr class="memdesc:ga500ad5dc629d20579e83f0df44162bb6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads data from DMA buffers and pass it to the specified callback function.  <a href="group__public__api__dma.html#ga500ad5dc629d20579e83f0df44162bb6">More...</a><br /></td></tr>
<tr class="separator:ga500ad5dc629d20579e83f0df44162bb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4aa78c7c5fd9996087311fc21bd7ccd5"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__public__api__dma.html#ga4aa78c7c5fd9996087311fc21bd7ccd5">pcilib_read_dma_custom</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a> dma, uintptr_t addr, size_t size, <a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4">pcilib_dma_flags_t</a> flags, <a class="el" href="pcilib_8h.html#a1d84306119429755a7bfd73b953c01dc">pcilib_timeout_t</a> timeout, void *buf, size_t *rdsize)</td></tr>
<tr class="memdesc:ga4aa78c7c5fd9996087311fc21bd7ccd5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads data from DMA until timeout is hit, a full DMA packet is read, or the specified number of bytes are read.  <a href="group__public__api__dma.html#ga4aa78c7c5fd9996087311fc21bd7ccd5">More...</a><br /></td></tr>
<tr class="separator:ga4aa78c7c5fd9996087311fc21bd7ccd5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga048d13d66977bb839d3c53952b70c25c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__public__api__dma.html#ga048d13d66977bb839d3c53952b70c25c">pcilib_read_dma</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a> dma, uintptr_t addr, size_t size, void *buf, size_t *rdsize)</td></tr>
<tr class="memdesc:ga048d13d66977bb839d3c53952b70c25c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reads data from DMA until timeout is hit, a full DMA packet is read, or the specified number of bytes are read.  <a href="group__public__api__dma.html#ga048d13d66977bb839d3c53952b70c25c">More...</a><br /></td></tr>
<tr class="separator:ga048d13d66977bb839d3c53952b70c25c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad6ad21e27311c68f05a5189ce628f9bf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__public__api__dma.html#gad6ad21e27311c68f05a5189ce628f9bf">pcilib_push_dma</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a> dma, uintptr_t addr, size_t size, <a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4">pcilib_dma_flags_t</a> flags, <a class="el" href="pcilib_8h.html#a1d84306119429755a7bfd73b953c01dc">pcilib_timeout_t</a> timeout, void *buf, size_t *wrsize)</td></tr>
<tr class="memdesc:gad6ad21e27311c68f05a5189ce628f9bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pushes new data to the DMA engine.  <a href="group__public__api__dma.html#gad6ad21e27311c68f05a5189ce628f9bf">More...</a><br /></td></tr>
<tr class="separator:gad6ad21e27311c68f05a5189ce628f9bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac85698e9e7185da357cce361d62a6840"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__public__api__dma.html#gac85698e9e7185da357cce361d62a6840">pcilib_write_dma</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a> dma, uintptr_t addr, size_t size, void *buf, size_t *wrsize)</td></tr>
<tr class="memdesc:gac85698e9e7185da357cce361d62a6840"><td class="mdescLeft">&#160;</td><td class="mdescRight">Pushes new data to the DMA engine and blocks until hardware gets it all.  <a href="group__public__api__dma.html#gac85698e9e7185da357cce361d62a6840">More...</a><br /></td></tr>
<tr class="separator:gac85698e9e7185da357cce361d62a6840"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6661ab5d294fc27d50c3cddf42006dc8"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__public__api__dma.html#ga6661ab5d294fc27d50c3cddf42006dc8">pcilib_benchmark_dma</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="pcilib_8h.html#aeac14779daa7c1f039bb87e4265992bf">pcilib_dma_engine_addr_t</a> dma, uintptr_t addr, size_t size, size_t iterations, <a class="el" href="pcilib_8h.html#aae456a435ae9c105b192cb4d35a49b01">pcilib_dma_direction_t</a> direction)</td></tr>
<tr class="memdesc:ga6661ab5d294fc27d50c3cddf42006dc8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Benchmarks the DMA implementation.  <a href="group__public__api__dma.html#ga6661ab5d294fc27d50c3cddf42006dc8">More...</a><br /></td></tr>
<tr class="separator:ga6661ab5d294fc27d50c3cddf42006dc8"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p >High speed interface for reading and writting unstructured data. </p>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga6661ab5d294fc27d50c3cddf42006dc8" name="ga6661ab5d294fc27d50c3cddf42006dc8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6661ab5d294fc27d50c3cddf42006dc8">&#9670;&#160;</a></span>pcilib_benchmark_dma()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double pcilib_benchmark_dma </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#aeac14779daa7c1f039bb87e4265992bf">pcilib_dma_engine_addr_t</a>&#160;</td>
          <td class="paramname"><em>dma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uintptr_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>iterations</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#aae456a435ae9c105b192cb4d35a49b01">pcilib_dma_direction_t</a>&#160;</td>
          <td class="paramname"><em>direction</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Benchmarks the DMA implementation. </p>
<p >The reported performance may be significantly affected by several environmental variables.</p><ul>
<li>PCILIB_BENCHMARK_HARDWARE - if set will not copy the data out, but immediately drop as it lended in DMA buffers. This allows to remove influence of memcpy performance.</li>
<li>PCILIB_BENCHMARK_STREAMING - if set will not re-initialized the DMA on each iteration. If DMA is properly implemented this should have only marginal influence on performance</li>
</ul>
<p >The function is process- and thread-safe. The <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60cae16e1bf6797a9883778d310ed58d15f4">PCILIB_ERROR_BUSY</a> will be returned immediately if DMA is used by another thread or process.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dma</td><td>- Address of DMA engine </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">addr</td><td>- Benchmark will read and write data at the specified address (ignored by existing DMA engines) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>- specifies how many bytes should be read and written at each iteration </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">iterations</td><td>- number of iterations to execute </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">direction</td><td>- Specifies if DMA reading or writting should be benchmarked, bi-directional benchmark is possible as well </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- bandwidth in MiB/s (Mebibytes per second) </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  370</span>                                                                                                                                                           {</div>
<div class="line"><span class="lineno">  371</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structpcilib__dma__description__t.html">pcilib_dma_description_t</a> *info =  <a class="code hl_function" href="dma_8c.html#aa237b49d303aabd58d8fc320915aa32c">pcilib_get_dma_description</a>(ctx);</div>
<div class="line"><span class="lineno">  372</span>    <span class="keywordflow">if</span> (!info) {</div>
<div class="line"><span class="lineno">  373</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;DMA is not supported by the device&quot;</span>);</div>
<div class="line"><span class="lineno">  374</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  375</span>    }</div>
<div class="line"><span class="lineno">  376</span> </div>
<div class="line"><span class="lineno">  377</span>    <span class="keywordflow">if</span> (!info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">api</a>) {</div>
<div class="line"><span class="lineno">  378</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;DMA Engine is not configured in the current model&quot;</span>);</div>
<div class="line"><span class="lineno">  379</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  380</span>    }</div>
<div class="line"><span class="lineno">  381</span>    </div>
<div class="line"><span class="lineno">  382</span>    <span class="keywordflow">if</span> (!info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">api</a>-&gt;<a class="code hl_variable" href="structpcilib__dma__api__description__t.html#ad35df96833875789a3dc14e048b166c3">benchmark</a>) {</div>
<div class="line"><span class="lineno">  383</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;The DMA benchmark is not supported by configured DMA engine&quot;</span>);</div>
<div class="line"><span class="lineno">  384</span>        <span class="keywordflow">return</span> -1;</div>
<div class="line"><span class="lineno">  385</span>    }</div>
<div class="line"><span class="lineno">  386</span> </div>
<div class="line"><span class="lineno">  387</span>    <span class="keywordflow">return</span> info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">api</a>-&gt;<a class="code hl_variable" href="structpcilib__dma__api__description__t.html#ad35df96833875789a3dc14e048b166c3">benchmark</a>(ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a81fc504bd03023f6d2a2f22fd2ee58ca">dma_ctx</a>, dma, addr, size, iterations, direction);</div>
<div class="line"><span class="lineno">  388</span>}</div>
<div class="ttc" id="adma_8c_html_aa237b49d303aabd58d8fc320915aa32c"><div class="ttname"><a href="dma_8c.html#aa237b49d303aabd58d8fc320915aa32c">pcilib_get_dma_description</a></div><div class="ttdeci">const pcilib_dma_description_t * pcilib_get_dma_description(pcilib_t *ctx)</div><div class="ttdef"><b>Definition:</b> dma.c:23</div></div>
<div class="ttc" id="aerror_8h_html_a2b06064fecffd095efabb752f7b50021"><div class="ttname"><a href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a></div><div class="ttdeci">#define pcilib_error(...)</div><div class="ttdef"><b>Definition:</b> error.h:68</div></div>
<div class="ttc" id="astructpcilib__dma__api__description__t_html_ad35df96833875789a3dc14e048b166c3"><div class="ttname"><a href="structpcilib__dma__api__description__t.html#ad35df96833875789a3dc14e048b166c3">pcilib_dma_api_description_t::benchmark</a></div><div class="ttdeci">double(* benchmark)(pcilib_dma_context_t *ctx, pcilib_dma_engine_addr_t dma, uintptr_t addr, size_t size, size_t iterations, pcilib_dma_direction_t direction)</div><div class="ttdef"><b>Definition:</b> dma.h:70</div></div>
<div class="ttc" id="astructpcilib__dma__description__t_html"><div class="ttname"><a href="structpcilib__dma__description__t.html">pcilib_dma_description_t</a></div><div class="ttdef"><b>Definition:</b> dma.h:74</div></div>
<div class="ttc" id="astructpcilib__dma__description__t_html_a65df2efa3f37b7c5cf8acdbe8d23283b"><div class="ttname"><a href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">pcilib_dma_description_t::api</a></div><div class="ttdeci">const pcilib_dma_api_description_t * api</div><div class="ttdoc">Defines all API functions for DMA operation.</div><div class="ttdef"><b>Definition:</b> dma.h:75</div></div>
<div class="ttc" id="astructpcilib__s_html_a81fc504bd03023f6d2a2f22fd2ee58ca"><div class="ttname"><a href="structpcilib__s.html#a81fc504bd03023f6d2a2f22fd2ee58ca">pcilib_s::dma_ctx</a></div><div class="ttdeci">pcilib_dma_context_t * dma_ctx</div><div class="ttdoc">DMA context.</div><div class="ttdef"><b>Definition:</b> pci.h:89</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">pcilib_dma_description_t::api</a>, <a class="el" href="structpcilib__dma__api__description__t.html#ad35df96833875789a3dc14e048b166c3">pcilib_dma_api_description_t::benchmark</a>, <a class="el" href="structpcilib__s.html#a81fc504bd03023f6d2a2f22fd2ee58ca">pcilib_s::dma_ctx</a>, <a class="el" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>, and <a class="el" href="dma_8c.html#aa237b49d303aabd58d8fc320915aa32c">pcilib_get_dma_description()</a>.</p>

</div>
</div>
<a id="ga5a92b6019a460bc8809bd270f6d2a845" name="ga5a92b6019a460bc8809bd270f6d2a845"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5a92b6019a460bc8809bd270f6d2a845">&#9670;&#160;</a></span>pcilib_find_dma_by_addr()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a> pcilib_find_dma_by_addr </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#aae456a435ae9c105b192cb4d35a49b01">pcilib_dma_direction_t</a>&#160;</td>
          <td class="paramname"><em>direction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#aeac14779daa7c1f039bb87e4265992bf">pcilib_dma_engine_addr_t</a>&#160;</td>
          <td class="paramname"><em>dma</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function resolves the ID of DMA engine from its address and direction. </p>
<p >It is a bit confusing, but addresses should be able to represent bi-directional DMA engines. Unfortunatelly, implementation often is limited to uni-directional engines. In this case, two DMA engines with different IDs can be virtually combined in a DMA engine with the uniq address. This will allow user to specify the same engine address in all types of accesses and we will resolve the appropriate engine ID depending on the requested direction. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">direction</td><td>- DMA direction (to/from device) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dma</td><td>- address of DMA engine </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- ID of DMA engine or PCILIB_DMA_INVALID if the specified engine does not exist </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   38</span>                                                                                                                           {</div>
<div class="line"><span class="lineno">   39</span>    <a class="code hl_typedef" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a> i;</div>
<div class="line"><span class="lineno">   40</span> </div>
<div class="line"><span class="lineno">   41</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structpcilib__dma__description__t.html">pcilib_dma_description_t</a> *dma_info =  <a class="code hl_function" href="dma_8c.html#aa237b49d303aabd58d8fc320915aa32c">pcilib_get_dma_description</a>(ctx);</div>
<div class="line"><span class="lineno">   42</span>    <span class="keywordflow">if</span> (!dma_info) {</div>
<div class="line"><span class="lineno">   43</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;DMA Engine is not configured in the current model&quot;</span>);</div>
<div class="line"><span class="lineno">   44</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caf5392ef1a23835f44ebfe662e3d2988c">PCILIB_ERROR_NOTSUPPORTED</a>;</div>
<div class="line"><span class="lineno">   45</span>    }</div>
<div class="line"><span class="lineno">   46</span> </div>
<div class="line"><span class="lineno">   47</span>    <span class="keywordflow">for</span> (i = 0; dma_info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#abd61b0b1a1de7d1923d86df4e3a2239c">engines</a>[i].<a class="code hl_variable" href="structpcilib__dma__engine__description__t.html#a6eb5a7474384fc0ce8ee80d50a048ede">addr_bits</a>; i++) {</div>
<div class="line"><span class="lineno">   48</span>        <span class="keywordflow">if</span> ((dma_info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#abd61b0b1a1de7d1923d86df4e3a2239c">engines</a>[i].<a class="code hl_variable" href="structpcilib__dma__engine__description__t.html#a1ccb4196efc106e9f2961f129c9dfe85">addr</a> == dma)&amp;&amp;((dma_info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#abd61b0b1a1de7d1923d86df4e3a2239c">engines</a>[i].<a class="code hl_variable" href="structpcilib__dma__engine__description__t.html#a910472c4dc812f8206935c031356200b">direction</a>&amp;direction)==direction)) <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">   49</span>    }</div>
<div class="line"><span class="lineno">   50</span> </div>
<div class="line"><span class="lineno">   51</span>    <span class="keywordflow">if</span> (dma_info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#abd61b0b1a1de7d1923d86df4e3a2239c">engines</a>[i].<a class="code hl_variable" href="structpcilib__dma__engine__description__t.html#a6eb5a7474384fc0ce8ee80d50a048ede">addr_bits</a>) <span class="keywordflow">return</span> i;</div>
<div class="line"><span class="lineno">   52</span>    <span class="keywordflow">return</span> <a class="code hl_define" href="pcilib_8h.html#ad39b142ea765778f14f5ba537780a810">PCILIB_DMA_ENGINE_INVALID</a>;</div>
<div class="line"><span class="lineno">   53</span>}</div>
<div class="ttc" id="aerror_8h_html_a0c59f7091fd2446121868635aca9e60caf5392ef1a23835f44ebfe662e3d2988c"><div class="ttname"><a href="error_8h.html#a0c59f7091fd2446121868635aca9e60caf5392ef1a23835f44ebfe662e3d2988c">PCILIB_ERROR_NOTSUPPORTED</a></div><div class="ttdeci">@ PCILIB_ERROR_NOTSUPPORTED</div><div class="ttdef"><b>Definition:</b> error.h:24</div></div>
<div class="ttc" id="apcilib_8h_html_a3e2e6c8a87c030ef9d5b1d9907231f8e"><div class="ttname"><a href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a></div><div class="ttdeci">uint8_t pcilib_dma_engine_t</div><div class="ttdef"><b>Definition:</b> pcilib.h:22</div></div>
<div class="ttc" id="apcilib_8h_html_ad39b142ea765778f14f5ba537780a810"><div class="ttname"><a href="pcilib_8h.html#ad39b142ea765778f14f5ba537780a810">PCILIB_DMA_ENGINE_INVALID</a></div><div class="ttdeci">#define PCILIB_DMA_ENGINE_INVALID</div><div class="ttdef"><b>Definition:</b> pcilib.h:186</div></div>
<div class="ttc" id="astructpcilib__dma__description__t_html_abd61b0b1a1de7d1923d86df4e3a2239c"><div class="ttname"><a href="structpcilib__dma__description__t.html#abd61b0b1a1de7d1923d86df4e3a2239c">pcilib_dma_description_t::engines</a></div><div class="ttdeci">const pcilib_dma_engine_description_t * engines</div><div class="ttdoc">List of DMA engines exposed by DMA interface, alternatively engines can be added during DMA initializ...</div><div class="ttdef"><b>Definition:</b> dma.h:78</div></div>
<div class="ttc" id="astructpcilib__dma__engine__description__t_html_a1ccb4196efc106e9f2961f129c9dfe85"><div class="ttname"><a href="structpcilib__dma__engine__description__t.html#a1ccb4196efc106e9f2961f129c9dfe85">pcilib_dma_engine_description_t::addr</a></div><div class="ttdeci">pcilib_dma_engine_addr_t addr</div><div class="ttdoc">Address of DMA engine (from 0)</div><div class="ttdef"><b>Definition:</b> dma.h:32</div></div>
<div class="ttc" id="astructpcilib__dma__engine__description__t_html_a6eb5a7474384fc0ce8ee80d50a048ede"><div class="ttname"><a href="structpcilib__dma__engine__description__t.html#a6eb5a7474384fc0ce8ee80d50a048ede">pcilib_dma_engine_description_t::addr_bits</a></div><div class="ttdeci">size_t addr_bits</div><div class="ttdoc">Number of addressable bits in the system memory (we currently work with 32-bits only)</div><div class="ttdef"><b>Definition:</b> dma.h:35</div></div>
<div class="ttc" id="astructpcilib__dma__engine__description__t_html_a910472c4dc812f8206935c031356200b"><div class="ttname"><a href="structpcilib__dma__engine__description__t.html#a910472c4dc812f8206935c031356200b">pcilib_dma_engine_description_t::direction</a></div><div class="ttdeci">pcilib_dma_direction_t direction</div><div class="ttdoc">Defines which kind of transfer does engine support: C2S, S2C, or both.</div><div class="ttdef"><b>Definition:</b> dma.h:34</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__dma__engine__description__t.html#a1ccb4196efc106e9f2961f129c9dfe85">pcilib_dma_engine_description_t::addr</a>, <a class="el" href="structpcilib__dma__engine__description__t.html#a6eb5a7474384fc0ce8ee80d50a048ede">pcilib_dma_engine_description_t::addr_bits</a>, <a class="el" href="structpcilib__dma__engine__description__t.html#a910472c4dc812f8206935c031356200b">pcilib_dma_engine_description_t::direction</a>, <a class="el" href="structpcilib__dma__description__t.html#abd61b0b1a1de7d1923d86df4e3a2239c">pcilib_dma_description_t::engines</a>, <a class="el" href="pcilib_8h.html#ad39b142ea765778f14f5ba537780a810">PCILIB_DMA_ENGINE_INVALID</a>, <a class="el" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caf5392ef1a23835f44ebfe662e3d2988c">PCILIB_ERROR_NOTSUPPORTED</a>, and <a class="el" href="dma_8c.html#aa237b49d303aabd58d8fc320915aa32c">pcilib_get_dma_description()</a>.</p>

</div>
</div>
<a id="gad6ad21e27311c68f05a5189ce628f9bf" name="gad6ad21e27311c68f05a5189ce628f9bf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad6ad21e27311c68f05a5189ce628f9bf">&#9670;&#160;</a></span>pcilib_push_dma()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pcilib_push_dma </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a>&#160;</td>
          <td class="paramname"><em>dma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uintptr_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4">pcilib_dma_flags_t</a>&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#a1d84306119429755a7bfd73b953c01dc">pcilib_timeout_t</a>&#160;</td>
          <td class="paramname"><em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>wrsize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pushes new data to the DMA engine. </p>
<p >The actual behavior is implementation dependent. The successful exit does not mean what all data have reached hardware, but only guarantees that it is stored in DMA buffers and the hardware is instructed to start reading buffers. The function may return <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca827d3ff095354b8776d2274c82e70536">PCILIB_ERROR_TIMEOUT</a> is all DMA buffers are occupied and no buffers is read by the hardware within the specified timeout. Even if an error is returned, part of the data may be already send to DMA and can't be revoked back. Number of actually written bytes is always returned in the <code>wrsize</code>.</p>
<p >The function is process- and thread-safe. The <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60cae16e1bf6797a9883778d310ed58d15f4">PCILIB_ERROR_BUSY</a> will be returned immediately if DMA is used by another thread or process.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dma</td><td>- ID of DMA engine, the ID should first be resolved using <a class="el" href="group__public__api__dma.html#ga5a92b6019a460bc8809bd270f6d2a845" title="This function resolves the ID of DMA engine from its address and direction.">pcilib_find_dma_by_addr()</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">addr</td><td>- instructs DMA to start writting at the specified address (not supported by existing DMA engines) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>- specifies how many bytes should be written </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>- Various flags controlling the function behavior<ul>
<li><a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4a8800e20820becd8acf383e52bd5a560c" title="last buffer of the packet">PCILIB_DMA_FLAG_EOP</a> indicates that this is the last data in the DMA packet</li>
<li><a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4a2524a8aaea4bb6ad0809bc7d4f8ba0bc" title="wait completion of write operation / wait for data during read operation">PCILIB_DMA_FLAG_WAIT</a> requires function to block until the data actually reach hardware. <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca827d3ff095354b8776d2274c82e70536">PCILIB_ERROR_TIMEOUT</a> may be returned if it takes longer when the specified timeout. </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">timeout</td><td>- specifies number of microseconds to wait before reporting timeout, special values <a class="el" href="pcilib_8h.html#a166dd3b3c2d265ec0c88cf5ed001b511">PCILIB_TIMEOUT_IMMEDIATE</a> and <a class="el" href="pcilib_8h.html#a01c9c2fd95e634fde53208e3d27ccd84">PCILIB_TIMEOUT_INFINITE</a> are supported. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">buf</td><td>- the buffer with the data </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">wrsize</td><td>- number of bytes which were actually written. The correct value will be reported in both case if function has finished successfully or if error has happened. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- error code or 0 on success. In both cases some data may be written to the DMA, check <code>wrsize</code>. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  318</span>                                                                                                                                                                         {</div>
<div class="line"><span class="lineno">  319</span>    <span class="keywordtype">int</span> err;</div>
<div class="line"><span class="lineno">  320</span> </div>
<div class="line"><span class="lineno">  321</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structpcilib__dma__description__t.html">pcilib_dma_description_t</a> *info =  <a class="code hl_function" href="dma_8c.html#aa237b49d303aabd58d8fc320915aa32c">pcilib_get_dma_description</a>(ctx);</div>
<div class="line"><span class="lineno">  322</span>    <span class="keywordflow">if</span> (!info) {</div>
<div class="line"><span class="lineno">  323</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;DMA is not supported by the device&quot;</span>);</div>
<div class="line"><span class="lineno">  324</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caf5392ef1a23835f44ebfe662e3d2988c">PCILIB_ERROR_NOTSUPPORTED</a>;</div>
<div class="line"><span class="lineno">  325</span>    }</div>
<div class="line"><span class="lineno">  326</span> </div>
<div class="line"><span class="lineno">  327</span>    <span class="keywordflow">if</span> (!info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">api</a>) {</div>
<div class="line"><span class="lineno">  328</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;DMA Engine is not configured in the current model&quot;</span>);</div>
<div class="line"><span class="lineno">  329</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca2c7b7e157ef8c29a7d1d0e808acf0a4c">PCILIB_ERROR_NOTAVAILABLE</a>;</div>
<div class="line"><span class="lineno">  330</span>    }</div>
<div class="line"><span class="lineno">  331</span>    </div>
<div class="line"><span class="lineno">  332</span>    <span class="keywordflow">if</span> (!info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">api</a>-&gt;<a class="code hl_variable" href="structpcilib__dma__api__description__t.html#ad026e8b6fe49f952d16ccc03f68e074d">push</a>) {</div>
<div class="line"><span class="lineno">  333</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;The DMA write is not supported by configured DMA engine&quot;</span>);</div>
<div class="line"><span class="lineno">  334</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caf5392ef1a23835f44ebfe662e3d2988c">PCILIB_ERROR_NOTSUPPORTED</a>;</div>
<div class="line"><span class="lineno">  335</span>    }</div>
<div class="line"><span class="lineno">  336</span>    </div>
<div class="line"><span class="lineno">  337</span>            <span class="comment">// DS: We should check we don&#39;t exceed allocated engine range</span></div>
<div class="line"><span class="lineno">  338</span>    <span class="keywordflow">if</span> (!info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#abd61b0b1a1de7d1923d86df4e3a2239c">engines</a>[dma].<a class="code hl_variable" href="structpcilib__dma__engine__description__t.html#a6eb5a7474384fc0ce8ee80d50a048ede">addr_bits</a>) {</div>
<div class="line"><span class="lineno">  339</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;The DMA engine (%i) is not supported by device&quot;</span>, dma);</div>
<div class="line"><span class="lineno">  340</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca2c7b7e157ef8c29a7d1d0e808acf0a4c">PCILIB_ERROR_NOTAVAILABLE</a>;</div>
<div class="line"><span class="lineno">  341</span>    }</div>
<div class="line"><span class="lineno">  342</span> </div>
<div class="line"><span class="lineno">  343</span>    <span class="keywordflow">if</span> ((info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#abd61b0b1a1de7d1923d86df4e3a2239c">engines</a>[dma].<a class="code hl_variable" href="structpcilib__dma__engine__description__t.html#a910472c4dc812f8206935c031356200b">direction</a>&amp;<a class="code hl_enumvalue" href="pcilib_8h.html#aae456a435ae9c105b192cb4d35a49b01a66f563960ba12702a19bfefc00c40b47">PCILIB_DMA_TO_DEVICE</a>) == 0) {</div>
<div class="line"><span class="lineno">  344</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;The selected engine (%i) is C2S-only and does not support writes&quot;</span>, dma);</div>
<div class="line"><span class="lineno">  345</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caf5392ef1a23835f44ebfe662e3d2988c">PCILIB_ERROR_NOTSUPPORTED</a>;</div>
<div class="line"><span class="lineno">  346</span>    }</div>
<div class="line"><span class="lineno">  347</span> </div>
<div class="line"><span class="lineno">  348</span>    err = <a class="code hl_function" href="lock_8c.html#aede6140571a9d717300d31e0fd8079ee">pcilib_try_lock</a>(ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a41aa83dedb03a1021ea2e23604da3aaa">dma_wlock</a>[dma]);</div>
<div class="line"><span class="lineno">  349</span>    <span class="keywordflow">if</span> (err) {</div>
<div class="line"><span class="lineno">  350</span>        <span class="keywordflow">if</span> (err == <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60cae16e1bf6797a9883778d310ed58d15f4">PCILIB_ERROR_BUSY</a>) </div>
<div class="line"><span class="lineno">  351</span>            <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;DMA engine (%i) is busy&quot;</span>, dma);</div>
<div class="line"><span class="lineno">  352</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  353</span>            <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;Error (%i) locking DMA engine (%i)&quot;</span>, err, dma);</div>
<div class="line"><span class="lineno">  354</span> </div>
<div class="line"><span class="lineno">  355</span>        <span class="keywordflow">return</span> err;</div>
<div class="line"><span class="lineno">  356</span>    }</div>
<div class="line"><span class="lineno">  357</span> </div>
<div class="line"><span class="lineno">  358</span>    err = info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">api</a>-&gt;<a class="code hl_variable" href="structpcilib__dma__api__description__t.html#ad026e8b6fe49f952d16ccc03f68e074d">push</a>(ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a81fc504bd03023f6d2a2f22fd2ee58ca">dma_ctx</a>, dma, addr, size, flags, timeout, buf, written);</div>
<div class="line"><span class="lineno">  359</span> </div>
<div class="line"><span class="lineno">  360</span>    <a class="code hl_function" href="lock_8c.html#a770c0ece9679b9b2589bd773b8cfb70e">pcilib_unlock</a>(ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a41aa83dedb03a1021ea2e23604da3aaa">dma_wlock</a>[dma]);</div>
<div class="line"><span class="lineno">  361</span> </div>
<div class="line"><span class="lineno">  362</span>    <span class="keywordflow">return</span> err;</div>
<div class="line"><span class="lineno">  363</span>}</div>
<div class="ttc" id="aerror_8h_html_a0c59f7091fd2446121868635aca9e60ca2c7b7e157ef8c29a7d1d0e808acf0a4c"><div class="ttname"><a href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca2c7b7e157ef8c29a7d1d0e808acf0a4c">PCILIB_ERROR_NOTAVAILABLE</a></div><div class="ttdeci">@ PCILIB_ERROR_NOTAVAILABLE</div><div class="ttdef"><b>Definition:</b> error.h:27</div></div>
<div class="ttc" id="aerror_8h_html_a0c59f7091fd2446121868635aca9e60cae16e1bf6797a9883778d310ed58d15f4"><div class="ttname"><a href="error_8h.html#a0c59f7091fd2446121868635aca9e60cae16e1bf6797a9883778d310ed58d15f4">PCILIB_ERROR_BUSY</a></div><div class="ttdeci">@ PCILIB_ERROR_BUSY</div><div class="ttdef"><b>Definition:</b> error.h:32</div></div>
<div class="ttc" id="alock_8c_html_a770c0ece9679b9b2589bd773b8cfb70e"><div class="ttname"><a href="lock_8c.html#a770c0ece9679b9b2589bd773b8cfb70e">pcilib_unlock</a></div><div class="ttdeci">void pcilib_unlock(pcilib_lock_t *lock)</div><div class="ttdoc">this function unlocks the lock pointed by lock</div><div class="ttdef"><b>Definition:</b> lock.c:197</div></div>
<div class="ttc" id="alock_8c_html_aede6140571a9d717300d31e0fd8079ee"><div class="ttname"><a href="lock_8c.html#aede6140571a9d717300d31e0fd8079ee">pcilib_try_lock</a></div><div class="ttdeci">int pcilib_try_lock(pcilib_lock_t *lock)</div><div class="ttdoc">this function will try to take a lock for the mutex pointed by lockfunction to acquire a lock,...</div><div class="ttdef"><b>Definition:</b> lock.c:193</div></div>
<div class="ttc" id="apcilib_8h_html_aae456a435ae9c105b192cb4d35a49b01a66f563960ba12702a19bfefc00c40b47"><div class="ttname"><a href="pcilib_8h.html#aae456a435ae9c105b192cb4d35a49b01a66f563960ba12702a19bfefc00c40b47">PCILIB_DMA_TO_DEVICE</a></div><div class="ttdeci">@ PCILIB_DMA_TO_DEVICE</div><div class="ttdef"><b>Definition:</b> pcilib.h:80</div></div>
<div class="ttc" id="astructpcilib__dma__api__description__t_html_ad026e8b6fe49f952d16ccc03f68e074d"><div class="ttname"><a href="structpcilib__dma__api__description__t.html#ad026e8b6fe49f952d16ccc03f68e074d">pcilib_dma_api_description_t::push</a></div><div class="ttdeci">int(* push)(pcilib_dma_context_t *ctx, pcilib_dma_engine_t dma, uintptr_t addr, size_t size, pcilib_dma_flags_t flags, pcilib_timeout_t timeout, void *buf, size_t *written)</div><div class="ttdef"><b>Definition:</b> dma.h:67</div></div>
<div class="ttc" id="astructpcilib__s_html_a41aa83dedb03a1021ea2e23604da3aaa"><div class="ttname"><a href="structpcilib__s.html#a41aa83dedb03a1021ea2e23604da3aaa">pcilib_s::dma_wlock</a></div><div class="ttdeci">pcilib_lock_t * dma_wlock[PCILIB_MAX_DMA_ENGINES]</div><div class="ttdoc">Per-engine locks to serialize write operations.</div><div class="ttdef"><b>Definition:</b> pci.h:102</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__dma__engine__description__t.html#a6eb5a7474384fc0ce8ee80d50a048ede">pcilib_dma_engine_description_t::addr_bits</a>, <a class="el" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">pcilib_dma_description_t::api</a>, <a class="el" href="structpcilib__dma__engine__description__t.html#a910472c4dc812f8206935c031356200b">pcilib_dma_engine_description_t::direction</a>, <a class="el" href="structpcilib__s.html#a81fc504bd03023f6d2a2f22fd2ee58ca">pcilib_s::dma_ctx</a>, <a class="el" href="structpcilib__s.html#a41aa83dedb03a1021ea2e23604da3aaa">pcilib_s::dma_wlock</a>, <a class="el" href="structpcilib__dma__description__t.html#abd61b0b1a1de7d1923d86df4e3a2239c">pcilib_dma_description_t::engines</a>, <a class="el" href="pcilib_8h.html#aae456a435ae9c105b192cb4d35a49b01a66f563960ba12702a19bfefc00c40b47">PCILIB_DMA_TO_DEVICE</a>, <a class="el" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60cae16e1bf6797a9883778d310ed58d15f4">PCILIB_ERROR_BUSY</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca2c7b7e157ef8c29a7d1d0e808acf0a4c">PCILIB_ERROR_NOTAVAILABLE</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caf5392ef1a23835f44ebfe662e3d2988c">PCILIB_ERROR_NOTSUPPORTED</a>, <a class="el" href="dma_8c.html#aa237b49d303aabd58d8fc320915aa32c">pcilib_get_dma_description()</a>, <a class="el" href="lock_8c.html#aede6140571a9d717300d31e0fd8079ee">pcilib_try_lock()</a>, <a class="el" href="lock_8c.html#a770c0ece9679b9b2589bd773b8cfb70e">pcilib_unlock()</a>, and <a class="el" href="structpcilib__dma__api__description__t.html#ad026e8b6fe49f952d16ccc03f68e074d">pcilib_dma_api_description_t::push</a>.</p>

<p class="reference">Referenced by <a class="el" href="group__public__api__dma.html#gac85698e9e7185da357cce361d62a6840">pcilib_write_dma()</a>.</p>

</div>
</div>
<a id="ga048d13d66977bb839d3c53952b70c25c" name="ga048d13d66977bb839d3c53952b70c25c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga048d13d66977bb839d3c53952b70c25c">&#9670;&#160;</a></span>pcilib_read_dma()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pcilib_read_dma </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a>&#160;</td>
          <td class="paramname"><em>dma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uintptr_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>rdsize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads data from DMA until timeout is hit, a full DMA packet is read, or the specified number of bytes are read. </p>
<p >Please, check detailed explanation when reading is stopped in the description of <a class="el" href="group__public__api__dma.html#ga4aa78c7c5fd9996087311fc21bd7ccd5" title="Reads data from DMA until timeout is hit, a full DMA packet is read, or the specified number of bytes...">pcilib_read_dma_custom()</a>. The function is process- and thread-safe. The <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60cae16e1bf6797a9883778d310ed58d15f4">PCILIB_ERROR_BUSY</a> will be returned immediately if DMA is used by another thread or process.</p>
<p >The function actually executes the <a class="el" href="group__public__api__dma.html#ga4aa78c7c5fd9996087311fc21bd7ccd5" title="Reads data from DMA until timeout is hit, a full DMA packet is read, or the specified number of bytes...">pcilib_read_dma_custom()</a> without special flags and with default DMA timeout</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dma</td><td>- ID of DMA engine, the ID should first be resolved using <a class="el" href="group__public__api__dma.html#ga5a92b6019a460bc8809bd270f6d2a845" title="This function resolves the ID of DMA engine from its address and direction.">pcilib_find_dma_by_addr()</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">addr</td><td>- instructs DMA to start reading at the specified address (not supported by existing DMA engines) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>- specifies how many bytes should be read </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">buf</td><td>- the buffer of <em>size</em> bytes long to store the data </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rdsize</td><td>- number of bytes which were actually read. The correct value will be reported in both case if function has finished successfully or if error has happened. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- error code or 0 on success. In both cases some data may be returned in the buffer, check <code>rdsize</code>. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  284</span>                                                                                                                        {</div>
<div class="line"><span class="lineno">  285</span>    <span class="keywordtype">int</span> err; </div>
<div class="line"><span class="lineno">  286</span> </div>
<div class="line"><span class="lineno">  287</span>    <a class="code hl_struct" href="structpcilib__dma__read__callback__context__t.html">pcilib_dma_read_callback_context_t</a> opts = {</div>
<div class="line"><span class="lineno">  288</span>        size, buf, 0, 0</div>
<div class="line"><span class="lineno">  289</span>    };</div>
<div class="line"><span class="lineno">  290</span>    </div>
<div class="line"><span class="lineno">  291</span>    err = <a class="code hl_function" href="group__public__api__dma.html#ga500ad5dc629d20579e83f0df44162bb6">pcilib_stream_dma</a>(ctx, dma, addr, size, <a class="code hl_define" href="pcilib_8h.html#a66920239f7063e6444e74d54eb57b70b">PCILIB_DMA_FLAGS_DEFAULT</a>, <a class="code hl_define" href="pci_8h.html#af49018029da7ba023b6d96fc97b4e0be">PCILIB_DMA_TIMEOUT</a>, pcilib_dma_read_callback, &amp;opts);</div>
<div class="line"><span class="lineno">  292</span>    <span class="keywordflow">if</span> (read_bytes) *read_bytes = opts.<a class="code hl_variable" href="structpcilib__dma__read__callback__context__t.html#a87dfc3f348dfcb8e1a40c7220a92043a">pos</a>;</div>
<div class="line"><span class="lineno">  293</span>    <span class="keywordflow">return</span> err;</div>
<div class="line"><span class="lineno">  294</span>}</div>
<div class="ttc" id="agroup__public__api__dma_html_ga500ad5dc629d20579e83f0df44162bb6"><div class="ttname"><a href="group__public__api__dma.html#ga500ad5dc629d20579e83f0df44162bb6">pcilib_stream_dma</a></div><div class="ttdeci">int pcilib_stream_dma(pcilib_t *ctx, pcilib_dma_engine_t dma, uintptr_t addr, size_t size, pcilib_dma_flags_t flags, pcilib_timeout_t timeout, pcilib_dma_callback_t cb, void *cbattr)</div><div class="ttdoc">Reads data from DMA buffers and pass it to the specified callback function.</div><div class="ttdef"><b>Definition:</b> dma.c:226</div></div>
<div class="ttc" id="apci_8h_html_af49018029da7ba023b6d96fc97b4e0be"><div class="ttname"><a href="pci_8h.html#af49018029da7ba023b6d96fc97b4e0be">PCILIB_DMA_TIMEOUT</a></div><div class="ttdeci">#define PCILIB_DMA_TIMEOUT</div><div class="ttdoc">us</div><div class="ttdef"><b>Definition:</b> pci.h:7</div></div>
<div class="ttc" id="apcilib_8h_html_a66920239f7063e6444e74d54eb57b70b"><div class="ttname"><a href="pcilib_8h.html#a66920239f7063e6444e74d54eb57b70b">PCILIB_DMA_FLAGS_DEFAULT</a></div><div class="ttdeci">#define PCILIB_DMA_FLAGS_DEFAULT</div><div class="ttdef"><b>Definition:</b> pcilib.h:188</div></div>
<div class="ttc" id="astructpcilib__dma__read__callback__context__t_html"><div class="ttname"><a href="structpcilib__dma__read__callback__context__t.html">pcilib_dma_read_callback_context_t</a></div><div class="ttdef"><b>Definition:</b> dma.c:183</div></div>
<div class="ttc" id="astructpcilib__dma__read__callback__context__t_html_a87dfc3f348dfcb8e1a40c7220a92043a"><div class="ttname"><a href="structpcilib__dma__read__callback__context__t.html#a87dfc3f348dfcb8e1a40c7220a92043a">pcilib_dma_read_callback_context_t::pos</a></div><div class="ttdeci">size_t pos</div><div class="ttdef"><b>Definition:</b> dma.c:186</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="pcilib_8h.html#a66920239f7063e6444e74d54eb57b70b">PCILIB_DMA_FLAGS_DEFAULT</a>, <a class="el" href="pci_8h.html#af49018029da7ba023b6d96fc97b4e0be">PCILIB_DMA_TIMEOUT</a>, <a class="el" href="group__public__api__dma.html#ga500ad5dc629d20579e83f0df44162bb6">pcilib_stream_dma()</a>, and <a class="el" href="structpcilib__dma__read__callback__context__t.html#a87dfc3f348dfcb8e1a40c7220a92043a">pcilib_dma_read_callback_context_t::pos</a>.</p>

</div>
</div>
<a id="ga4aa78c7c5fd9996087311fc21bd7ccd5" name="ga4aa78c7c5fd9996087311fc21bd7ccd5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4aa78c7c5fd9996087311fc21bd7ccd5">&#9670;&#160;</a></span>pcilib_read_dma_custom()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pcilib_read_dma_custom </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a>&#160;</td>
          <td class="paramname"><em>dma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uintptr_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4">pcilib_dma_flags_t</a>&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#a1d84306119429755a7bfd73b953c01dc">pcilib_timeout_t</a>&#160;</td>
          <td class="paramname"><em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>rdsize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads data from DMA until timeout is hit, a full DMA packet is read, or the specified number of bytes are read. </p>
<p >The function is process- and thread-safe. The <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60cae16e1bf6797a9883778d310ed58d15f4">PCILIB_ERROR_BUSY</a> will be returned immediately if DMA is used by another thread or process.</p>
<p >We can't read arbitrary number of bytes from DMA. A full DMA packet is always read. The DMA packet is not equal to DMA buffer, but may consist of multiple buffers and the size may vary during run time. This may cause problems if not treated properly. While the number of actually read bytes is bellow the specified size, the function may continue to read the data. But as the new packet is started, it should fit completely in the provided buffer space or PCILIB_ERROR_TOOBIG error will be returned. Therefore, it is a good practice to read only a single packet at once and provide buffer capable to store the larges possible packet.</p>
<p >Unless <a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4ae1b888fe12684243adea67c4673f457b" title="read multiple packets">PCILIB_DMA_FLAG_MULTIPACKET</a> flag is specified, the function will stop after the first full packet is read. Otherwise, the reading will continue until all <code>size</code> bytes are read or timeout is hit. The stanard DMA timeout should be met while reading DMA buffers belonging to the same packet. Otherwise, PCILIB_ERROR_TIMEOUT is returned and number of bytes read so far is returned in the <code>rdsize</code>. If <a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4a2524a8aaea4bb6ad0809bc7d4f8ba0bc" title="wait completion of write operation / wait for data during read operation">PCILIB_DMA_FLAG_WAIT</a> flag is specified, the number of microseconds specified in the <code>timeout</code> parameter are allowed for a new packet to come. If no new data arrived in the specified timeout, the function returns successfuly and number of read bytes is returned in the <code>rdsize</code>.</p>
<p >We can't put the read data back into the DMA. Therefore, even in the case of error some data may be returned. The number of actually read bytes is always reported in <code>rdsize</code> and the specified amount of data is always written to the provided buffer.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dma</td><td>- ID of DMA engine, the ID should first be resolved using <a class="el" href="group__public__api__dma.html#ga5a92b6019a460bc8809bd270f6d2a845" title="This function resolves the ID of DMA engine from its address and direction.">pcilib_find_dma_by_addr()</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">addr</td><td>- instructs DMA to start reading at the specified address (not supported by existing DMA engines) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>- specifies how many bytes should be read </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>- Various flags controlling the function behavior<ul>
<li><a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4ae1b888fe12684243adea67c4673f457b" title="read multiple packets">PCILIB_DMA_FLAG_MULTIPACKET</a> indicates that multiple DMA packets will be read (not recommended, use <a class="el" href="group__public__api__dma.html#ga500ad5dc629d20579e83f0df44162bb6" title="Reads data from DMA buffers and pass it to the specified callback function.">pcilib_stream_dma()</a> in this case)</li>
<li><a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4a2524a8aaea4bb6ad0809bc7d4f8ba0bc" title="wait completion of write operation / wait for data during read operation">PCILIB_DMA_FLAG_WAIT</a> indicates that we need to wait the specified timeout between consequitive DMA packets (default DMA timeout is used otherwise) </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">timeout</td><td>- specifies number of microseconds to wait before reporting timeout, special values <a class="el" href="pcilib_8h.html#a166dd3b3c2d265ec0c88cf5ed001b511">PCILIB_TIMEOUT_IMMEDIATE</a> and <a class="el" href="pcilib_8h.html#a01c9c2fd95e634fde53208e3d27ccd84">PCILIB_TIMEOUT_INFINITE</a> are supported. This parameter specifies timeout between consequtive DMA packets, the standard DMA timeout is expected between buffers belonging to the same DMA packet. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">buf</td><td>- the buffer of <em>size</em> bytes long to store the data </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">rdsize</td><td>- number of bytes which were actually read. The correct value will be reported in both case if function has finished successfully or if error has happened. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- error code or 0 on success. In both cases some data may be returned in the buffer, check <code>rdsize</code>. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  272</span>                                                                                                                                                                                   {</div>
<div class="line"><span class="lineno">  273</span>    <span class="keywordtype">int</span> err; </div>
<div class="line"><span class="lineno">  274</span> </div>
<div class="line"><span class="lineno">  275</span>    <a class="code hl_struct" href="structpcilib__dma__read__callback__context__t.html">pcilib_dma_read_callback_context_t</a> opts = {</div>
<div class="line"><span class="lineno">  276</span>        size, buf, 0, flags</div>
<div class="line"><span class="lineno">  277</span>    };</div>
<div class="line"><span class="lineno">  278</span>    </div>
<div class="line"><span class="lineno">  279</span>    err = <a class="code hl_function" href="group__public__api__dma.html#ga500ad5dc629d20579e83f0df44162bb6">pcilib_stream_dma</a>(ctx, dma, addr, size, flags, timeout, pcilib_dma_read_callback, &amp;opts);</div>
<div class="line"><span class="lineno">  280</span>    <span class="keywordflow">if</span> (read_bytes) *read_bytes = opts.<a class="code hl_variable" href="structpcilib__dma__read__callback__context__t.html#a87dfc3f348dfcb8e1a40c7220a92043a">pos</a>;</div>
<div class="line"><span class="lineno">  281</span>    <span class="keywordflow">return</span> err;</div>
<div class="line"><span class="lineno">  282</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="group__public__api__dma.html#ga500ad5dc629d20579e83f0df44162bb6">pcilib_stream_dma()</a>, and <a class="el" href="structpcilib__dma__read__callback__context__t.html#a87dfc3f348dfcb8e1a40c7220a92043a">pcilib_dma_read_callback_context_t::pos</a>.</p>

</div>
</div>
<a id="ga862942eecc274b76d22dea30bce65a0e" name="ga862942eecc274b76d22dea30bce65a0e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga862942eecc274b76d22dea30bce65a0e">&#9670;&#160;</a></span>pcilib_skip_dma()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pcilib_skip_dma </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a>&#160;</td>
          <td class="paramname"><em>dma</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Tries to drop all pending data in the DMA channel. </p>
<p >It will drop not only data currently in the DMA buffers, but will allow hardware to write more and will drop the newly written data as well. The standard DMA timeout is allowed to receive new data. If hardware continuously writes data, after <a class="el" href="pci_8h.html#a3f6d7e7d5b472d9e1ac028016c8e81eb" title="us">PCILIB_DMA_SKIP_TIMEOUT</a> microseconds the function will exit with <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca827d3ff095354b8776d2274c82e70536">PCILIB_ERROR_TIMEOUT</a> error.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dma</td><td>- ID of DMA engine, the ID should first be resolved using <a class="el" href="group__public__api__dma.html#ga5a92b6019a460bc8809bd270f6d2a845" title="This function resolves the ID of DMA engine from its address and direction.">pcilib_find_dma_by_addr()</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- error code or 0 on success </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  297</span>                                                            {</div>
<div class="line"><span class="lineno">  298</span>    <span class="keywordtype">int</span> err;</div>
<div class="line"><span class="lineno">  299</span>    <span class="keyword">struct </span>timeval tv, cur;</div>
<div class="line"><span class="lineno">  300</span> </div>
<div class="line"><span class="lineno">  301</span>    gettimeofday(&amp;tv, NULL);</div>
<div class="line"><span class="lineno">  302</span>    tv.tv_usec += <a class="code hl_define" href="pci_8h.html#a3f6d7e7d5b472d9e1ac028016c8e81eb">PCILIB_DMA_SKIP_TIMEOUT</a>;</div>
<div class="line"><span class="lineno">  303</span>    tv.tv_sec += tv.tv_usec / 1000000;</div>
<div class="line"><span class="lineno">  304</span>    tv.tv_usec += tv.tv_usec % 1000000;</div>
<div class="line"><span class="lineno">  305</span>    </div>
<div class="line"><span class="lineno">  306</span>    <span class="keywordflow">do</span> {</div>
<div class="line"><span class="lineno">  307</span>            <span class="comment">// IMMEDIATE timeout is not working properly, so default is set</span></div>
<div class="line"><span class="lineno">  308</span>        err = <a class="code hl_function" href="group__public__api__dma.html#ga500ad5dc629d20579e83f0df44162bb6">pcilib_stream_dma</a>(ctx, dma, 0, 0, <a class="code hl_define" href="pcilib_8h.html#a66920239f7063e6444e74d54eb57b70b">PCILIB_DMA_FLAGS_DEFAULT</a>, <a class="code hl_define" href="pci_8h.html#af49018029da7ba023b6d96fc97b4e0be">PCILIB_DMA_TIMEOUT</a>, pcilib_dma_skip_callback, &amp;tv);</div>
<div class="line"><span class="lineno">  309</span>        gettimeofday(&amp;cur, NULL);</div>
<div class="line"><span class="lineno">  310</span>    } <span class="keywordflow">while</span> ((!err)&amp;&amp;((cur.tv_sec &lt; tv.tv_sec)||((cur.tv_sec == tv.tv_sec)&amp;&amp;(cur.tv_usec &lt; tv.tv_usec))));</div>
<div class="line"><span class="lineno">  311</span> </div>
<div class="line"><span class="lineno">  312</span>    <span class="keywordflow">if</span> ((cur.tv_sec &gt; tv.tv_sec)||((cur.tv_sec == tv.tv_sec)&amp;&amp;(cur.tv_usec &gt; tv.tv_usec))) <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca827d3ff095354b8776d2274c82e70536">PCILIB_ERROR_TIMEOUT</a>;</div>
<div class="line"><span class="lineno">  313</span>    </div>
<div class="line"><span class="lineno">  314</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  315</span>}</div>
<div class="ttc" id="aerror_8h_html_a0c59f7091fd2446121868635aca9e60ca827d3ff095354b8776d2274c82e70536"><div class="ttname"><a href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca827d3ff095354b8776d2274c82e70536">PCILIB_ERROR_TIMEOUT</a></div><div class="ttdeci">@ PCILIB_ERROR_TIMEOUT</div><div class="ttdef"><b>Definition:</b> error.h:21</div></div>
<div class="ttc" id="apci_8h_html_a3f6d7e7d5b472d9e1ac028016c8e81eb"><div class="ttname"><a href="pci_8h.html#a3f6d7e7d5b472d9e1ac028016c8e81eb">PCILIB_DMA_SKIP_TIMEOUT</a></div><div class="ttdeci">#define PCILIB_DMA_SKIP_TIMEOUT</div><div class="ttdoc">us</div><div class="ttdef"><b>Definition:</b> pci.h:8</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="pcilib_8h.html#a66920239f7063e6444e74d54eb57b70b">PCILIB_DMA_FLAGS_DEFAULT</a>, <a class="el" href="pci_8h.html#a3f6d7e7d5b472d9e1ac028016c8e81eb">PCILIB_DMA_SKIP_TIMEOUT</a>, <a class="el" href="pci_8h.html#af49018029da7ba023b6d96fc97b4e0be">PCILIB_DMA_TIMEOUT</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca827d3ff095354b8776d2274c82e70536">PCILIB_ERROR_TIMEOUT</a>, and <a class="el" href="group__public__api__dma.html#ga500ad5dc629d20579e83f0df44162bb6">pcilib_stream_dma()</a>.</p>

</div>
</div>
<a id="ga3acfaf4ab317d091c72c85bfd9bdde3d" name="ga3acfaf4ab317d091c72c85bfd9bdde3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3acfaf4ab317d091c72c85bfd9bdde3d">&#9670;&#160;</a></span>pcilib_start_dma()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pcilib_start_dma </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a>&#160;</td>
          <td class="paramname"><em>dma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4">pcilib_dma_flags_t</a>&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Starts DMA engine. </p>
<p >This call will allocate DMA buffers and pass their bus addresses to the hardware.</p><ul>
<li>During the call, the C2S engine may start writting data. The written buffers are marked as ready and can be read-out using <a class="el" href="group__public__api__dma.html#ga500ad5dc629d20579e83f0df44162bb6" title="Reads data from DMA buffers and pass it to the specified callback function.">pcilib_stream_dma()</a> and <a class="el" href="group__public__api__dma.html#ga048d13d66977bb839d3c53952b70c25c" title="Reads data from DMA until timeout is hit, a full DMA packet is read, or the specified number of bytes...">pcilib_read_dma()</a> calls. If no empty buffers left, the C2S DMA engine will stall until some buffers are read out.</li>
<li>The S2C engine waits until the data is pushed with pcilib_push_data() call</li>
</ul>
<p >After <a class="el" href="group__public__api__dma.html#ga3acfaf4ab317d091c72c85bfd9bdde3d" title="Starts DMA engine.">pcilib_start_dma()</a> call, the <a class="el" href="group__public__api__dma.html#ga45f2c71c921c37da3a57fdab8c675490" title="Stops DMA engine or just cleans up the process-specific memory buffers (see pcilib_start_dma() for de...">pcilib_stop_dma()</a> function should be necessarily called. However, it will clean up the process memory, but only in some cases actually stop the DMA engine. This depends on <em>flags</em> passed to both <a class="el" href="group__public__api__dma.html#ga3acfaf4ab317d091c72c85bfd9bdde3d" title="Starts DMA engine.">pcilib_start_dma()</a> and <a class="el" href="group__public__api__dma.html#ga45f2c71c921c37da3a57fdab8c675490" title="Stops DMA engine or just cleans up the process-specific memory buffers (see pcilib_start_dma() for de...">pcilib_stop_dma()</a> calls. if PCILIB_DMA_FLAG_PERSISTENT flag is passed to the <a class="el" href="group__public__api__dma.html#ga3acfaf4ab317d091c72c85bfd9bdde3d" title="Starts DMA engine.">pcilib_start_dma()</a>, the DMA engine will remain running unless the same flag is also passed to the <a class="el" href="group__public__api__dma.html#ga45f2c71c921c37da3a57fdab8c675490" title="Stops DMA engine or just cleans up the process-specific memory buffers (see pcilib_start_dma() for de...">pcilib_stop_dma()</a> call. The allocated DMA buffers will stay intact and the hardware may continue reading / writting data while there is space/data left. However, the other functions of DMA API should not be called after <a class="el" href="group__public__api__dma.html#ga45f2c71c921c37da3a57fdab8c675490" title="Stops DMA engine or just cleans up the process-specific memory buffers (see pcilib_start_dma() for de...">pcilib_stop_dma()</a> until new <a class="el" href="group__public__api__dma.html#ga3acfaf4ab317d091c72c85bfd9bdde3d" title="Starts DMA engine.">pcilib_start_dma()</a> call is issued.</p>
<p >The process- and thread-safety is implementation depedent. However, currently the process- safety is ensured while accessing the kernel memory (todo: this may get complicated if we provide a way to perform DMA directly to the user-supplied pages). The thread-safety is not provided by currently implemented DMA engines. The DMA functions may be called from multiple threads, but it is user responsibility to ensure that only a single DMA-related call is running. On other hand, the DMA and register APIs may be used in parallel.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dma</td><td>- ID of DMA engine, the ID should first be resolved using <a class="el" href="group__public__api__dma.html#ga5a92b6019a460bc8809bd270f6d2a845" title="This function resolves the ID of DMA engine from its address and direction.">pcilib_find_dma_by_addr()</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>- PCILIB_DMA_FLAG_PERSISTENT indicates that engine should be kept running after <a class="el" href="group__public__api__dma.html#ga45f2c71c921c37da3a57fdab8c675490" title="Stops DMA engine or just cleans up the process-specific memory buffers (see pcilib_start_dma() for de...">pcilib_stop_dma()</a> call </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- error code or 0 on success </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  120</span>                                                                                       {</div>
<div class="line"><span class="lineno">  121</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structpcilib__dma__description__t.html">pcilib_dma_description_t</a> *info =  <a class="code hl_function" href="dma_8c.html#aa237b49d303aabd58d8fc320915aa32c">pcilib_get_dma_description</a>(ctx);</div>
<div class="line"><span class="lineno">  122</span>    <span class="keywordflow">if</span> (!info) {</div>
<div class="line"><span class="lineno">  123</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;DMA is not supported by the device&quot;</span>);</div>
<div class="line"><span class="lineno">  124</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caf5392ef1a23835f44ebfe662e3d2988c">PCILIB_ERROR_NOTSUPPORTED</a>;</div>
<div class="line"><span class="lineno">  125</span>    }</div>
<div class="line"><span class="lineno">  126</span> </div>
<div class="line"><span class="lineno">  127</span>    <span class="keywordflow">if</span> (!info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">api</a>) {</div>
<div class="line"><span class="lineno">  128</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;DMA Engine is not configured in the current model&quot;</span>);</div>
<div class="line"><span class="lineno">  129</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca2c7b7e157ef8c29a7d1d0e808acf0a4c">PCILIB_ERROR_NOTAVAILABLE</a>;</div>
<div class="line"><span class="lineno">  130</span>    }</div>
<div class="line"><span class="lineno">  131</span> </div>
<div class="line"><span class="lineno">  132</span>    <span class="keywordflow">if</span> (!info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">api</a>-&gt;<a class="code hl_variable" href="structpcilib__dma__api__description__t.html#a40dc71af410f3cfa9abde305383f29d5">start_dma</a>) {</div>
<div class="line"><span class="lineno">  133</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  134</span>    }</div>
<div class="line"><span class="lineno">  135</span> </div>
<div class="line"><span class="lineno">  136</span>    <span class="keywordflow">return</span> info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">api</a>-&gt;<a class="code hl_variable" href="structpcilib__dma__api__description__t.html#a40dc71af410f3cfa9abde305383f29d5">start_dma</a>(ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a81fc504bd03023f6d2a2f22fd2ee58ca">dma_ctx</a>, dma, flags);</div>
<div class="line"><span class="lineno">  137</span>}</div>
<div class="ttc" id="astructpcilib__dma__api__description__t_html_a40dc71af410f3cfa9abde305383f29d5"><div class="ttname"><a href="structpcilib__dma__api__description__t.html#a40dc71af410f3cfa9abde305383f29d5">pcilib_dma_api_description_t::start_dma</a></div><div class="ttdeci">int(* start_dma)(pcilib_dma_context_t *ctx, pcilib_dma_engine_t dma, pcilib_dma_flags_t flags)</div><div class="ttdef"><b>Definition:</b> dma.h:64</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">pcilib_dma_description_t::api</a>, <a class="el" href="structpcilib__s.html#a81fc504bd03023f6d2a2f22fd2ee58ca">pcilib_s::dma_ctx</a>, <a class="el" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca2c7b7e157ef8c29a7d1d0e808acf0a4c">PCILIB_ERROR_NOTAVAILABLE</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caf5392ef1a23835f44ebfe662e3d2988c">PCILIB_ERROR_NOTSUPPORTED</a>, <a class="el" href="dma_8c.html#aa237b49d303aabd58d8fc320915aa32c">pcilib_get_dma_description()</a>, and <a class="el" href="structpcilib__dma__api__description__t.html#a40dc71af410f3cfa9abde305383f29d5">pcilib_dma_api_description_t::start_dma</a>.</p>

</div>
</div>
<a id="ga45f2c71c921c37da3a57fdab8c675490" name="ga45f2c71c921c37da3a57fdab8c675490"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga45f2c71c921c37da3a57fdab8c675490">&#9670;&#160;</a></span>pcilib_stop_dma()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pcilib_stop_dma </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a>&#160;</td>
          <td class="paramname"><em>dma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4">pcilib_dma_flags_t</a>&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stops DMA engine or just cleans up the process-specific memory buffers (see <a class="el" href="group__public__api__dma.html#ga3acfaf4ab317d091c72c85bfd9bdde3d" title="Starts DMA engine.">pcilib_start_dma()</a> for details). </p>
<p >No DMA API calls allowed after this point until <a class="el" href="group__public__api__dma.html#ga3acfaf4ab317d091c72c85bfd9bdde3d" title="Starts DMA engine.">pcilib_start_dma()</a> is called anew.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dma</td><td>- ID of DMA engine, the ID should first be resolved using <a class="el" href="group__public__api__dma.html#ga5a92b6019a460bc8809bd270f6d2a845" title="This function resolves the ID of DMA engine from its address and direction.">pcilib_find_dma_by_addr()</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>- PCILIB_DMA_FLAG_PERSISTENT indicates that engine should be actually stopped independent of the flags passed to <a class="el" href="group__public__api__dma.html#ga3acfaf4ab317d091c72c85bfd9bdde3d" title="Starts DMA engine.">pcilib_start_dma()</a> call </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- error code or 0 on success </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  139</span>                                                                                      {</div>
<div class="line"><span class="lineno">  140</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structpcilib__dma__description__t.html">pcilib_dma_description_t</a> *info =  <a class="code hl_function" href="dma_8c.html#aa237b49d303aabd58d8fc320915aa32c">pcilib_get_dma_description</a>(ctx);</div>
<div class="line"><span class="lineno">  141</span> </div>
<div class="line"><span class="lineno">  142</span>    <span class="keywordflow">if</span> (!info) {</div>
<div class="line"><span class="lineno">  143</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;DMA is not supported by the device&quot;</span>);</div>
<div class="line"><span class="lineno">  144</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caf5392ef1a23835f44ebfe662e3d2988c">PCILIB_ERROR_NOTSUPPORTED</a>;</div>
<div class="line"><span class="lineno">  145</span>    }</div>
<div class="line"><span class="lineno">  146</span> </div>
<div class="line"><span class="lineno">  147</span>    <span class="keywordflow">if</span> (!info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">api</a>) {</div>
<div class="line"><span class="lineno">  148</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;DMA Engine is not configured in the current model&quot;</span>);</div>
<div class="line"><span class="lineno">  149</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca2c7b7e157ef8c29a7d1d0e808acf0a4c">PCILIB_ERROR_NOTAVAILABLE</a>;</div>
<div class="line"><span class="lineno">  150</span>    }</div>
<div class="line"><span class="lineno">  151</span>    </div>
<div class="line"><span class="lineno">  152</span>    <span class="keywordflow">if</span> (!info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">api</a>-&gt;<a class="code hl_variable" href="structpcilib__dma__api__description__t.html#a98a96d3202c8937105da7be257c9b98d">stop_dma</a>) {</div>
<div class="line"><span class="lineno">  153</span>        <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  154</span>    }</div>
<div class="line"><span class="lineno">  155</span> </div>
<div class="line"><span class="lineno">  156</span>    <span class="keywordflow">return</span> info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">api</a>-&gt;<a class="code hl_variable" href="structpcilib__dma__api__description__t.html#a98a96d3202c8937105da7be257c9b98d">stop_dma</a>(ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a81fc504bd03023f6d2a2f22fd2ee58ca">dma_ctx</a>, dma, flags);</div>
<div class="line"><span class="lineno">  157</span>}</div>
<div class="ttc" id="astructpcilib__dma__api__description__t_html_a98a96d3202c8937105da7be257c9b98d"><div class="ttname"><a href="structpcilib__dma__api__description__t.html#a98a96d3202c8937105da7be257c9b98d">pcilib_dma_api_description_t::stop_dma</a></div><div class="ttdeci">int(* stop_dma)(pcilib_dma_context_t *ctx, pcilib_dma_engine_t dma, pcilib_dma_flags_t flags)</div><div class="ttdef"><b>Definition:</b> dma.h:65</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">pcilib_dma_description_t::api</a>, <a class="el" href="structpcilib__s.html#a81fc504bd03023f6d2a2f22fd2ee58ca">pcilib_s::dma_ctx</a>, <a class="el" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca2c7b7e157ef8c29a7d1d0e808acf0a4c">PCILIB_ERROR_NOTAVAILABLE</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caf5392ef1a23835f44ebfe662e3d2988c">PCILIB_ERROR_NOTSUPPORTED</a>, <a class="el" href="dma_8c.html#aa237b49d303aabd58d8fc320915aa32c">pcilib_get_dma_description()</a>, and <a class="el" href="structpcilib__dma__api__description__t.html#a98a96d3202c8937105da7be257c9b98d">pcilib_dma_api_description_t::stop_dma</a>.</p>

</div>
</div>
<a id="ga500ad5dc629d20579e83f0df44162bb6" name="ga500ad5dc629d20579e83f0df44162bb6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga500ad5dc629d20579e83f0df44162bb6">&#9670;&#160;</a></span>pcilib_stream_dma()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pcilib_stream_dma </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a>&#160;</td>
          <td class="paramname"><em>dma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uintptr_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4">pcilib_dma_flags_t</a>&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#a1d84306119429755a7bfd73b953c01dc">pcilib_timeout_t</a>&#160;</td>
          <td class="paramname"><em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#abb6d717667ef56a1b73b63f1537bfe20">pcilib_dma_callback_t</a>&#160;</td>
          <td class="paramname"><em>cb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>cbattr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reads data from DMA buffers and pass it to the specified callback function. </p>
<p >The return code of the callback function determines if streaming should continue and how much to wait for next data to arrive before triggering timeout. The function is process- and thread-safe. The PCILIB_ERROR_BUSY will be returned immediately if DMA is used by another thread or process.</p>
<p >The function waits the specified <em>timeout</em> microseconds for the first data. Afterwards, the waiting time for next portion of data depends on the last return code <em></em>(ret) from callback function. If <code>ret &amp; PCILIB_STREAMING_TIMEOUT_MASK</code> is</p><ul>
<li>PCILIB_STREAMING_STOP - the streaming stops</li>
<li>PCILIB_STREAMING_CONTINUE - the standard DMA timeout will be used to wait for a new data</li>
<li>PCILIB_STREAMING_WAIT - the timeout specified in the function arguments will be used to wait for a new data</li>
<li>PCILIB_STREAMING_CHECK - the function will return if new data is not available immediately The function return code depends on the return code from the callback as well. If no data received within the specified timeout and no callback is called, the PCILIB_ERROR_TIMEOUT is returned. Otherwise, success is returned unless PCILIB_STREAMING_FAIL flag has been set in the callback return code before the timeout was triggered.</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dma</td><td>- ID of DMA engine, the ID should first be resolved using <a class="el" href="group__public__api__dma.html#ga5a92b6019a460bc8809bd270f6d2a845" title="This function resolves the ID of DMA engine from its address and direction.">pcilib_find_dma_by_addr()</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">addr</td><td>- instructs DMA to start reading at the specified address (not supported by existing DMA engines) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>- instructs DMA to read only <em>size</em> bytes (not supported by existing DMA engines) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>- not used by existing DMA engines </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">timeout</td><td>- specifies number of microseconds to wait before reporting timeout, special values <a class="el" href="pcilib_8h.html#a166dd3b3c2d265ec0c88cf5ed001b511">PCILIB_TIMEOUT_IMMEDIATE</a> and <a class="el" href="pcilib_8h.html#a01c9c2fd95e634fde53208e3d27ccd84">PCILIB_TIMEOUT_INFINITE</a> are supported. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>- callback function to call </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">cbattr</td><td>- passed through as the first parameter of callback function </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- error code or 0 on success </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  226</span>                                                                                                                                                                                       {</div>
<div class="line"><span class="lineno">  227</span>    <span class="keywordtype">int</span> err;</div>
<div class="line"><span class="lineno">  228</span>    <span class="keyword">const</span> <a class="code hl_struct" href="structpcilib__dma__description__t.html">pcilib_dma_description_t</a> *info =  <a class="code hl_function" href="dma_8c.html#aa237b49d303aabd58d8fc320915aa32c">pcilib_get_dma_description</a>(ctx);</div>
<div class="line"><span class="lineno">  229</span>    <span class="keywordflow">if</span> (!info) {</div>
<div class="line"><span class="lineno">  230</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;DMA is not supported by the device&quot;</span>);</div>
<div class="line"><span class="lineno">  231</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caf5392ef1a23835f44ebfe662e3d2988c">PCILIB_ERROR_NOTSUPPORTED</a>;</div>
<div class="line"><span class="lineno">  232</span>    }</div>
<div class="line"><span class="lineno">  233</span> </div>
<div class="line"><span class="lineno">  234</span>    <span class="keywordflow">if</span> (!info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">api</a>) {</div>
<div class="line"><span class="lineno">  235</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;DMA Engine is not configured in the current model&quot;</span>);</div>
<div class="line"><span class="lineno">  236</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca2c7b7e157ef8c29a7d1d0e808acf0a4c">PCILIB_ERROR_NOTAVAILABLE</a>;</div>
<div class="line"><span class="lineno">  237</span>    }</div>
<div class="line"><span class="lineno">  238</span>    </div>
<div class="line"><span class="lineno">  239</span>    <span class="keywordflow">if</span> (!info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">api</a>-&gt;<a class="code hl_variable" href="structpcilib__dma__api__description__t.html#a6f3ffe94febb519e5e14545bc02bd347">stream</a>) {</div>
<div class="line"><span class="lineno">  240</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;The DMA read is not supported by configured DMA engine&quot;</span>);</div>
<div class="line"><span class="lineno">  241</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caf5392ef1a23835f44ebfe662e3d2988c">PCILIB_ERROR_NOTSUPPORTED</a>;</div>
<div class="line"><span class="lineno">  242</span>    }</div>
<div class="line"><span class="lineno">  243</span> </div>
<div class="line"><span class="lineno">  244</span>        <span class="comment">// DS: We should check we are not going outside of allocated engine space</span></div>
<div class="line"><span class="lineno">  245</span>    <span class="keywordflow">if</span> (!info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#abd61b0b1a1de7d1923d86df4e3a2239c">engines</a>[dma].<a class="code hl_variable" href="structpcilib__dma__engine__description__t.html#a6eb5a7474384fc0ce8ee80d50a048ede">addr_bits</a>) {</div>
<div class="line"><span class="lineno">  246</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;The DMA engine (%i) is not supported by device&quot;</span>, dma);</div>
<div class="line"><span class="lineno">  247</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca2c7b7e157ef8c29a7d1d0e808acf0a4c">PCILIB_ERROR_NOTAVAILABLE</a>;</div>
<div class="line"><span class="lineno">  248</span>    }</div>
<div class="line"><span class="lineno">  249</span> </div>
<div class="line"><span class="lineno">  250</span>    <span class="keywordflow">if</span> ((info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#abd61b0b1a1de7d1923d86df4e3a2239c">engines</a>[dma].<a class="code hl_variable" href="structpcilib__dma__engine__description__t.html#a910472c4dc812f8206935c031356200b">direction</a>&amp;<a class="code hl_enumvalue" href="pcilib_8h.html#aae456a435ae9c105b192cb4d35a49b01ae558d58774767d4adaa56de9cf9016aa">PCILIB_DMA_FROM_DEVICE</a>) == 0) {</div>
<div class="line"><span class="lineno">  251</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;The selected engine (%i) is S2C-only and does not support reading&quot;</span>, dma);</div>
<div class="line"><span class="lineno">  252</span>        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caf5392ef1a23835f44ebfe662e3d2988c">PCILIB_ERROR_NOTSUPPORTED</a>;</div>
<div class="line"><span class="lineno">  253</span>    }</div>
<div class="line"><span class="lineno">  254</span> </div>
<div class="line"><span class="lineno">  255</span>    err = <a class="code hl_function" href="lock_8c.html#aede6140571a9d717300d31e0fd8079ee">pcilib_try_lock</a>(ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#afd7b157b8796cfbb55404c2912e793f3">dma_rlock</a>[dma]);</div>
<div class="line"><span class="lineno">  256</span>    <span class="keywordflow">if</span> (err) {</div>
<div class="line"><span class="lineno">  257</span>        <span class="keywordflow">if</span> ((err == <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60cae16e1bf6797a9883778d310ed58d15f4">PCILIB_ERROR_BUSY</a>)||(err == <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca827d3ff095354b8776d2274c82e70536">PCILIB_ERROR_TIMEOUT</a>))</div>
<div class="line"><span class="lineno">  258</span>            <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;DMA engine (%i) is busy&quot;</span>, dma);</div>
<div class="line"><span class="lineno">  259</span>        <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  260</span>            <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;Error (%i) locking DMA engine (%i)&quot;</span>, err, dma);</div>
<div class="line"><span class="lineno">  261</span> </div>
<div class="line"><span class="lineno">  262</span>        <span class="keywordflow">return</span> err;</div>
<div class="line"><span class="lineno">  263</span>    }</div>
<div class="line"><span class="lineno">  264</span> </div>
<div class="line"><span class="lineno">  265</span>    err = info-&gt;<a class="code hl_variable" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">api</a>-&gt;<a class="code hl_variable" href="structpcilib__dma__api__description__t.html#a6f3ffe94febb519e5e14545bc02bd347">stream</a>(ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a81fc504bd03023f6d2a2f22fd2ee58ca">dma_ctx</a>, dma, addr, size, flags, timeout, cb, cbattr);</div>
<div class="line"><span class="lineno">  266</span> </div>
<div class="line"><span class="lineno">  267</span>    <a class="code hl_function" href="lock_8c.html#a770c0ece9679b9b2589bd773b8cfb70e">pcilib_unlock</a>(ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#afd7b157b8796cfbb55404c2912e793f3">dma_rlock</a>[dma]);</div>
<div class="line"><span class="lineno">  268</span> </div>
<div class="line"><span class="lineno">  269</span>    <span class="keywordflow">return</span> err;</div>
<div class="line"><span class="lineno">  270</span>}</div>
<div class="ttc" id="apcilib_8h_html_aae456a435ae9c105b192cb4d35a49b01ae558d58774767d4adaa56de9cf9016aa"><div class="ttname"><a href="pcilib_8h.html#aae456a435ae9c105b192cb4d35a49b01ae558d58774767d4adaa56de9cf9016aa">PCILIB_DMA_FROM_DEVICE</a></div><div class="ttdeci">@ PCILIB_DMA_FROM_DEVICE</div><div class="ttdef"><b>Definition:</b> pcilib.h:81</div></div>
<div class="ttc" id="astructpcilib__dma__api__description__t_html_a6f3ffe94febb519e5e14545bc02bd347"><div class="ttname"><a href="structpcilib__dma__api__description__t.html#a6f3ffe94febb519e5e14545bc02bd347">pcilib_dma_api_description_t::stream</a></div><div class="ttdeci">int(* stream)(pcilib_dma_context_t *ctx, pcilib_dma_engine_t dma, uintptr_t addr, size_t size, pcilib_dma_flags_t flags, pcilib_timeout_t timeout, pcilib_dma_callback_t cb, void *cbattr)</div><div class="ttdef"><b>Definition:</b> dma.h:68</div></div>
<div class="ttc" id="astructpcilib__s_html_afd7b157b8796cfbb55404c2912e793f3"><div class="ttname"><a href="structpcilib__s.html#afd7b157b8796cfbb55404c2912e793f3">pcilib_s::dma_rlock</a></div><div class="ttdeci">pcilib_lock_t * dma_rlock[PCILIB_MAX_DMA_ENGINES]</div><div class="ttdoc">Per-engine locks to serialize streaming and read operations.</div><div class="ttdef"><b>Definition:</b> pci.h:101</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__dma__engine__description__t.html#a6eb5a7474384fc0ce8ee80d50a048ede">pcilib_dma_engine_description_t::addr_bits</a>, <a class="el" href="structpcilib__dma__description__t.html#a65df2efa3f37b7c5cf8acdbe8d23283b">pcilib_dma_description_t::api</a>, <a class="el" href="structpcilib__dma__engine__description__t.html#a910472c4dc812f8206935c031356200b">pcilib_dma_engine_description_t::direction</a>, <a class="el" href="structpcilib__s.html#a81fc504bd03023f6d2a2f22fd2ee58ca">pcilib_s::dma_ctx</a>, <a class="el" href="structpcilib__s.html#afd7b157b8796cfbb55404c2912e793f3">pcilib_s::dma_rlock</a>, <a class="el" href="structpcilib__dma__description__t.html#abd61b0b1a1de7d1923d86df4e3a2239c">pcilib_dma_description_t::engines</a>, <a class="el" href="pcilib_8h.html#aae456a435ae9c105b192cb4d35a49b01ae558d58774767d4adaa56de9cf9016aa">PCILIB_DMA_FROM_DEVICE</a>, <a class="el" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60cae16e1bf6797a9883778d310ed58d15f4">PCILIB_ERROR_BUSY</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca2c7b7e157ef8c29a7d1d0e808acf0a4c">PCILIB_ERROR_NOTAVAILABLE</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caf5392ef1a23835f44ebfe662e3d2988c">PCILIB_ERROR_NOTSUPPORTED</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca827d3ff095354b8776d2274c82e70536">PCILIB_ERROR_TIMEOUT</a>, <a class="el" href="dma_8c.html#aa237b49d303aabd58d8fc320915aa32c">pcilib_get_dma_description()</a>, <a class="el" href="lock_8c.html#aede6140571a9d717300d31e0fd8079ee">pcilib_try_lock()</a>, <a class="el" href="lock_8c.html#a770c0ece9679b9b2589bd773b8cfb70e">pcilib_unlock()</a>, and <a class="el" href="structpcilib__dma__api__description__t.html#a6f3ffe94febb519e5e14545bc02bd347">pcilib_dma_api_description_t::stream</a>.</p>

<p class="reference">Referenced by <a class="el" href="group__public__api__dma.html#ga048d13d66977bb839d3c53952b70c25c">pcilib_read_dma()</a>, <a class="el" href="group__public__api__dma.html#ga4aa78c7c5fd9996087311fc21bd7ccd5">pcilib_read_dma_custom()</a>, and <a class="el" href="group__public__api__dma.html#ga862942eecc274b76d22dea30bce65a0e">pcilib_skip_dma()</a>.</p>

</div>
</div>
<a id="gac85698e9e7185da357cce361d62a6840" name="gac85698e9e7185da357cce361d62a6840"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac85698e9e7185da357cce361d62a6840">&#9670;&#160;</a></span>pcilib_write_dma()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pcilib_write_dma </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="pcilib_8h.html#a3e2e6c8a87c030ef9d5b1d9907231f8e">pcilib_dma_engine_t</a>&#160;</td>
          <td class="paramname"><em>dma</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uintptr_t&#160;</td>
          <td class="paramname"><em>addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>wrsize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Pushes new data to the DMA engine and blocks until hardware gets it all. </p>
<p >Even if an error has occured, a part of the data may be already had send to DMA and can't be revoked back. Number of actually written bytes is always returned in the <code>wrsize</code>.</p>
<p >The function is process- and thread-safe. The <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60cae16e1bf6797a9883778d310ed58d15f4">PCILIB_ERROR_BUSY</a> will be returned immediately if DMA is used by another thread or process.</p>
<p >The function actually executes the <a class="el" href="group__public__api__dma.html#gad6ad21e27311c68f05a5189ce628f9bf" title="Pushes new data to the DMA engine.">pcilib_push_dma()</a> with <a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4a8800e20820becd8acf383e52bd5a560c" title="last buffer of the packet">PCILIB_DMA_FLAG_EOP</a> and <a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4a2524a8aaea4bb6ad0809bc7d4f8ba0bc" title="wait completion of write operation / wait for data during read operation">PCILIB_DMA_FLAG_WAIT</a> flags set and the default DMA timeout.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dma</td><td>- ID of DMA engine, the ID should first be resolved using <a class="el" href="group__public__api__dma.html#ga5a92b6019a460bc8809bd270f6d2a845" title="This function resolves the ID of DMA engine from its address and direction.">pcilib_find_dma_by_addr()</a> </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">addr</td><td>- instructs DMA to start writting at the specified address (not supported by existing DMA engines) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>- specifies how many bytes should be written </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">buf</td><td>- the buffer with the data </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">wrsize</td><td>- number of bytes which were actually written. The correct value will be reported in both case if function has finished successfully or if error has happened. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- error code or 0 on success. In both cases some data may be written to the DMA, check <code>wrsize</code>. </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  366</span>                                                                                                                            {</div>
<div class="line"><span class="lineno">  367</span>    <span class="keywordflow">return</span> <a class="code hl_function" href="group__public__api__dma.html#gad6ad21e27311c68f05a5189ce628f9bf">pcilib_push_dma</a>(ctx, dma, addr, size, <a class="code hl_enumvalue" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4a8800e20820becd8acf383e52bd5a560c">PCILIB_DMA_FLAG_EOP</a>|<a class="code hl_enumvalue" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4a2524a8aaea4bb6ad0809bc7d4f8ba0bc">PCILIB_DMA_FLAG_WAIT</a>, <a class="code hl_define" href="pci_8h.html#af49018029da7ba023b6d96fc97b4e0be">PCILIB_DMA_TIMEOUT</a>, buf, written_bytes);</div>
<div class="line"><span class="lineno">  368</span>}</div>
<div class="ttc" id="agroup__public__api__dma_html_gad6ad21e27311c68f05a5189ce628f9bf"><div class="ttname"><a href="group__public__api__dma.html#gad6ad21e27311c68f05a5189ce628f9bf">pcilib_push_dma</a></div><div class="ttdeci">int pcilib_push_dma(pcilib_t *ctx, pcilib_dma_engine_t dma, uintptr_t addr, size_t size, pcilib_dma_flags_t flags, pcilib_timeout_t timeout, void *buf, size_t *written)</div><div class="ttdoc">Pushes new data to the DMA engine.</div><div class="ttdef"><b>Definition:</b> dma.c:318</div></div>
<div class="ttc" id="apcilib_8h_html_ad4757daf3a402a2b21a51c666cd25de4a2524a8aaea4bb6ad0809bc7d4f8ba0bc"><div class="ttname"><a href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4a2524a8aaea4bb6ad0809bc7d4f8ba0bc">PCILIB_DMA_FLAG_WAIT</a></div><div class="ttdeci">@ PCILIB_DMA_FLAG_WAIT</div><div class="ttdoc">wait completion of write operation / wait for data during read operation</div><div class="ttdef"><b>Definition:</b> pcilib.h:88</div></div>
<div class="ttc" id="apcilib_8h_html_ad4757daf3a402a2b21a51c666cd25de4a8800e20820becd8acf383e52bd5a560c"><div class="ttname"><a href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4a8800e20820becd8acf383e52bd5a560c">PCILIB_DMA_FLAG_EOP</a></div><div class="ttdeci">@ PCILIB_DMA_FLAG_EOP</div><div class="ttdoc">last buffer of the packet</div><div class="ttdef"><b>Definition:</b> pcilib.h:87</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4a8800e20820becd8acf383e52bd5a560c">PCILIB_DMA_FLAG_EOP</a>, <a class="el" href="pcilib_8h.html#ad4757daf3a402a2b21a51c666cd25de4a2524a8aaea4bb6ad0809bc7d4f8ba0bc">PCILIB_DMA_FLAG_WAIT</a>, <a class="el" href="pci_8h.html#af49018029da7ba023b6d96fc97b4e0be">PCILIB_DMA_TIMEOUT</a>, and <a class="el" href="group__public__api__dma.html#gad6ad21e27311c68f05a5189ce628f9bf">pcilib_push_dma()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 18 2024 22:02:48 for pcilib by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
