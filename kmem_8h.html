<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>pcilib: kmem.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">pcilib
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0b5c8f32f3013e7b96dc99509907414c.html">pcilib</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">kmem.h File Reference</div></div>
</div><!--header-->
<div class="contents">

<p><a href="kmem_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpcilib__kmem__addr__t.html">pcilib_kmem_addr_t</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpcilib__kmem__buffer__t.html">pcilib_kmem_buffer_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">single allocation - we set only addr, n_blocks = 0 multiple allocation - addr is not set, blocks are set, n_blocks &gt; 0 sgmap allocation - addr contains ua, but pa's are set in blocks, n_blocks &gt; 0  <a href="structpcilib__kmem__buffer__t.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_s</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ab6f8d4f2207b8983bc511ca80c000110"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#ab6f8d4f2207b8983bc511ca80c000110">PCILIB_KMEM_PAGE_SIZE</a>&#160;&#160;&#160;0x1000</td></tr>
<tr class="memdesc:ab6f8d4f2207b8983bc511ca80c000110"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default pages size is 4096 bytes.  <a href="kmem_8h.html#ab6f8d4f2207b8983bc511ca80c000110">More...</a><br /></td></tr>
<tr class="separator:ab6f8d4f2207b8983bc511ca80c000110"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa29a33448c2617f0662db45afdbbd32"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#afa29a33448c2617f0662db45afdbbd32">PCILIB_KMEM_TYPE_MASK</a>&#160;&#160;&#160;0xFFFF0000</td></tr>
<tr class="memdesc:afa29a33448c2617f0662db45afdbbd32"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mask selecting the general type in <a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66">pcilib_kmem_type_t</a>.  <a href="kmem_8h.html#afa29a33448c2617f0662db45afdbbd32">More...</a><br /></td></tr>
<tr class="separator:afa29a33448c2617f0662db45afdbbd32"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7c9ab7df3d5133dd797ecd55dc353ee"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#aa7c9ab7df3d5133dd797ecd55dc353ee">PCILIB_KMEM_USE_TYPE</a>(use)&#160;&#160;&#160;(use &gt;&gt; 16)</td></tr>
<tr class="memdesc:aa7c9ab7df3d5133dd797ecd55dc353ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns general use of the kernel buffers, for instance DMA buffer (see <a class="el" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485">pcilib_kmem_use_t</a>)  <a href="kmem_8h.html#aa7c9ab7df3d5133dd797ecd55dc353ee">More...</a><br /></td></tr>
<tr class="separator:aa7c9ab7df3d5133dd797ecd55dc353ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a13ada60eb1dab37c387cd41e321dae53"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#a13ada60eb1dab37c387cd41e321dae53">PCILIB_KMEM_USE_SUBTYPE</a>(use)&#160;&#160;&#160;(use &amp; 0xFFFF)</td></tr>
<tr class="memdesc:a13ada60eb1dab37c387cd41e321dae53"><td class="mdescLeft">&#160;</td><td class="mdescRight">Additional information about the use of the kernel buffers.  <a href="kmem_8h.html#a13ada60eb1dab37c387cd41e321dae53">More...</a><br /></td></tr>
<tr class="separator:a13ada60eb1dab37c387cd41e321dae53"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f5a834e88f100dc458108c49b0b475c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#a1f5a834e88f100dc458108c49b0b475c">PCILIB_KMEM_USE</a>(type,  subtype)&#160;&#160;&#160;((<a class="el" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485">pcilib_kmem_use_t</a>)(((type) &lt;&lt; 16)|(subtype)))</td></tr>
<tr class="memdesc:a1f5a834e88f100dc458108c49b0b475c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Constructs full use from use type and use subtype.  <a href="kmem_8h.html#a1f5a834e88f100dc458108c49b0b475c">More...</a><br /></td></tr>
<tr class="separator:a1f5a834e88f100dc458108c49b0b475c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a51f63ba035402ca9a2ddd1b11152d7f5"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structpcilib__s.html">pcilib_s</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a></td></tr>
<tr class="separator:a51f63ba035402ca9a2ddd1b11152d7f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a1d4416dbc0d2da42a7ca4ca990545d"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_s</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#a8a1d4416dbc0d2da42a7ca4ca990545d">pcilib_kmem_list_t</a></td></tr>
<tr class="separator:a8a1d4416dbc0d2da42a7ca4ca990545d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45758f64a23ffbaa50a83e41b3342780"><td class="memItemLeft" align="right" valign="top">typedef void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a></td></tr>
<tr class="separator:a45758f64a23ffbaa50a83e41b3342780"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a1dd3f4385e8051d028281c93490b76ec"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ec">pcilib_tristate_t</a> { <a class="el" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaf41596fde03fab631d50b01a97aa223d">PCILIB_TRISTATE_NO</a> = 0
, <a class="el" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76eca70a51fcff782e3178d917f3aa502bb87">PCILIB_TRISTATE_PARTIAL</a> = 1
, <a class="el" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaed2f3179347058cf78c4337036b8e765">PCILIB_TRISTATE_YES</a> = 2
 }</td></tr>
<tr class="separator:a1dd3f4385e8051d028281c93490b76ec"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0026872c63f522459ae8510c9653ba66"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66">pcilib_kmem_type_t</a> { <br />
&#160;&#160;<a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66aae8d4d2486db17ad068f56e3cff6d1ef">PCILIB_KMEM_TYPE_CONSISTENT</a> = 0x00000
, <a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a83c7f4b602188c78ddf226498890d331">PCILIB_KMEM_TYPE_PAGE</a> = 0x10000
, <a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66aaf1e868d635e1a2391b6a95fcc0487e9">PCILIB_KMEM_TYPE_DMA_S2C_PAGE</a> = 0x10001
, <a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a2dce4064644436c3fbacb4e6f528a164">PCILIB_KMEM_TYPE_DMA_C2S_PAGE</a> = 0x10002
, <br />
&#160;&#160;<a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a5eae6683f379c25954fcdab27284d200">PCILIB_KMEM_TYPE_REGION</a> = 0x20000
, <a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a9848db80fded8e8f65817e893d629353">PCILIB_KMEM_TYPE_REGION_S2C</a> = 0x20001
, <a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66af0e713201866ba74693dbd47260b27ee">PCILIB_KMEM_TYPE_REGION_C2S</a> = 0x20002
<br />
 }</td></tr>
<tr class="separator:a0026872c63f522459ae8510c9653ba66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30160d6ee0113e9eb63b28f62f8bc485"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485">pcilib_kmem_use_t</a> { <br />
&#160;&#160;<a class="el" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485a9826745d3ad33106ff3c5a3e7cad6671">PCILIB_KMEM_USE_STANDARD</a> = 0
, <a class="el" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485a86e03da7b667a30da103ba06cc016715">PCILIB_KMEM_USE_DMA_RING</a> = 1
, <a class="el" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485a81c9095dc0b2c684ebb37067c363379b">PCILIB_KMEM_USE_DMA_PAGES</a> = 2
, <a class="el" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485a9eebfad30fdeb2394e3f19692203a5b0">PCILIB_KMEM_USE_SOFTWARE_REGISTERS</a> = 3
, <br />
&#160;&#160;<a class="el" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485aba713c036118f491d984a4b754b4ddd7">PCILIB_KMEM_USE_LOCKS</a> = 4
, <a class="el" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485aa1c08fb7e60c934799678644d6e85068">PCILIB_KMEM_USE_USER</a> = 0x10
<br />
 }</td></tr>
<tr class="separator:a30160d6ee0113e9eb63b28f62f8bc485"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a565630a72af55e4cce61925d417dd644"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#a565630a72af55e4cce61925d417dd644">pcilib_kmem_sync_direction_t</a> { <a class="el" href="kmem_8h.html#a565630a72af55e4cce61925d417dd644aa3350faa48ff7863359a026eabe2f7d4">PCILIB_KMEM_SYNC_BIDIRECTIONAL</a> = 0
, <a class="el" href="kmem_8h.html#a565630a72af55e4cce61925d417dd644a9f1b6ddc0b9cbfffafdfac5c41c8c746">PCILIB_KMEM_SYNC_TODEVICE</a> = 1
, <a class="el" href="kmem_8h.html#a565630a72af55e4cce61925d417dd644ae02e8101a1e3628a8966ddf15094d19a">PCILIB_KMEM_SYNC_FROMDEVICE</a> = 2
 }</td></tr>
<tr class="separator:a565630a72af55e4cce61925d417dd644"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae91539a22992b31d5ecbe338ed230bcd"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcd">pcilib_kmem_flags_t</a> { <br />
&#160;&#160;<a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda074f7eaee0589d2d0eb90b9807f755cf">PCILIB_KMEM_FLAG_REUSE</a> = 1
, <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdad975c8226c758c467a0ccfadb8d7552e">PCILIB_KMEM_FLAG_EXCLUSIVE</a> = 2
, <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda7cd91729fe864a6ae9f0192909f8cde6">PCILIB_KMEM_FLAG_PERSISTENT</a> = 4
, <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda6dbb3793cb0ed9350d9e9dde1131d7c1">PCILIB_KMEM_FLAG_HARDWARE</a> = 8
, <br />
&#160;&#160;<a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdaea45d32d74a90a73de7ce8726d261104">PCILIB_KMEM_FLAG_FORCE</a> = 16
, <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdaa65929a5db6e7a0cf48e520d1ab56bfc">PCILIB_KMEM_FLAG_MASS</a> = 32
, <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdad05007ab4895e9f4166688d1b24d5714">PCILIB_KMEM_FLAG_TRY</a> = 64
<br />
 }</td></tr>
<tr class="separator:ae91539a22992b31d5ecbe338ed230bcd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad9593c5ba7752ae78acd1e3164d38d48"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48">pcilib_kmem_reuse_state_t</a> { <br />
&#160;&#160;<a class="el" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48afc1ff2c9dcafec4ab5fb5cc7481e4c68">PCILIB_KMEM_REUSE_ALLOCATED</a> = PCILIB_TRISTATE_NO
, <a class="el" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48a208a355950eafd1ec15debad10265e6d">PCILIB_KMEM_REUSE_REUSED</a> = PCILIB_TRISTATE_YES
, <a class="el" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48a8c3b52eba08a1a3c1b8cf255be084964">PCILIB_KMEM_REUSE_PARTIAL</a> = PCILIB_TRISTATE_PARTIAL
, <a class="el" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48a3554ace3999de348dfa20720cf3a2a76">PCILIB_KMEM_REUSE_PERSISTENT</a> = 0x100
, <br />
&#160;&#160;<a class="el" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48ac2f1419981871c6e37c31a875adf7610">PCILIB_KMEM_REUSE_HARDWARE</a> = 0x200
<br />
 }</td></tr>
<tr class="separator:ad9593c5ba7752ae78acd1e3164d38d48"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac6559934a4616cbb9125caf2c1f8908e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e">pcilib_alloc_kernel_memory</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66">pcilib_kmem_type_t</a> type, size_t nmemb, size_t size, size_t alignment, <a class="el" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485">pcilib_kmem_use_t</a> use, <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcd">pcilib_kmem_flags_t</a> flags)</td></tr>
<tr class="memdesc:ac6559934a4616cbb9125caf2c1f8908e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function either allocates new buffers in the kernel space or just re-uses existing buffers.  <a href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e">More...</a><br /></td></tr>
<tr class="separator:ac6559934a4616cbb9125caf2c1f8908e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77eed4dcaa5a719b767ed275c332148e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#a77eed4dcaa5a719b767ed275c332148e">pcilib_free_kernel_memory</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *k, <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcd">pcilib_kmem_flags_t</a> flags)</td></tr>
<tr class="memdesc:a77eed4dcaa5a719b767ed275c332148e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function either frees the allocated kernel memory or just releases some of the references.  <a href="kmem_8h.html#a77eed4dcaa5a719b767ed275c332148e">More...</a><br /></td></tr>
<tr class="separator:a77eed4dcaa5a719b767ed275c332148e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a033d40db26413a78644674d17ad2c506"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#a033d40db26413a78644674d17ad2c506">pcilib_clean_kernel_memory</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485">pcilib_kmem_use_t</a> use, <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcd">pcilib_kmem_flags_t</a> flags)</td></tr>
<tr class="memdesc:a033d40db26413a78644674d17ad2c506"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free / dereference all kernel memory buffers associated with the specified <code>use</code>.  <a href="kmem_8h.html#a033d40db26413a78644674d17ad2c506">More...</a><br /></td></tr>
<tr class="separator:a033d40db26413a78644674d17ad2c506"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ceab049700c01499673f4a9123101b4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#a3ceab049700c01499673f4a9123101b4">pcilib_kmem_sync_block</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *k, <a class="el" href="kmem_8h.html#a565630a72af55e4cce61925d417dd644">pcilib_kmem_sync_direction_t</a> dir, size_t block)</td></tr>
<tr class="memdesc:a3ceab049700c01499673f4a9123101b4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Synchronizes usage of the specified buffer between hardware and the system.  <a href="kmem_8h.html#a3ceab049700c01499673f4a9123101b4">More...</a><br /></td></tr>
<tr class="separator:a3ceab049700c01499673f4a9123101b4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a860cda7556a29ee3dec28af72581f148"><td class="memItemLeft" align="right" valign="top">volatile void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#a860cda7556a29ee3dec28af72581f148">pcilib_kmem_get_ua</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *k)</td></tr>
<tr class="memdesc:a860cda7556a29ee3dec28af72581f148"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a valid pointer on the user-space mapping of a single-buffer kernel memory.  <a href="kmem_8h.html#a860cda7556a29ee3dec28af72581f148">More...</a><br /></td></tr>
<tr class="separator:a860cda7556a29ee3dec28af72581f148"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4d5af7eae82f2ceb5e9e5d2d52e399a"><td class="memItemLeft" align="right" valign="top">uintptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#aa4d5af7eae82f2ceb5e9e5d2d52e399a">pcilib_kmem_get_pa</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *k)</td></tr>
<tr class="memdesc:aa4d5af7eae82f2ceb5e9e5d2d52e399a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a physical address of a single-buffer kernel memory.  <a href="kmem_8h.html#aa4d5af7eae82f2ceb5e9e5d2d52e399a">More...</a><br /></td></tr>
<tr class="separator:aa4d5af7eae82f2ceb5e9e5d2d52e399a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e98bad106c18f186105d841d2cabf27"><td class="memItemLeft" align="right" valign="top">uintptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#a8e98bad106c18f186105d841d2cabf27">pcilib_kmem_get_ba</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *k)</td></tr>
<tr class="memdesc:a8e98bad106c18f186105d841d2cabf27"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a bus address of a single-buffer kernel memory.  <a href="kmem_8h.html#a8e98bad106c18f186105d841d2cabf27">More...</a><br /></td></tr>
<tr class="separator:a8e98bad106c18f186105d841d2cabf27"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee9f4941b33c0ae87675bffd02a48664"><td class="memItemLeft" align="right" valign="top">volatile void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#aee9f4941b33c0ae87675bffd02a48664">pcilib_kmem_get_block_ua</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *k, size_t block)</td></tr>
<tr class="memdesc:aee9f4941b33c0ae87675bffd02a48664"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a valid pointer on the user-space mapping of the specified kernel memory buffer.  <a href="kmem_8h.html#aee9f4941b33c0ae87675bffd02a48664">More...</a><br /></td></tr>
<tr class="separator:aee9f4941b33c0ae87675bffd02a48664"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4762c546213be7a0b7924bf542e1033e"><td class="memItemLeft" align="right" valign="top">uintptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#a4762c546213be7a0b7924bf542e1033e">pcilib_kmem_get_block_pa</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *k, size_t block)</td></tr>
<tr class="memdesc:a4762c546213be7a0b7924bf542e1033e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a physical address of the specified kernel memory buffer.  <a href="kmem_8h.html#a4762c546213be7a0b7924bf542e1033e">More...</a><br /></td></tr>
<tr class="separator:a4762c546213be7a0b7924bf542e1033e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7bd7744b88e9683273772a7e08e276cc"><td class="memItemLeft" align="right" valign="top">uintptr_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#a7bd7744b88e9683273772a7e08e276cc">pcilib_kmem_get_block_ba</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *k, size_t block)</td></tr>
<tr class="memdesc:a7bd7744b88e9683273772a7e08e276cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get a bus address of the specified kernel memory buffer.  <a href="kmem_8h.html#a7bd7744b88e9683273772a7e08e276cc">More...</a><br /></td></tr>
<tr class="separator:a7bd7744b88e9683273772a7e08e276cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aed04929b8d305b5dcb32243a608c7226"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#aed04929b8d305b5dcb32243a608c7226">pcilib_kmem_get_block_size</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *k, size_t block)</td></tr>
<tr class="memdesc:aed04929b8d305b5dcb32243a608c7226"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get size of the specified kernel memory buffer.  <a href="kmem_8h.html#aed04929b8d305b5dcb32243a608c7226">More...</a><br /></td></tr>
<tr class="separator:aed04929b8d305b5dcb32243a608c7226"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2a3c0d541ee9e45f53ea48904fac65d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48">pcilib_kmem_reuse_state_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="kmem_8h.html#ac2a3c0d541ee9e45f53ea48904fac65d">pcilib_kmem_is_reused</a> (<a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *ctx, <a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *k)</td></tr>
<tr class="memdesc:ac2a3c0d541ee9e45f53ea48904fac65d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reports if the kernel memory was reused fully, partially, or allocated completely anew.  <a href="kmem_8h.html#ac2a3c0d541ee9e45f53ea48904fac65d">More...</a><br /></td></tr>
<tr class="separator:ac2a3c0d541ee9e45f53ea48904fac65d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ab6f8d4f2207b8983bc511ca80c000110" name="ab6f8d4f2207b8983bc511ca80c000110"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab6f8d4f2207b8983bc511ca80c000110">&#9670;&#160;</a></span>PCILIB_KMEM_PAGE_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PCILIB_KMEM_PAGE_SIZE&#160;&#160;&#160;0x1000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Default pages size is 4096 bytes. </p>

</div>
</div>
<a id="afa29a33448c2617f0662db45afdbbd32" name="afa29a33448c2617f0662db45afdbbd32"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afa29a33448c2617f0662db45afdbbd32">&#9670;&#160;</a></span>PCILIB_KMEM_TYPE_MASK</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PCILIB_KMEM_TYPE_MASK&#160;&#160;&#160;0xFFFF0000</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mask selecting the general type in <a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66">pcilib_kmem_type_t</a>. </p>
<p >The subtype is may specify DMA mapping and other minor details of allocation </p>

</div>
</div>
<a id="a1f5a834e88f100dc458108c49b0b475c" name="a1f5a834e88f100dc458108c49b0b475c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f5a834e88f100dc458108c49b0b475c">&#9670;&#160;</a></span>PCILIB_KMEM_USE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PCILIB_KMEM_USE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">type, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">subtype&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;((<a class="el" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485">pcilib_kmem_use_t</a>)(((type) &lt;&lt; 16)|(subtype)))</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Constructs full use from use type and use subtype. </p>

</div>
</div>
<a id="a13ada60eb1dab37c387cd41e321dae53" name="a13ada60eb1dab37c387cd41e321dae53"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a13ada60eb1dab37c387cd41e321dae53">&#9670;&#160;</a></span>PCILIB_KMEM_USE_SUBTYPE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PCILIB_KMEM_USE_SUBTYPE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">use</td><td>)</td>
          <td>&#160;&#160;&#160;(use &amp; 0xFFFF)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Additional information about the use of the kernel buffers. </p>
<p >The actual meaning depends on general use, for instance in case of DMA buffers the subtype specifies DMA engine </p>

</div>
</div>
<a id="aa7c9ab7df3d5133dd797ecd55dc353ee" name="aa7c9ab7df3d5133dd797ecd55dc353ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa7c9ab7df3d5133dd797ecd55dc353ee">&#9670;&#160;</a></span>PCILIB_KMEM_USE_TYPE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define PCILIB_KMEM_USE_TYPE</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">use</td><td>)</td>
          <td>&#160;&#160;&#160;(use &gt;&gt; 16)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns general use of the kernel buffers, for instance DMA buffer (see <a class="el" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485">pcilib_kmem_use_t</a>) </p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a45758f64a23ffbaa50a83e41b3342780" name="a45758f64a23ffbaa50a83e41b3342780"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a45758f64a23ffbaa50a83e41b3342780">&#9670;&#160;</a></span>pcilib_kmem_handle_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void <a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a8a1d4416dbc0d2da42a7ca4ca990545d" name="a8a1d4416dbc0d2da42a7ca4ca990545d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a1d4416dbc0d2da42a7ca4ca990545d">&#9670;&#160;</a></span>pcilib_kmem_list_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_s</a> <a class="el" href="kmem_8h.html#a8a1d4416dbc0d2da42a7ca4ca990545d">pcilib_kmem_list_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a51f63ba035402ca9a2ddd1b11152d7f5" name="a51f63ba035402ca9a2ddd1b11152d7f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a51f63ba035402ca9a2ddd1b11152d7f5">&#9670;&#160;</a></span>pcilib_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structpcilib__s.html">pcilib_s</a> <a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="ae91539a22992b31d5ecbe338ed230bcd" name="ae91539a22992b31d5ecbe338ed230bcd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae91539a22992b31d5ecbe338ed230bcd">&#9670;&#160;</a></span>pcilib_kmem_flags_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcd">pcilib_kmem_flags_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ae91539a22992b31d5ecbe338ed230bcda074f7eaee0589d2d0eb90b9807f755cf" name="ae91539a22992b31d5ecbe338ed230bcda074f7eaee0589d2d0eb90b9807f755cf"></a>PCILIB_KMEM_FLAG_REUSE&#160;</td><td class="fielddoc"><p >Try to reuse existing buffer with the same use &amp; item. </p>
</td></tr>
<tr><td class="fieldname"><a id="ae91539a22992b31d5ecbe338ed230bcdad975c8226c758c467a0ccfadb8d7552e" name="ae91539a22992b31d5ecbe338ed230bcdad975c8226c758c467a0ccfadb8d7552e"></a>PCILIB_KMEM_FLAG_EXCLUSIVE&#160;</td><td class="fielddoc"><p >Allow only a single application accessing a specified use &amp; item. </p>
</td></tr>
<tr><td class="fieldname"><a id="ae91539a22992b31d5ecbe338ed230bcda7cd91729fe864a6ae9f0192909f8cde6" name="ae91539a22992b31d5ecbe338ed230bcda7cd91729fe864a6ae9f0192909f8cde6"></a>PCILIB_KMEM_FLAG_PERSISTENT&#160;</td><td class="fielddoc"><p >Sets persistent mode. </p>
</td></tr>
<tr><td class="fieldname"><a id="ae91539a22992b31d5ecbe338ed230bcda6dbb3793cb0ed9350d9e9dde1131d7c1" name="ae91539a22992b31d5ecbe338ed230bcda6dbb3793cb0ed9350d9e9dde1131d7c1"></a>PCILIB_KMEM_FLAG_HARDWARE&#160;</td><td class="fielddoc"><p >The buffer may be accessed by hardware, the hardware access will not occur any more if passed to _free function. </p>
</td></tr>
<tr><td class="fieldname"><a id="ae91539a22992b31d5ecbe338ed230bcdaea45d32d74a90a73de7ce8726d261104" name="ae91539a22992b31d5ecbe338ed230bcdaea45d32d74a90a73de7ce8726d261104"></a>PCILIB_KMEM_FLAG_FORCE&#160;</td><td class="fielddoc"><p >Force memory cleanup even if references are present. </p>
</td></tr>
<tr><td class="fieldname"><a id="ae91539a22992b31d5ecbe338ed230bcdaa65929a5db6e7a0cf48e520d1ab56bfc" name="ae91539a22992b31d5ecbe338ed230bcdaa65929a5db6e7a0cf48e520d1ab56bfc"></a>PCILIB_KMEM_FLAG_MASS&#160;</td><td class="fielddoc"><p >Apply to all buffers of selected use. </p>
</td></tr>
<tr><td class="fieldname"><a id="ae91539a22992b31d5ecbe338ed230bcdad05007ab4895e9f4166688d1b24d5714" name="ae91539a22992b31d5ecbe338ed230bcdad05007ab4895e9f4166688d1b24d5714"></a>PCILIB_KMEM_FLAG_TRY&#160;</td><td class="fielddoc"><p >Do not allocate buffers, try to reuse and fail if not possible. </p>
</td></tr>
</table>
<div class="fragment"><div class="line"><span class="lineno">   45</span>             {</div>
<div class="line"><span class="lineno">   46</span>    <a class="code hl_enumvalue" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda074f7eaee0589d2d0eb90b9807f755cf">PCILIB_KMEM_FLAG_REUSE</a> = 1,                         </div>
<div class="line"><span class="lineno">   47</span>    <a class="code hl_enumvalue" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdad975c8226c758c467a0ccfadb8d7552e">PCILIB_KMEM_FLAG_EXCLUSIVE</a> = 2,                     </div>
<div class="line"><span class="lineno">   48</span>    <a class="code hl_enumvalue" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda7cd91729fe864a6ae9f0192909f8cde6">PCILIB_KMEM_FLAG_PERSISTENT</a> = 4,                    </div>
<div class="line"><span class="lineno">   49</span>    <a class="code hl_enumvalue" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda6dbb3793cb0ed9350d9e9dde1131d7c1">PCILIB_KMEM_FLAG_HARDWARE</a> = 8,                      </div>
<div class="line"><span class="lineno">   50</span>    <a class="code hl_enumvalue" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdaea45d32d74a90a73de7ce8726d261104">PCILIB_KMEM_FLAG_FORCE</a> = 16,                        </div>
<div class="line"><span class="lineno">   51</span>    <a class="code hl_enumvalue" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdaa65929a5db6e7a0cf48e520d1ab56bfc">PCILIB_KMEM_FLAG_MASS</a> = 32,                         </div>
<div class="line"><span class="lineno">   52</span>    <a class="code hl_enumvalue" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdad05007ab4895e9f4166688d1b24d5714">PCILIB_KMEM_FLAG_TRY</a> =  64                          </div>
<div class="line"><span class="lineno">   53</span>} <a class="code hl_enumeration" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcd">pcilib_kmem_flags_t</a>;</div>
<div class="ttc" id="akmem_8h_html_ae91539a22992b31d5ecbe338ed230bcd"><div class="ttname"><a href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcd">pcilib_kmem_flags_t</a></div><div class="ttdeci">pcilib_kmem_flags_t</div><div class="ttdef"><b>Definition:</b> kmem.h:45</div></div>
<div class="ttc" id="akmem_8h_html_ae91539a22992b31d5ecbe338ed230bcda074f7eaee0589d2d0eb90b9807f755cf"><div class="ttname"><a href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda074f7eaee0589d2d0eb90b9807f755cf">PCILIB_KMEM_FLAG_REUSE</a></div><div class="ttdeci">@ PCILIB_KMEM_FLAG_REUSE</div><div class="ttdoc">Try to reuse existing buffer with the same use &amp; item.</div><div class="ttdef"><b>Definition:</b> kmem.h:46</div></div>
<div class="ttc" id="akmem_8h_html_ae91539a22992b31d5ecbe338ed230bcda6dbb3793cb0ed9350d9e9dde1131d7c1"><div class="ttname"><a href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda6dbb3793cb0ed9350d9e9dde1131d7c1">PCILIB_KMEM_FLAG_HARDWARE</a></div><div class="ttdeci">@ PCILIB_KMEM_FLAG_HARDWARE</div><div class="ttdoc">The buffer may be accessed by hardware, the hardware access will not occur any more if passed to _fre...</div><div class="ttdef"><b>Definition:</b> kmem.h:49</div></div>
<div class="ttc" id="akmem_8h_html_ae91539a22992b31d5ecbe338ed230bcda7cd91729fe864a6ae9f0192909f8cde6"><div class="ttname"><a href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda7cd91729fe864a6ae9f0192909f8cde6">PCILIB_KMEM_FLAG_PERSISTENT</a></div><div class="ttdeci">@ PCILIB_KMEM_FLAG_PERSISTENT</div><div class="ttdoc">Sets persistent mode.</div><div class="ttdef"><b>Definition:</b> kmem.h:48</div></div>
<div class="ttc" id="akmem_8h_html_ae91539a22992b31d5ecbe338ed230bcdaa65929a5db6e7a0cf48e520d1ab56bfc"><div class="ttname"><a href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdaa65929a5db6e7a0cf48e520d1ab56bfc">PCILIB_KMEM_FLAG_MASS</a></div><div class="ttdeci">@ PCILIB_KMEM_FLAG_MASS</div><div class="ttdoc">Apply to all buffers of selected use.</div><div class="ttdef"><b>Definition:</b> kmem.h:51</div></div>
<div class="ttc" id="akmem_8h_html_ae91539a22992b31d5ecbe338ed230bcdad05007ab4895e9f4166688d1b24d5714"><div class="ttname"><a href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdad05007ab4895e9f4166688d1b24d5714">PCILIB_KMEM_FLAG_TRY</a></div><div class="ttdeci">@ PCILIB_KMEM_FLAG_TRY</div><div class="ttdoc">Do not allocate buffers, try to reuse and fail if not possible.</div><div class="ttdef"><b>Definition:</b> kmem.h:52</div></div>
<div class="ttc" id="akmem_8h_html_ae91539a22992b31d5ecbe338ed230bcdad975c8226c758c467a0ccfadb8d7552e"><div class="ttname"><a href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdad975c8226c758c467a0ccfadb8d7552e">PCILIB_KMEM_FLAG_EXCLUSIVE</a></div><div class="ttdeci">@ PCILIB_KMEM_FLAG_EXCLUSIVE</div><div class="ttdoc">Allow only a single application accessing a specified use &amp; item.</div><div class="ttdef"><b>Definition:</b> kmem.h:47</div></div>
<div class="ttc" id="akmem_8h_html_ae91539a22992b31d5ecbe338ed230bcdaea45d32d74a90a73de7ce8726d261104"><div class="ttname"><a href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdaea45d32d74a90a73de7ce8726d261104">PCILIB_KMEM_FLAG_FORCE</a></div><div class="ttdeci">@ PCILIB_KMEM_FLAG_FORCE</div><div class="ttdoc">Force memory cleanup even if references are present.</div><div class="ttdef"><b>Definition:</b> kmem.h:50</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="ad9593c5ba7752ae78acd1e3164d38d48" name="ad9593c5ba7752ae78acd1e3164d38d48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad9593c5ba7752ae78acd1e3164d38d48">&#9670;&#160;</a></span>pcilib_kmem_reuse_state_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48">pcilib_kmem_reuse_state_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="ad9593c5ba7752ae78acd1e3164d38d48afc1ff2c9dcafec4ab5fb5cc7481e4c68" name="ad9593c5ba7752ae78acd1e3164d38d48afc1ff2c9dcafec4ab5fb5cc7481e4c68"></a>PCILIB_KMEM_REUSE_ALLOCATED&#160;</td><td class="fielddoc"><p >The kernel memory was allocated anew. </p>
</td></tr>
<tr><td class="fieldname"><a id="ad9593c5ba7752ae78acd1e3164d38d48a208a355950eafd1ec15debad10265e6d" name="ad9593c5ba7752ae78acd1e3164d38d48a208a355950eafd1ec15debad10265e6d"></a>PCILIB_KMEM_REUSE_REUSED&#160;</td><td class="fielddoc"><p >Already allocated kernel memory was re-used. </p>
</td></tr>
<tr><td class="fieldname"><a id="ad9593c5ba7752ae78acd1e3164d38d48a8c3b52eba08a1a3c1b8cf255be084964" name="ad9593c5ba7752ae78acd1e3164d38d48a8c3b52eba08a1a3c1b8cf255be084964"></a>PCILIB_KMEM_REUSE_PARTIAL&#160;</td><td class="fielddoc"><p >The kernel memory was partially re-used and partially allocated. </p>
</td></tr>
<tr><td class="fieldname"><a id="ad9593c5ba7752ae78acd1e3164d38d48a3554ace3999de348dfa20720cf3a2a76" name="ad9593c5ba7752ae78acd1e3164d38d48a3554ace3999de348dfa20720cf3a2a76"></a>PCILIB_KMEM_REUSE_PERSISTENT&#160;</td><td class="fielddoc"><p >Flag indicating that persistent kmem was allocated/reused (will not be cleaned on <a class="el" href="kmem_8h.html#a77eed4dcaa5a719b767ed275c332148e" title="This function either frees the allocated kernel memory or just releases some of the references.">pcilib_free_kernel_memory()</a> unless forced with PCILIB_KMEM_FLAG_PERSISTENT. </p>
</td></tr>
<tr><td class="fieldname"><a id="ad9593c5ba7752ae78acd1e3164d38d48ac2f1419981871c6e37c31a875adf7610" name="ad9593c5ba7752ae78acd1e3164d38d48ac2f1419981871c6e37c31a875adf7610"></a>PCILIB_KMEM_REUSE_HARDWARE&#160;</td><td class="fielddoc"><p >Flag indicating that kmem may be used by hardware device. </p>
</td></tr>
</table>
<div class="fragment"><div class="line"><span class="lineno">   56</span>             {</div>
<div class="line"><span class="lineno">   57</span>    <a class="code hl_enumvalue" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48afc1ff2c9dcafec4ab5fb5cc7481e4c68">PCILIB_KMEM_REUSE_ALLOCATED</a> = <a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaf41596fde03fab631d50b01a97aa223d">PCILIB_TRISTATE_NO</a>,   </div>
<div class="line"><span class="lineno">   58</span>    <a class="code hl_enumvalue" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48a208a355950eafd1ec15debad10265e6d">PCILIB_KMEM_REUSE_REUSED</a> = <a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaed2f3179347058cf78c4337036b8e765">PCILIB_TRISTATE_YES</a>,     </div>
<div class="line"><span class="lineno">   59</span>    <a class="code hl_enumvalue" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48a8c3b52eba08a1a3c1b8cf255be084964">PCILIB_KMEM_REUSE_PARTIAL</a> = <a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76eca70a51fcff782e3178d917f3aa502bb87">PCILIB_TRISTATE_PARTIAL</a>,</div>
<div class="line"><span class="lineno">   60</span>    <a class="code hl_enumvalue" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48a3554ace3999de348dfa20720cf3a2a76">PCILIB_KMEM_REUSE_PERSISTENT</a> = 0x100,               </div>
<div class="line"><span class="lineno">   61</span>    <a class="code hl_enumvalue" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48ac2f1419981871c6e37c31a875adf7610">PCILIB_KMEM_REUSE_HARDWARE</a> = 0x200                  </div>
<div class="line"><span class="lineno">   62</span>} <a class="code hl_enumeration" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48">pcilib_kmem_reuse_state_t</a>;</div>
<div class="ttc" id="akmem_8h_html_a1dd3f4385e8051d028281c93490b76eca70a51fcff782e3178d917f3aa502bb87"><div class="ttname"><a href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76eca70a51fcff782e3178d917f3aa502bb87">PCILIB_TRISTATE_PARTIAL</a></div><div class="ttdeci">@ PCILIB_TRISTATE_PARTIAL</div><div class="ttdoc">Some values are evaluated as false and others as true.</div><div class="ttdef"><b>Definition:</b> kmem.h:11</div></div>
<div class="ttc" id="akmem_8h_html_a1dd3f4385e8051d028281c93490b76ecaed2f3179347058cf78c4337036b8e765"><div class="ttname"><a href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaed2f3179347058cf78c4337036b8e765">PCILIB_TRISTATE_YES</a></div><div class="ttdeci">@ PCILIB_TRISTATE_YES</div><div class="ttdoc">All values are evaluated as true.</div><div class="ttdef"><b>Definition:</b> kmem.h:12</div></div>
<div class="ttc" id="akmem_8h_html_a1dd3f4385e8051d028281c93490b76ecaf41596fde03fab631d50b01a97aa223d"><div class="ttname"><a href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaf41596fde03fab631d50b01a97aa223d">PCILIB_TRISTATE_NO</a></div><div class="ttdeci">@ PCILIB_TRISTATE_NO</div><div class="ttdoc">All values are evaluated as false.</div><div class="ttdef"><b>Definition:</b> kmem.h:10</div></div>
<div class="ttc" id="akmem_8h_html_ad9593c5ba7752ae78acd1e3164d38d48"><div class="ttname"><a href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48">pcilib_kmem_reuse_state_t</a></div><div class="ttdeci">pcilib_kmem_reuse_state_t</div><div class="ttdef"><b>Definition:</b> kmem.h:56</div></div>
<div class="ttc" id="akmem_8h_html_ad9593c5ba7752ae78acd1e3164d38d48a208a355950eafd1ec15debad10265e6d"><div class="ttname"><a href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48a208a355950eafd1ec15debad10265e6d">PCILIB_KMEM_REUSE_REUSED</a></div><div class="ttdeci">@ PCILIB_KMEM_REUSE_REUSED</div><div class="ttdoc">Already allocated kernel memory was re-used.</div><div class="ttdef"><b>Definition:</b> kmem.h:58</div></div>
<div class="ttc" id="akmem_8h_html_ad9593c5ba7752ae78acd1e3164d38d48a3554ace3999de348dfa20720cf3a2a76"><div class="ttname"><a href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48a3554ace3999de348dfa20720cf3a2a76">PCILIB_KMEM_REUSE_PERSISTENT</a></div><div class="ttdeci">@ PCILIB_KMEM_REUSE_PERSISTENT</div><div class="ttdoc">Flag indicating that persistent kmem was allocated/reused (will not be cleaned on pcilib_free_kernel_...</div><div class="ttdef"><b>Definition:</b> kmem.h:60</div></div>
<div class="ttc" id="akmem_8h_html_ad9593c5ba7752ae78acd1e3164d38d48a8c3b52eba08a1a3c1b8cf255be084964"><div class="ttname"><a href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48a8c3b52eba08a1a3c1b8cf255be084964">PCILIB_KMEM_REUSE_PARTIAL</a></div><div class="ttdeci">@ PCILIB_KMEM_REUSE_PARTIAL</div><div class="ttdoc">The kernel memory was partially re-used and partially allocated.</div><div class="ttdef"><b>Definition:</b> kmem.h:59</div></div>
<div class="ttc" id="akmem_8h_html_ad9593c5ba7752ae78acd1e3164d38d48ac2f1419981871c6e37c31a875adf7610"><div class="ttname"><a href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48ac2f1419981871c6e37c31a875adf7610">PCILIB_KMEM_REUSE_HARDWARE</a></div><div class="ttdeci">@ PCILIB_KMEM_REUSE_HARDWARE</div><div class="ttdoc">Flag indicating that kmem may be used by hardware device.</div><div class="ttdef"><b>Definition:</b> kmem.h:61</div></div>
<div class="ttc" id="akmem_8h_html_ad9593c5ba7752ae78acd1e3164d38d48afc1ff2c9dcafec4ab5fb5cc7481e4c68"><div class="ttname"><a href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48afc1ff2c9dcafec4ab5fb5cc7481e4c68">PCILIB_KMEM_REUSE_ALLOCATED</a></div><div class="ttdeci">@ PCILIB_KMEM_REUSE_ALLOCATED</div><div class="ttdoc">The kernel memory was allocated anew.</div><div class="ttdef"><b>Definition:</b> kmem.h:57</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a565630a72af55e4cce61925d417dd644" name="a565630a72af55e4cce61925d417dd644"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a565630a72af55e4cce61925d417dd644">&#9670;&#160;</a></span>pcilib_kmem_sync_direction_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="kmem_8h.html#a565630a72af55e4cce61925d417dd644">pcilib_kmem_sync_direction_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a565630a72af55e4cce61925d417dd644aa3350faa48ff7863359a026eabe2f7d4" name="a565630a72af55e4cce61925d417dd644aa3350faa48ff7863359a026eabe2f7d4"></a>PCILIB_KMEM_SYNC_BIDIRECTIONAL&#160;</td><td class="fielddoc"><p >Two-way synchronization (should not be used) </p>
</td></tr>
<tr><td class="fieldname"><a id="a565630a72af55e4cce61925d417dd644a9f1b6ddc0b9cbfffafdfac5c41c8c746" name="a565630a72af55e4cce61925d417dd644a9f1b6ddc0b9cbfffafdfac5c41c8c746"></a>PCILIB_KMEM_SYNC_TODEVICE&#160;</td><td class="fielddoc"><p >Allow device to read the data in the DMA-able buffer. </p>
</td></tr>
<tr><td class="fieldname"><a id="a565630a72af55e4cce61925d417dd644ae02e8101a1e3628a8966ddf15094d19a" name="a565630a72af55e4cce61925d417dd644ae02e8101a1e3628a8966ddf15094d19a"></a>PCILIB_KMEM_SYNC_FROMDEVICE&#160;</td><td class="fielddoc"><p >Allow application to read the data written by device in the DMA-able buffer. </p>
</td></tr>
</table>
<div class="fragment"><div class="line"><span class="lineno">   39</span>             {</div>
<div class="line"><span class="lineno">   40</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a565630a72af55e4cce61925d417dd644aa3350faa48ff7863359a026eabe2f7d4">PCILIB_KMEM_SYNC_BIDIRECTIONAL</a> = 0,                 </div>
<div class="line"><span class="lineno">   41</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a565630a72af55e4cce61925d417dd644a9f1b6ddc0b9cbfffafdfac5c41c8c746">PCILIB_KMEM_SYNC_TODEVICE</a> = 1,                      </div>
<div class="line"><span class="lineno">   42</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a565630a72af55e4cce61925d417dd644ae02e8101a1e3628a8966ddf15094d19a">PCILIB_KMEM_SYNC_FROMDEVICE</a> = 2                     </div>
<div class="line"><span class="lineno">   43</span>} <a class="code hl_enumeration" href="kmem_8h.html#a565630a72af55e4cce61925d417dd644">pcilib_kmem_sync_direction_t</a>;</div>
<div class="ttc" id="akmem_8h_html_a565630a72af55e4cce61925d417dd644"><div class="ttname"><a href="kmem_8h.html#a565630a72af55e4cce61925d417dd644">pcilib_kmem_sync_direction_t</a></div><div class="ttdeci">pcilib_kmem_sync_direction_t</div><div class="ttdef"><b>Definition:</b> kmem.h:39</div></div>
<div class="ttc" id="akmem_8h_html_a565630a72af55e4cce61925d417dd644a9f1b6ddc0b9cbfffafdfac5c41c8c746"><div class="ttname"><a href="kmem_8h.html#a565630a72af55e4cce61925d417dd644a9f1b6ddc0b9cbfffafdfac5c41c8c746">PCILIB_KMEM_SYNC_TODEVICE</a></div><div class="ttdeci">@ PCILIB_KMEM_SYNC_TODEVICE</div><div class="ttdoc">Allow device to read the data in the DMA-able buffer.</div><div class="ttdef"><b>Definition:</b> kmem.h:41</div></div>
<div class="ttc" id="akmem_8h_html_a565630a72af55e4cce61925d417dd644aa3350faa48ff7863359a026eabe2f7d4"><div class="ttname"><a href="kmem_8h.html#a565630a72af55e4cce61925d417dd644aa3350faa48ff7863359a026eabe2f7d4">PCILIB_KMEM_SYNC_BIDIRECTIONAL</a></div><div class="ttdeci">@ PCILIB_KMEM_SYNC_BIDIRECTIONAL</div><div class="ttdoc">Two-way synchronization (should not be used)</div><div class="ttdef"><b>Definition:</b> kmem.h:40</div></div>
<div class="ttc" id="akmem_8h_html_a565630a72af55e4cce61925d417dd644ae02e8101a1e3628a8966ddf15094d19a"><div class="ttname"><a href="kmem_8h.html#a565630a72af55e4cce61925d417dd644ae02e8101a1e3628a8966ddf15094d19a">PCILIB_KMEM_SYNC_FROMDEVICE</a></div><div class="ttdeci">@ PCILIB_KMEM_SYNC_FROMDEVICE</div><div class="ttdoc">Allow application to read the data written by device in the DMA-able buffer.</div><div class="ttdef"><b>Definition:</b> kmem.h:42</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a0026872c63f522459ae8510c9653ba66" name="a0026872c63f522459ae8510c9653ba66"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0026872c63f522459ae8510c9653ba66">&#9670;&#160;</a></span>pcilib_kmem_type_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66">pcilib_kmem_type_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a0026872c63f522459ae8510c9653ba66aae8d4d2486db17ad068f56e3cff6d1ef" name="a0026872c63f522459ae8510c9653ba66aae8d4d2486db17ad068f56e3cff6d1ef"></a>PCILIB_KMEM_TYPE_CONSISTENT&#160;</td><td class="fielddoc"><p >Consistent memory can be simultaneously accessed by the device and applications and is normally used for DMA descriptors. </p>
</td></tr>
<tr><td class="fieldname"><a id="a0026872c63f522459ae8510c9653ba66a83c7f4b602188c78ddf226498890d331" name="a0026872c63f522459ae8510c9653ba66a83c7f4b602188c78ddf226498890d331"></a>PCILIB_KMEM_TYPE_PAGE&#160;</td><td class="fielddoc"><p >A number of physically consequitive pages of memory. </p>
</td></tr>
<tr><td class="fieldname"><a id="a0026872c63f522459ae8510c9653ba66aaf1e868d635e1a2391b6a95fcc0487e9" name="a0026872c63f522459ae8510c9653ba66aaf1e868d635e1a2391b6a95fcc0487e9"></a>PCILIB_KMEM_TYPE_DMA_S2C_PAGE&#160;</td><td class="fielddoc"><p >Memory pages mapped for S2C DMA operation (device reads) </p>
</td></tr>
<tr><td class="fieldname"><a id="a0026872c63f522459ae8510c9653ba66a2dce4064644436c3fbacb4e6f528a164" name="a0026872c63f522459ae8510c9653ba66a2dce4064644436c3fbacb4e6f528a164"></a>PCILIB_KMEM_TYPE_DMA_C2S_PAGE&#160;</td><td class="fielddoc"><p >Memory pages mapped for C2S DMA operation (device writes) </p>
</td></tr>
<tr><td class="fieldname"><a id="a0026872c63f522459ae8510c9653ba66a5eae6683f379c25954fcdab27284d200" name="a0026872c63f522459ae8510c9653ba66a5eae6683f379c25954fcdab27284d200"></a>PCILIB_KMEM_TYPE_REGION&#160;</td><td class="fielddoc"><p >Just map buffers to the contiguous user-supplied memory region (normally reserved during the boot with option memmap=512M$2G) </p>
</td></tr>
<tr><td class="fieldname"><a id="a0026872c63f522459ae8510c9653ba66a9848db80fded8e8f65817e893d629353" name="a0026872c63f522459ae8510c9653ba66a9848db80fded8e8f65817e893d629353"></a>PCILIB_KMEM_TYPE_REGION_S2C&#160;</td><td class="fielddoc"><p >Memory region mapped for S2C DMA operation (device reads) </p>
</td></tr>
<tr><td class="fieldname"><a id="a0026872c63f522459ae8510c9653ba66af0e713201866ba74693dbd47260b27ee" name="a0026872c63f522459ae8510c9653ba66af0e713201866ba74693dbd47260b27ee"></a>PCILIB_KMEM_TYPE_REGION_C2S&#160;</td><td class="fielddoc"><p >Memory region mapped for C2S DMA operation (device writes. </p>
</td></tr>
</table>
<div class="fragment"><div class="line"><span class="lineno">   20</span>             {</div>
<div class="line"><span class="lineno">   21</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66aae8d4d2486db17ad068f56e3cff6d1ef">PCILIB_KMEM_TYPE_CONSISTENT</a> = 0x00000,              </div>
<div class="line"><span class="lineno">   22</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a83c7f4b602188c78ddf226498890d331">PCILIB_KMEM_TYPE_PAGE</a> = 0x10000,                    </div>
<div class="line"><span class="lineno">   23</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66aaf1e868d635e1a2391b6a95fcc0487e9">PCILIB_KMEM_TYPE_DMA_S2C_PAGE</a> = 0x10001,            </div>
<div class="line"><span class="lineno">   24</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a2dce4064644436c3fbacb4e6f528a164">PCILIB_KMEM_TYPE_DMA_C2S_PAGE</a> = 0x10002,            </div>
<div class="line"><span class="lineno">   25</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a5eae6683f379c25954fcdab27284d200">PCILIB_KMEM_TYPE_REGION</a> = 0x20000,                  </div>
<div class="line"><span class="lineno">   26</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a9848db80fded8e8f65817e893d629353">PCILIB_KMEM_TYPE_REGION_S2C</a> = 0x20001,              </div>
<div class="line"><span class="lineno">   27</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66af0e713201866ba74693dbd47260b27ee">PCILIB_KMEM_TYPE_REGION_C2S</a> = 0x20002               </div>
<div class="line"><span class="lineno">   28</span>} <a class="code hl_enumeration" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66">pcilib_kmem_type_t</a>;</div>
<div class="ttc" id="akmem_8h_html_a0026872c63f522459ae8510c9653ba66"><div class="ttname"><a href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66">pcilib_kmem_type_t</a></div><div class="ttdeci">pcilib_kmem_type_t</div><div class="ttdef"><b>Definition:</b> kmem.h:20</div></div>
<div class="ttc" id="akmem_8h_html_a0026872c63f522459ae8510c9653ba66a2dce4064644436c3fbacb4e6f528a164"><div class="ttname"><a href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a2dce4064644436c3fbacb4e6f528a164">PCILIB_KMEM_TYPE_DMA_C2S_PAGE</a></div><div class="ttdeci">@ PCILIB_KMEM_TYPE_DMA_C2S_PAGE</div><div class="ttdoc">Memory pages mapped for C2S DMA operation (device writes)</div><div class="ttdef"><b>Definition:</b> kmem.h:24</div></div>
<div class="ttc" id="akmem_8h_html_a0026872c63f522459ae8510c9653ba66a5eae6683f379c25954fcdab27284d200"><div class="ttname"><a href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a5eae6683f379c25954fcdab27284d200">PCILIB_KMEM_TYPE_REGION</a></div><div class="ttdeci">@ PCILIB_KMEM_TYPE_REGION</div><div class="ttdoc">Just map buffers to the contiguous user-supplied memory region (normally reserved during the boot wit...</div><div class="ttdef"><b>Definition:</b> kmem.h:25</div></div>
<div class="ttc" id="akmem_8h_html_a0026872c63f522459ae8510c9653ba66a83c7f4b602188c78ddf226498890d331"><div class="ttname"><a href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a83c7f4b602188c78ddf226498890d331">PCILIB_KMEM_TYPE_PAGE</a></div><div class="ttdeci">@ PCILIB_KMEM_TYPE_PAGE</div><div class="ttdoc">A number of physically consequitive pages of memory.</div><div class="ttdef"><b>Definition:</b> kmem.h:22</div></div>
<div class="ttc" id="akmem_8h_html_a0026872c63f522459ae8510c9653ba66a9848db80fded8e8f65817e893d629353"><div class="ttname"><a href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a9848db80fded8e8f65817e893d629353">PCILIB_KMEM_TYPE_REGION_S2C</a></div><div class="ttdeci">@ PCILIB_KMEM_TYPE_REGION_S2C</div><div class="ttdoc">Memory region mapped for S2C DMA operation (device reads)</div><div class="ttdef"><b>Definition:</b> kmem.h:26</div></div>
<div class="ttc" id="akmem_8h_html_a0026872c63f522459ae8510c9653ba66aae8d4d2486db17ad068f56e3cff6d1ef"><div class="ttname"><a href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66aae8d4d2486db17ad068f56e3cff6d1ef">PCILIB_KMEM_TYPE_CONSISTENT</a></div><div class="ttdeci">@ PCILIB_KMEM_TYPE_CONSISTENT</div><div class="ttdoc">Consistent memory can be simultaneously accessed by the device and applications and is normally used ...</div><div class="ttdef"><b>Definition:</b> kmem.h:21</div></div>
<div class="ttc" id="akmem_8h_html_a0026872c63f522459ae8510c9653ba66aaf1e868d635e1a2391b6a95fcc0487e9"><div class="ttname"><a href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66aaf1e868d635e1a2391b6a95fcc0487e9">PCILIB_KMEM_TYPE_DMA_S2C_PAGE</a></div><div class="ttdeci">@ PCILIB_KMEM_TYPE_DMA_S2C_PAGE</div><div class="ttdoc">Memory pages mapped for S2C DMA operation (device reads)</div><div class="ttdef"><b>Definition:</b> kmem.h:23</div></div>
<div class="ttc" id="akmem_8h_html_a0026872c63f522459ae8510c9653ba66af0e713201866ba74693dbd47260b27ee"><div class="ttname"><a href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66af0e713201866ba74693dbd47260b27ee">PCILIB_KMEM_TYPE_REGION_C2S</a></div><div class="ttdeci">@ PCILIB_KMEM_TYPE_REGION_C2S</div><div class="ttdoc">Memory region mapped for C2S DMA operation (device writes.</div><div class="ttdef"><b>Definition:</b> kmem.h:27</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a30160d6ee0113e9eb63b28f62f8bc485" name="a30160d6ee0113e9eb63b28f62f8bc485"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30160d6ee0113e9eb63b28f62f8bc485">&#9670;&#160;</a></span>pcilib_kmem_use_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485">pcilib_kmem_use_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a30160d6ee0113e9eb63b28f62f8bc485a9826745d3ad33106ff3c5a3e7cad6671" name="a30160d6ee0113e9eb63b28f62f8bc485a9826745d3ad33106ff3c5a3e7cad6671"></a>PCILIB_KMEM_USE_STANDARD&#160;</td><td class="fielddoc"><p >Undefined use, buffers of standard use are not grouped together and can be used individually. </p>
</td></tr>
<tr><td class="fieldname"><a id="a30160d6ee0113e9eb63b28f62f8bc485a86e03da7b667a30da103ba06cc016715" name="a30160d6ee0113e9eb63b28f62f8bc485a86e03da7b667a30da103ba06cc016715"></a>PCILIB_KMEM_USE_DMA_RING&#160;</td><td class="fielddoc"><p >The kmem used for DMA descriptor, the sub type specifies the id of considered DMA engine. </p>
</td></tr>
<tr><td class="fieldname"><a id="a30160d6ee0113e9eb63b28f62f8bc485a81c9095dc0b2c684ebb37067c363379b" name="a30160d6ee0113e9eb63b28f62f8bc485a81c9095dc0b2c684ebb37067c363379b"></a>PCILIB_KMEM_USE_DMA_PAGES&#160;</td><td class="fielddoc"><p >The kmem used for DMA buffers, the sub type specifies the address of considered DMA engine (can be engine specific) </p>
</td></tr>
<tr><td class="fieldname"><a id="a30160d6ee0113e9eb63b28f62f8bc485a9eebfad30fdeb2394e3f19692203a5b0" name="a30160d6ee0113e9eb63b28f62f8bc485a9eebfad30fdeb2394e3f19692203a5b0"></a>PCILIB_KMEM_USE_SOFTWARE_REGISTERS&#160;</td><td class="fielddoc"><p >The kmem used to store software registers, the sub type holds the bank address. </p>
</td></tr>
<tr><td class="fieldname"><a id="a30160d6ee0113e9eb63b28f62f8bc485aba713c036118f491d984a4b754b4ddd7" name="a30160d6ee0113e9eb63b28f62f8bc485aba713c036118f491d984a4b754b4ddd7"></a>PCILIB_KMEM_USE_LOCKS&#160;</td><td class="fielddoc"><p >The kmem used to hold locks, the sub type is not used. </p>
</td></tr>
<tr><td class="fieldname"><a id="a30160d6ee0113e9eb63b28f62f8bc485aa1c08fb7e60c934799678644d6e85068" name="a30160d6ee0113e9eb63b28f62f8bc485aa1c08fb7e60c934799678644d6e85068"></a>PCILIB_KMEM_USE_USER&#160;</td><td class="fielddoc"><p >Further uses can be defined by event engines. </p>
</td></tr>
</table>
<div class="fragment"><div class="line"><span class="lineno">   30</span>             {</div>
<div class="line"><span class="lineno">   31</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485a9826745d3ad33106ff3c5a3e7cad6671">PCILIB_KMEM_USE_STANDARD</a> = 0,                       </div>
<div class="line"><span class="lineno">   32</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485a86e03da7b667a30da103ba06cc016715">PCILIB_KMEM_USE_DMA_RING</a> = 1,                       </div>
<div class="line"><span class="lineno">   33</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485a81c9095dc0b2c684ebb37067c363379b">PCILIB_KMEM_USE_DMA_PAGES</a> = 2,                      </div>
<div class="line"><span class="lineno">   34</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485a9eebfad30fdeb2394e3f19692203a5b0">PCILIB_KMEM_USE_SOFTWARE_REGISTERS</a> = 3,             </div>
<div class="line"><span class="lineno">   35</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485aba713c036118f491d984a4b754b4ddd7">PCILIB_KMEM_USE_LOCKS</a> = 4,                          </div>
<div class="line"><span class="lineno">   36</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485aa1c08fb7e60c934799678644d6e85068">PCILIB_KMEM_USE_USER</a> = 0x10                         </div>
<div class="line"><span class="lineno">   37</span>} <a class="code hl_enumeration" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485">pcilib_kmem_use_t</a>;</div>
<div class="ttc" id="akmem_8h_html_a30160d6ee0113e9eb63b28f62f8bc485"><div class="ttname"><a href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485">pcilib_kmem_use_t</a></div><div class="ttdeci">pcilib_kmem_use_t</div><div class="ttdef"><b>Definition:</b> kmem.h:30</div></div>
<div class="ttc" id="akmem_8h_html_a30160d6ee0113e9eb63b28f62f8bc485a81c9095dc0b2c684ebb37067c363379b"><div class="ttname"><a href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485a81c9095dc0b2c684ebb37067c363379b">PCILIB_KMEM_USE_DMA_PAGES</a></div><div class="ttdeci">@ PCILIB_KMEM_USE_DMA_PAGES</div><div class="ttdoc">The kmem used for DMA buffers, the sub type specifies the address of considered DMA engine (can be en...</div><div class="ttdef"><b>Definition:</b> kmem.h:33</div></div>
<div class="ttc" id="akmem_8h_html_a30160d6ee0113e9eb63b28f62f8bc485a86e03da7b667a30da103ba06cc016715"><div class="ttname"><a href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485a86e03da7b667a30da103ba06cc016715">PCILIB_KMEM_USE_DMA_RING</a></div><div class="ttdeci">@ PCILIB_KMEM_USE_DMA_RING</div><div class="ttdoc">The kmem used for DMA descriptor, the sub type specifies the id of considered DMA engine.</div><div class="ttdef"><b>Definition:</b> kmem.h:32</div></div>
<div class="ttc" id="akmem_8h_html_a30160d6ee0113e9eb63b28f62f8bc485a9826745d3ad33106ff3c5a3e7cad6671"><div class="ttname"><a href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485a9826745d3ad33106ff3c5a3e7cad6671">PCILIB_KMEM_USE_STANDARD</a></div><div class="ttdeci">@ PCILIB_KMEM_USE_STANDARD</div><div class="ttdoc">Undefined use, buffers of standard use are not grouped together and can be used individually.</div><div class="ttdef"><b>Definition:</b> kmem.h:31</div></div>
<div class="ttc" id="akmem_8h_html_a30160d6ee0113e9eb63b28f62f8bc485a9eebfad30fdeb2394e3f19692203a5b0"><div class="ttname"><a href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485a9eebfad30fdeb2394e3f19692203a5b0">PCILIB_KMEM_USE_SOFTWARE_REGISTERS</a></div><div class="ttdeci">@ PCILIB_KMEM_USE_SOFTWARE_REGISTERS</div><div class="ttdoc">The kmem used to store software registers, the sub type holds the bank address.</div><div class="ttdef"><b>Definition:</b> kmem.h:34</div></div>
<div class="ttc" id="akmem_8h_html_a30160d6ee0113e9eb63b28f62f8bc485aa1c08fb7e60c934799678644d6e85068"><div class="ttname"><a href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485aa1c08fb7e60c934799678644d6e85068">PCILIB_KMEM_USE_USER</a></div><div class="ttdeci">@ PCILIB_KMEM_USE_USER</div><div class="ttdoc">Further uses can be defined by event engines.</div><div class="ttdef"><b>Definition:</b> kmem.h:36</div></div>
<div class="ttc" id="akmem_8h_html_a30160d6ee0113e9eb63b28f62f8bc485aba713c036118f491d984a4b754b4ddd7"><div class="ttname"><a href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485aba713c036118f491d984a4b754b4ddd7">PCILIB_KMEM_USE_LOCKS</a></div><div class="ttdeci">@ PCILIB_KMEM_USE_LOCKS</div><div class="ttdoc">The kmem used to hold locks, the sub type is not used.</div><div class="ttdef"><b>Definition:</b> kmem.h:35</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a1dd3f4385e8051d028281c93490b76ec" name="a1dd3f4385e8051d028281c93490b76ec"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1dd3f4385e8051d028281c93490b76ec">&#9670;&#160;</a></span>pcilib_tristate_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ec">pcilib_tristate_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a1dd3f4385e8051d028281c93490b76ecaf41596fde03fab631d50b01a97aa223d" name="a1dd3f4385e8051d028281c93490b76ecaf41596fde03fab631d50b01a97aa223d"></a>PCILIB_TRISTATE_NO&#160;</td><td class="fielddoc"><p >All values are evaluated as false. </p>
</td></tr>
<tr><td class="fieldname"><a id="a1dd3f4385e8051d028281c93490b76eca70a51fcff782e3178d917f3aa502bb87" name="a1dd3f4385e8051d028281c93490b76eca70a51fcff782e3178d917f3aa502bb87"></a>PCILIB_TRISTATE_PARTIAL&#160;</td><td class="fielddoc"><p >Some values are evaluated as false and others as true. </p>
</td></tr>
<tr><td class="fieldname"><a id="a1dd3f4385e8051d028281c93490b76ecaed2f3179347058cf78c4337036b8e765" name="a1dd3f4385e8051d028281c93490b76ecaed2f3179347058cf78c4337036b8e765"></a>PCILIB_TRISTATE_YES&#160;</td><td class="fielddoc"><p >All values are evaluated as true. </p>
</td></tr>
</table>
<div class="fragment"><div class="line"><span class="lineno">    9</span>             {</div>
<div class="line"><span class="lineno">   10</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaf41596fde03fab631d50b01a97aa223d">PCILIB_TRISTATE_NO</a> = 0,                             </div>
<div class="line"><span class="lineno">   11</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76eca70a51fcff782e3178d917f3aa502bb87">PCILIB_TRISTATE_PARTIAL</a> = 1,                        </div>
<div class="line"><span class="lineno">   12</span>    <a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaed2f3179347058cf78c4337036b8e765">PCILIB_TRISTATE_YES</a> = 2                             </div>
<div class="line"><span class="lineno">   13</span>} <a class="code hl_enumeration" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ec">pcilib_tristate_t</a>;</div>
<div class="ttc" id="akmem_8h_html_a1dd3f4385e8051d028281c93490b76ec"><div class="ttname"><a href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ec">pcilib_tristate_t</a></div><div class="ttdeci">pcilib_tristate_t</div><div class="ttdef"><b>Definition:</b> kmem.h:9</div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ac6559934a4616cbb9125caf2c1f8908e" name="ac6559934a4616cbb9125caf2c1f8908e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac6559934a4616cbb9125caf2c1f8908e">&#9670;&#160;</a></span>pcilib_alloc_kernel_memory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> * pcilib_alloc_kernel_memory </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66">pcilib_kmem_type_t</a>&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>nmemb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>alignment</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485">pcilib_kmem_use_t</a>&#160;</td>
          <td class="paramname"><em>use</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcd">pcilib_kmem_flags_t</a>&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function either allocates new buffers in the kernel space or just re-uses existing buffers. </p>
<p >Sometimes kernel memory is allocated for the specific use-case, for example to provide buffers for DMA engine. It is possible to specify intended use using <code>use</code> parameter. The kernel memory with the specified use (i.e. <code>use</code> != 0) can be declared persistent (<code>flags</code> include <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda7cd91729fe864a6ae9f0192909f8cde6" title="Sets persistent mode.">PCILIB_KMEM_FLAG_PERSISTENT</a>). Such memory will not be de-allocated on clean-up and will be maintained by the kernel module across the runs of various pcilib applications. To re-use persistent kernel memory, <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda074f7eaee0589d2d0eb90b9807f755cf" title="Try to reuse existing buffer with the same use &amp; item.">PCILIB_KMEM_FLAG_REUSE</a> should be set. In this case, the pcilib will either allocate new kernel memory or re-use the already allocated kernel buffers with the specified <code>use</code>. If <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda074f7eaee0589d2d0eb90b9807f755cf" title="Try to reuse existing buffer with the same use &amp; item.">PCILIB_KMEM_FLAG_REUSE</a> is not set, but the kernel memory with the specified use is already allocated, an error will be returned.</p>
<p >It is also possible to allocate persistent kernel memory which can be execlusively used by a single process. The <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdad975c8226c758c467a0ccfadb8d7552e" title="Allow only a single application accessing a specified use &amp; item.">PCILIB_KMEM_FLAG_EXCLUSIVE</a> flag have to be provided to <a class="el" href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e" title="This function either allocates new buffers in the kernel space or just re-uses existing buffers.">pcilib_alloc_kernel_memory()</a> function in this case. Only a single process may call hold a reference to kernel memory. Before next process would be able to obtain it, the process holding the reference should return it using <a class="el" href="kmem_8h.html#a77eed4dcaa5a719b767ed275c332148e" title="This function either frees the allocated kernel memory or just releases some of the references.">pcilib_free_kernel_memory()</a> call. For example, DMA engine uses exclusive kernel memory to guarantee that exactly one process is controlling DMA operations.</p>
<p >To clean up allocated persistent kernel memory, <a class="el" href="kmem_8h.html#a77eed4dcaa5a719b767ed275c332148e" title="This function either frees the allocated kernel memory or just releases some of the references.">pcilib_free_kernel_memory()</a> have to be called with <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda7cd91729fe864a6ae9f0192909f8cde6" title="Sets persistent mode.">PCILIB_KMEM_FLAG_PERSISTENT</a> flag set.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">type</td><td>- specifies type of allocation (simple pages, DMA pages, consistent memory, etc.) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">nmemb</td><td>- specifies number of buffers to allocated </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>- specifies the size of each buffer in bytes </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">alignment</td><td>- specifies required alignment, the bus addresses are aligned for PCI-mapped buffers and physical addresses are aligned for the rest (if bounce buffers are used, the physical and bus addresses are not always have the same alignment) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">use</td><td>- specifies how the memory will be used (to store software registers, locks, DMA buffers, etc.) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>- various flags defining how buffers should be re-used/allocated and, that, should happen on <a class="el" href="kmem_8h.html#a77eed4dcaa5a719b767ed275c332148e" title="This function either frees the allocated kernel memory or just releases some of the references.">pcilib_free_kernel_memory()</a> </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- pointer on context with allocated kernel memory or NULL in case of error </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   61</span>                                                                                                                                                                                        {</div>
<div class="line"><span class="lineno">   62</span>    <span class="keywordtype">int</span> err = 0;</div>
<div class="line"><span class="lineno">   63</span>    <span class="keywordtype">char</span> error[256];</div>
<div class="line"><span class="lineno">   64</span>    </div>
<div class="line"><span class="lineno">   65</span>    <span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="lineno">   66</span>    <span class="keywordtype">size_t</span> i, allocated = nmemb;</div>
<div class="line"><span class="lineno">   67</span>    <span class="keywordtype">void</span> *addr;</div>
<div class="line"><span class="lineno">   68</span>    </div>
<div class="line"><span class="lineno">   69</span>    <a class="code hl_enumeration" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ec">pcilib_tristate_t</a> reused = <a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaf41596fde03fab631d50b01a97aa223d">PCILIB_TRISTATE_NO</a>;</div>
<div class="line"><span class="lineno">   70</span>    <span class="keywordtype">int</span> persistent = -1;</div>
<div class="line"><span class="lineno">   71</span>    <span class="keywordtype">int</span> hardware = -1;</div>
<div class="line"><span class="lineno">   72</span> </div>
<div class="line"><span class="lineno">   73</span>    kmem_handle_t kh = {0};</div>
<div class="line"><span class="lineno">   74</span>    </div>
<div class="line"><span class="lineno">   75</span>    <a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a> *kbuf = (<a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a>*)malloc(<span class="keyword">sizeof</span>(<a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a>) + nmemb * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structpcilib__kmem__addr__t.html">pcilib_kmem_addr_t</a>));</div>
<div class="line"><span class="lineno">   76</span>    <span class="keywordflow">if</span> (!kbuf) {</div>
<div class="line"><span class="lineno">   77</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;Memory allocation has failed&quot;</span>);</div>
<div class="line"><span class="lineno">   78</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">   79</span>    }</div>
<div class="line"><span class="lineno">   80</span>    </div>
<div class="line"><span class="lineno">   81</span>    memset(kbuf, 0, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a>) + nmemb * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structpcilib__kmem__addr__t.html">pcilib_kmem_addr_t</a>));</div>
<div class="line"><span class="lineno">   82</span> </div>
<div class="line"><span class="lineno">   83</span>    err = <a class="code hl_function" href="locking_8c.html#adbf250829f88c240473e38fc0224ed5f">pcilib_lock_global</a>(ctx);</div>
<div class="line"><span class="lineno">   84</span>    <span class="keywordflow">if</span> (err) {</div>
<div class="line"><span class="lineno">   85</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;Error (%i) acquiring mmap lock&quot;</span>, err);</div>
<div class="line"><span class="lineno">   86</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">   87</span>    }</div>
<div class="line"><span class="lineno">   88</span> </div>
<div class="line"><span class="lineno">   89</span>    ret = ioctl( ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a97959ae9b1ab77309f0afec2b62d283c">handle</a>, PCIDRIVER_IOC_MMAP_MODE, PCIDRIVER_MMAP_KMEM );</div>
<div class="line"><span class="lineno">   90</span>    <span class="keywordflow">if</span> (ret) {</div>
<div class="line"><span class="lineno">   91</span>        <a class="code hl_function" href="locking_8c.html#aee7b665a4a015a315d06c5314dc6e1eb">pcilib_unlock_global</a>(ctx);</div>
<div class="line"><span class="lineno">   92</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;PCIDRIVER_IOC_MMAP_MODE ioctl have failed&quot;</span>);</div>
<div class="line"><span class="lineno">   93</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">   94</span>    }</div>
<div class="line"><span class="lineno">   95</span> </div>
<div class="line"><span class="lineno">   96</span>    kh.type = type;</div>
<div class="line"><span class="lineno">   97</span>    kh.size = size;</div>
<div class="line"><span class="lineno">   98</span>    kh.align = alignment;</div>
<div class="line"><span class="lineno">   99</span>    kh.use = use;</div>
<div class="line"><span class="lineno">  100</span> </div>
<div class="line"><span class="lineno">  101</span>    <span class="keywordflow">if</span> ((type&amp;<a class="code hl_define" href="kmem_8h.html#afa29a33448c2617f0662db45afdbbd32">PCILIB_KMEM_TYPE_MASK</a>) == <a class="code hl_enumvalue" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a5eae6683f379c25954fcdab27284d200">PCILIB_KMEM_TYPE_REGION</a>) {</div>
<div class="line"><span class="lineno">  102</span>        kh.align = 0;</div>
<div class="line"><span class="lineno">  103</span>    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((type&amp;<a class="code hl_define" href="kmem_8h.html#afa29a33448c2617f0662db45afdbbd32">PCILIB_KMEM_TYPE_MASK</a>) != <a class="code hl_enumvalue" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a83c7f4b602188c78ddf226498890d331">PCILIB_KMEM_TYPE_PAGE</a>) {</div>
<div class="line"><span class="lineno">  104</span>        kh.size += alignment;</div>
<div class="line"><span class="lineno">  105</span>    }</div>
<div class="line"><span class="lineno">  106</span> </div>
<div class="line"><span class="lineno">  107</span>    <span class="keywordflow">for</span> ( i = 0; (i &lt; nmemb)||(flags&amp;<a class="code hl_enumvalue" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdaa65929a5db6e7a0cf48e520d1ab56bfc">PCILIB_KMEM_FLAG_MASS</a>); i++) {</div>
<div class="line"><span class="lineno">  108</span>        kh.item = i;</div>
<div class="line"><span class="lineno">  109</span>        kh.flags = flags;</div>
<div class="line"><span class="lineno">  110</span> </div>
<div class="line"><span class="lineno">  111</span>        <span class="keywordflow">if</span> (i &gt;= nmemb) </div>
<div class="line"><span class="lineno">  112</span>            kh.flags |= KMEM_FLAG_TRY;</div>
<div class="line"><span class="lineno">  113</span> </div>
<div class="line"><span class="lineno">  114</span>        <span class="keywordflow">if</span> ((type&amp;<a class="code hl_define" href="kmem_8h.html#afa29a33448c2617f0662db45afdbbd32">PCILIB_KMEM_TYPE_MASK</a>) == <a class="code hl_enumvalue" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a5eae6683f379c25954fcdab27284d200">PCILIB_KMEM_TYPE_REGION</a>) {</div>
<div class="line"><span class="lineno">  115</span>            kh.pa = alignment + i * size;</div>
<div class="line"><span class="lineno">  116</span>        }</div>
<div class="line"><span class="lineno">  117</span>        </div>
<div class="line"><span class="lineno">  118</span>        ret = ioctl(ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a97959ae9b1ab77309f0afec2b62d283c">handle</a>, PCIDRIVER_IOC_KMEM_ALLOC, &amp;kh);</div>
<div class="line"><span class="lineno">  119</span>        <span class="keywordflow">if</span> (ret) {</div>
<div class="line"><span class="lineno">  120</span>            kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#ae726d44c671b0f489c42b9e5835e97c5">n_blocks</a> = i;</div>
<div class="line"><span class="lineno">  121</span>            <span class="keywordflow">if</span> ((i &lt; nmemb)||(errno != ENOENT)) {</div>
<div class="line"><span class="lineno">  122</span>                err = <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca8a1b45502224b7b2659e0014d9acf50c">PCILIB_ERROR_FAILED</a>;</div>
<div class="line"><span class="lineno">  123</span>                <span class="keywordflow">if</span> (errno == EINVAL) {</div>
<div class="line"><span class="lineno">  124</span>                    <span class="keywordflow">if</span> (kh.type != type)</div>
<div class="line"><span class="lineno">  125</span>                        sprintf(error, <span class="stringliteral">&quot;Driver prevents us from re-using buffer (use 0x%x, block: %zu),  we have requested type %u but buffer is of type %lu&quot;</span>, use, i, type, kh.type);</div>
<div class="line"><span class="lineno">  126</span>                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (kh.size != size)</div>
<div class="line"><span class="lineno">  127</span>                        sprintf(error, <span class="stringliteral">&quot;Driver prevents us from re-using buffer (use 0x%x, block: %zu),  we have requested size %lu but buffer is of size %lu&quot;</span>, use, i, size, kh.size);</div>
<div class="line"><span class="lineno">  128</span>                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (kh.align != alignment)</div>
<div class="line"><span class="lineno">  129</span>                        sprintf(error, <span class="stringliteral">&quot;Driver prevents us from re-using buffer (use 0x%x, block: %zu),  we have requested alignment %lu but buffer is of alignment %lu&quot;</span>, use, i, size, kh.size);</div>
<div class="line"><span class="lineno">  130</span>                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((kh.flags&amp;KMEM_FLAG_EXCLUSIVE) != (flags&amp;KMEM_FLAG_EXCLUSIVE))</div>
<div class="line"><span class="lineno">  131</span>                        sprintf(error, <span class="stringliteral">&quot;Driver prevents us from re-using buffer (use 0x%x, block: %zu),  we have requested size %s but buffer is of size %s&quot;</span>, use, i, ((flags&amp;KMEM_FLAG_EXCLUSIVE)?<span class="stringliteral">&quot;exclusive&quot;</span>:<span class="stringliteral">&quot;non-exclusive&quot;</span>), ((kh.flags&amp;KMEM_FLAG_EXCLUSIVE)?<span class="stringliteral">&quot;exclusive&quot;</span>:<span class="stringliteral">&quot;non exclusive&quot;</span>));</div>
<div class="line"><span class="lineno">  132</span>                    <span class="keywordflow">else</span> </div>
<div class="line"><span class="lineno">  133</span>                        sprintf(error, <span class="stringliteral">&quot;Driver prevents us from re-using buffer (use 0x%x, block: %zu),  unknown consistency error&quot;</span>, use, i);</div>
<div class="line"><span class="lineno">  134</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (errno == EBUSY) {</div>
<div class="line"><span class="lineno">  135</span>                    sprintf(error, <span class="stringliteral">&quot;Driver prevents us from re-using buffer (use 0x%x, block: %zu),  reuse counter of kmem_entry is overflown&quot;</span>, use, i);</div>
<div class="line"><span class="lineno">  136</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (errno == ENOMEM) {</div>
<div class="line"><span class="lineno">  137</span>                    sprintf(error, <span class="stringliteral">&quot;Driver prevents us from re-using buffer (use 0x%x, block: %zu),  memory allocation (%zu bytes) failed&quot;</span>, use, i, size);</div>
<div class="line"><span class="lineno">  138</span>                } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  139</span>                    sprintf(error, <span class="stringliteral">&quot;Driver prevents us from re-using buffer (use 0x%x, block: %zu),  PCIDRIVER_IOC_KMEM_ALLOC ioctl have failed with errno %i&quot;</span>, use, i, errno);</div>
<div class="line"><span class="lineno">  140</span>                }</div>
<div class="line"><span class="lineno">  141</span>            }</div>
<div class="line"><span class="lineno">  142</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  143</span>        }</div>
<div class="line"><span class="lineno">  144</span>        </div>
<div class="line"><span class="lineno">  145</span>        <span class="keywordflow">if</span> (i &gt;= allocated) {</div>
<div class="line"><span class="lineno">  146</span>            <span class="keywordtype">void</span> *kbuf_new = realloc(kbuf, <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a>) + 2 * allocated * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structpcilib__kmem__addr__t.html">pcilib_kmem_addr_t</a>));</div>
<div class="line"><span class="lineno">  147</span>            <span class="keywordflow">if</span> (!kbuf_new) {</div>
<div class="line"><span class="lineno">  148</span>                kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#ae726d44c671b0f489c42b9e5835e97c5">n_blocks</a> = i;</div>
<div class="line"><span class="lineno">  149</span>                err = <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caa30630d7c09a1fe97acd43439032eb00">PCILIB_ERROR_MEMORY</a>;</div>
<div class="line"><span class="lineno">  150</span>                sprintf(error, <span class="stringliteral">&quot;Failed to allocate extra %zu bytes of user-space memory for kmem structures&quot;</span>, allocated * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structpcilib__kmem__addr__t.html">pcilib_kmem_addr_t</a>));</div>
<div class="line"><span class="lineno">  151</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  152</span>            }</div>
<div class="line"><span class="lineno">  153</span>            memset(kbuf_new + <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a>) + allocated * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structpcilib__kmem__addr__t.html">pcilib_kmem_addr_t</a>) , 0, allocated * <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structpcilib__kmem__addr__t.html">pcilib_kmem_addr_t</a>));</div>
<div class="line"><span class="lineno">  154</span>            kbuf = kbuf_new;</div>
<div class="line"><span class="lineno">  155</span>            allocated *= 2;</div>
<div class="line"><span class="lineno">  156</span>        }</div>
<div class="line"><span class="lineno">  157</span>        </div>
<div class="line"><span class="lineno">  158</span>        kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[i].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#af01a6dc26454d7600edd4b330ef59544">handle_id</a> = kh.handle_id;</div>
<div class="line"><span class="lineno">  159</span>        kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[i].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a0b65654ea7f40cc8f77ada141e9b80c3">pa</a> = kh.pa;</div>
<div class="line"><span class="lineno">  160</span>        kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[i].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a6ef22d1817504c413bb39379eb0ad972">ba</a> = kh.ba;</div>
<div class="line"><span class="lineno">  161</span>        kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[i].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a9ec9640dd3bf2ffa15728ad7029919cf">size</a> = kh.size;</div>
<div class="line"><span class="lineno">  162</span>        </div>
<div class="line"><span class="lineno">  163</span>        <span class="keywordflow">if</span> (!i) reused = (kh.flags&amp;KMEM_FLAG_REUSED)?<a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaed2f3179347058cf78c4337036b8e765">PCILIB_TRISTATE_YES</a>:<a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaf41596fde03fab631d50b01a97aa223d">PCILIB_TRISTATE_NO</a>;</div>
<div class="line"><span class="lineno">  164</span> </div>
<div class="line"><span class="lineno">  165</span>        <span class="keywordflow">if</span> (kh.flags&amp;KMEM_FLAG_REUSED) {</div>
<div class="line"><span class="lineno">  166</span>            <span class="keywordflow">if</span> (!i) reused = <a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaed2f3179347058cf78c4337036b8e765">PCILIB_TRISTATE_YES</a>;</div>
<div class="line"><span class="lineno">  167</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!reused) reused = <a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76eca70a51fcff782e3178d917f3aa502bb87">PCILIB_TRISTATE_PARTIAL</a>;</div>
<div class="line"><span class="lineno">  168</span>        </div>
<div class="line"><span class="lineno">  169</span>            <span class="keywordflow">if</span> (persistent) {</div>
<div class="line"><span class="lineno">  170</span>                <span class="keywordflow">if</span> (persistent &lt; 0) {</div>
<div class="line"><span class="lineno">  171</span>                    <span class="comment">/*if (((flags&amp;PCILIB_KMEM_FLAG_PERSISTENT) == 0)&amp;&amp;(kh.flags&amp;KMEM_FLAG_REUSED_PERSISTENT)) err = PCILIB_ERROR_INVALID_STATE;</span></div>
<div class="line"><span class="lineno">  172</span><span class="comment">                    else*/</span> persistent = (kh.flags&amp;KMEM_FLAG_REUSED_PERSISTENT)?1:0;</div>
<div class="line"><span class="lineno">  173</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((kh.flags&amp;KMEM_FLAG_REUSED_PERSISTENT) == 0) err = <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caed0e669166d0329e7d2c2b5dedf54240">PCILIB_ERROR_INVALID_STATE</a>;</div>
<div class="line"><span class="lineno">  174</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (kh.flags&amp;KMEM_FLAG_REUSED_PERSISTENT) err = <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caed0e669166d0329e7d2c2b5dedf54240">PCILIB_ERROR_INVALID_STATE</a>;</div>
<div class="line"><span class="lineno">  175</span>            <span class="keywordflow">if</span> (err) {</div>
<div class="line"><span class="lineno">  176</span>                kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#ae726d44c671b0f489c42b9e5835e97c5">n_blocks</a> = i + 1;</div>
<div class="line"><span class="lineno">  177</span>                sprintf(error,  <span class="stringliteral">&quot;Mistmatch in persistent modes of the re-used kmem blocks. Current buffer (use 0x%x, block: %zu) is %s, but prior ones %s&quot;</span>, </div>
<div class="line"><span class="lineno">  178</span>                    use, i, ((kh.flags&amp;KMEM_FLAG_REUSED_PERSISTENT)?<span class="stringliteral">&quot;persistent&quot;</span>:<span class="stringliteral">&quot;not persistent&quot;</span>), (persistent?<span class="stringliteral">&quot;are&quot;</span>:<span class="stringliteral">&quot;are not&quot;</span>));</div>
<div class="line"><span class="lineno">  179</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  180</span>            }</div>
<div class="line"><span class="lineno">  181</span> </div>
<div class="line"><span class="lineno">  182</span>            <span class="keywordflow">if</span> (hardware) {</div>
<div class="line"><span class="lineno">  183</span>                <span class="keywordflow">if</span> (hardware &lt; 0) {</div>
<div class="line"><span class="lineno">  184</span>                    <span class="comment">/*if (((flags&amp;PCILIB_KMEM_FLAG_HARDWARE) == 0)&amp;&amp;(kh.flags&amp;KMEM_FLAG_REUSED_HW)) err = PCILIB_ERROR_INVALID_STATE;</span></div>
<div class="line"><span class="lineno">  185</span><span class="comment">                    else*/</span> hardware = (kh.flags&amp;KMEM_FLAG_REUSED_HW)?1:0;</div>
<div class="line"><span class="lineno">  186</span>                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((kh.flags&amp;KMEM_FLAG_REUSED_HW) == 0) err = <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caed0e669166d0329e7d2c2b5dedf54240">PCILIB_ERROR_INVALID_STATE</a>;</div>
<div class="line"><span class="lineno">  187</span>            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (kh.flags&amp;KMEM_FLAG_REUSED_HW) err = <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caed0e669166d0329e7d2c2b5dedf54240">PCILIB_ERROR_INVALID_STATE</a>;</div>
<div class="line"><span class="lineno">  188</span>            <span class="keywordflow">if</span> (err) {</div>
<div class="line"><span class="lineno">  189</span>                kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#ae726d44c671b0f489c42b9e5835e97c5">n_blocks</a> = i + 1;</div>
<div class="line"><span class="lineno">  190</span>                sprintf(error,  <span class="stringliteral">&quot;Mistmatch in hardware modes of the re-used kmem blocks. Current buffer (use 0x%x, block: %zu) is %s, but prior ones %s&quot;</span>, </div>
<div class="line"><span class="lineno">  191</span>                    use, i, ((kh.flags&amp;KMEM_FLAG_REUSED_HW)?<span class="stringliteral">&quot;hardware-locked&quot;</span>:<span class="stringliteral">&quot;not hardware-locked&quot;</span>), (hardware?<span class="stringliteral">&quot;are&quot;</span>:<span class="stringliteral">&quot;are not&quot;</span>));</div>
<div class="line"><span class="lineno">  192</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  193</span>            }</div>
<div class="line"><span class="lineno">  194</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  195</span>            <span class="keywordflow">if</span> (!i) reused = <a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaf41596fde03fab631d50b01a97aa223d">PCILIB_TRISTATE_NO</a>;</div>
<div class="line"><span class="lineno">  196</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (reused) reused = <a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76eca70a51fcff782e3178d917f3aa502bb87">PCILIB_TRISTATE_PARTIAL</a>;</div>
<div class="line"><span class="lineno">  197</span> </div>
<div class="line"><span class="lineno">  198</span>            <span class="keywordflow">if</span> ((persistent &gt; 0)&amp;&amp;((flags&amp;<a class="code hl_enumvalue" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda7cd91729fe864a6ae9f0192909f8cde6">PCILIB_KMEM_FLAG_PERSISTENT</a>) == 0)) {</div>
<div class="line"><span class="lineno">  199</span>                err = <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caed0e669166d0329e7d2c2b5dedf54240">PCILIB_ERROR_INVALID_STATE</a>;</div>
<div class="line"><span class="lineno">  200</span>                sprintf(error, <span class="stringliteral">&quot;Expecting to re-use persistent blocks, but buffer (use 0x%x, block: %zu) is not&quot;</span>, use, i);</div>
<div class="line"><span class="lineno">  201</span>            }</div>
<div class="line"><span class="lineno">  202</span>            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((hardware &gt; 0)&amp;&amp;((flags&amp;<a class="code hl_enumvalue" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda6dbb3793cb0ed9350d9e9dde1131d7c1">PCILIB_KMEM_FLAG_HARDWARE</a>) == 0)) {</div>
<div class="line"><span class="lineno">  203</span>                err = <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caed0e669166d0329e7d2c2b5dedf54240">PCILIB_ERROR_INVALID_STATE</a>;</div>
<div class="line"><span class="lineno">  204</span>                sprintf(error, <span class="stringliteral">&quot;Expecting to re-use hardware-locked blocks, but buffer (use 0x%x, block: %zu) is not&quot;</span>, use, i);</div>
<div class="line"><span class="lineno">  205</span>            }</div>
<div class="line"><span class="lineno">  206</span>            <span class="keywordflow">if</span> (err) {</div>
<div class="line"><span class="lineno">  207</span>                kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#ae726d44c671b0f489c42b9e5835e97c5">n_blocks</a> = i + 1;</div>
<div class="line"><span class="lineno">  208</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  209</span>            }</div>
<div class="line"><span class="lineno">  210</span>        }</div>
<div class="line"><span class="lineno">  211</span>        </div>
<div class="line"><span class="lineno">  212</span> </div>
<div class="line"><span class="lineno">  213</span>        <span class="keywordflow">if</span> ((kh.align)&amp;&amp;((kh.type&amp;<a class="code hl_define" href="kmem_8h.html#afa29a33448c2617f0662db45afdbbd32">PCILIB_KMEM_TYPE_MASK</a>) != <a class="code hl_enumvalue" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a83c7f4b602188c78ddf226498890d331">PCILIB_KMEM_TYPE_PAGE</a>)) {</div>
<div class="line"><span class="lineno">  214</span>                <span class="comment">//  Physical or bus address here?</span></div>
<div class="line"><span class="lineno">  215</span>            <span class="keywordflow">if</span> (kh.ba) {</div>
<div class="line"><span class="lineno">  216</span>                <span class="keywordflow">if</span> (kh.ba % kh.align) kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[i].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">alignment_offset</a> = kh.align - kh.ba % kh.align;</div>
<div class="line"><span class="lineno">  217</span>            } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  218</span>                <span class="keywordflow">if</span> (kh.pa % kh.align) kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[i].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">alignment_offset</a> = kh.align - kh.pa % kh.align;</div>
<div class="line"><span class="lineno">  219</span>            }</div>
<div class="line"><span class="lineno">  220</span>            kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[i].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a9ec9640dd3bf2ffa15728ad7029919cf">size</a> -= kh.align;</div>
<div class="line"><span class="lineno">  221</span>        }</div>
<div class="line"><span class="lineno">  222</span> </div>
<div class="line"><span class="lineno">  223</span>        addr = mmap( 0, kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[i].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a9ec9640dd3bf2ffa15728ad7029919cf">size</a> + kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[i].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">alignment_offset</a>, PROT_WRITE | PROT_READ, MAP_SHARED, ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a97959ae9b1ab77309f0afec2b62d283c">handle</a>, 0 );</div>
<div class="line"><span class="lineno">  224</span>        <span class="keywordflow">if</span> ((!addr)||(addr == MAP_FAILED)) {</div>
<div class="line"><span class="lineno">  225</span>            kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#ae726d44c671b0f489c42b9e5835e97c5">n_blocks</a> = i + 1;</div>
<div class="line"><span class="lineno">  226</span>            err = <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca8a1b45502224b7b2659e0014d9acf50c">PCILIB_ERROR_FAILED</a>;</div>
<div class="line"><span class="lineno">  227</span>            sprintf(error, <span class="stringliteral">&quot;Driver prevents us from mmaping buffer (use 0x%x, block: %zu), mmap have failed with errno %i&quot;</span>, use, i, errno);</div>
<div class="line"><span class="lineno">  228</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  229</span>        }</div>
<div class="line"><span class="lineno">  230</span> </div>
<div class="line"><span class="lineno">  231</span>        kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[i].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#adf614dbac3f524456ea56dec3efad01a">ua</a> = addr;</div>
<div class="line"><span class="lineno">  232</span>        kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[i].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a292f3bd8fa805e91ab6704969c0be8d3">mmap_offset</a> = kh.pa &amp; ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a3b8d32830b2e29cb8dadcd73bb5fd063">page_mask</a>;</div>
<div class="line"><span class="lineno">  233</span>    }</div>
<div class="line"><span class="lineno">  234</span> </div>
<div class="line"><span class="lineno">  235</span>    <span class="keywordflow">if</span> (err) kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#ae726d44c671b0f489c42b9e5835e97c5">n_blocks</a> = i + 1;</div>
<div class="line"><span class="lineno">  236</span>    <span class="keywordflow">else</span> kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#ae726d44c671b0f489c42b9e5835e97c5">n_blocks</a> = i;</div>
<div class="line"><span class="lineno">  237</span> </div>
<div class="line"><span class="lineno">  238</span> </div>
<div class="line"><span class="lineno">  239</span>        <span class="comment">// Check if there are more unpicked buffers</span></div>
<div class="line"><span class="lineno">  240</span>    <span class="keywordflow">if</span> ((!err)&amp;&amp;((flags&amp;<a class="code hl_enumvalue" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdaa65929a5db6e7a0cf48e520d1ab56bfc">PCILIB_KMEM_FLAG_MASS</a>) == 0)&amp;&amp;(reused == <a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaed2f3179347058cf78c4337036b8e765">PCILIB_TRISTATE_YES</a>)&amp;&amp;((type&amp;<a class="code hl_define" href="kmem_8h.html#afa29a33448c2617f0662db45afdbbd32">PCILIB_KMEM_TYPE_MASK</a>) != <a class="code hl_enumvalue" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a5eae6683f379c25954fcdab27284d200">PCILIB_KMEM_TYPE_REGION</a>)) {</div>
<div class="line"><span class="lineno">  241</span>        kh.item = kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#ae726d44c671b0f489c42b9e5835e97c5">n_blocks</a>;</div>
<div class="line"><span class="lineno">  242</span>        kh.flags = KMEM_FLAG_REUSE|KMEM_FLAG_TRY;</div>
<div class="line"><span class="lineno">  243</span> </div>
<div class="line"><span class="lineno">  244</span>        ret = ioctl(ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a97959ae9b1ab77309f0afec2b62d283c">handle</a>, PCIDRIVER_IOC_KMEM_ALLOC, &amp;kh);</div>
<div class="line"><span class="lineno">  245</span>        <span class="keywordflow">if</span> (!ret) {</div>
<div class="line"><span class="lineno">  246</span>            kh.flags = KMEM_FLAG_REUSE;</div>
<div class="line"><span class="lineno">  247</span>            ioctl(ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a97959ae9b1ab77309f0afec2b62d283c">handle</a>, PCIDRIVER_IOC_KMEM_FREE, &amp;kh);</div>
<div class="line"><span class="lineno">  248</span>            reused = <a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76eca70a51fcff782e3178d917f3aa502bb87">PCILIB_TRISTATE_PARTIAL</a>;</div>
<div class="line"><span class="lineno">  249</span>        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (errno != ENOENT) {</div>
<div class="line"><span class="lineno">  250</span>            reused = <a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76eca70a51fcff782e3178d917f3aa502bb87">PCILIB_TRISTATE_PARTIAL</a>;</div>
<div class="line"><span class="lineno">  251</span>        }</div>
<div class="line"><span class="lineno">  252</span>    }</div>
<div class="line"><span class="lineno">  253</span> </div>
<div class="line"><span class="lineno">  254</span>    <a class="code hl_function" href="locking_8c.html#aee7b665a4a015a315d06c5314dc6e1eb">pcilib_unlock_global</a>(ctx);</div>
<div class="line"><span class="lineno">  255</span> </div>
<div class="line"><span class="lineno">  256</span> </div>
<div class="line"><span class="lineno">  257</span>        <span class="comment">//This is possible in the case of error (nothing is allocated yet) or if buffers are not reused</span></div>
<div class="line"><span class="lineno">  258</span>    <span class="keywordflow">if</span> (persistent &lt; 0) persistent = 0;</div>
<div class="line"><span class="lineno">  259</span>    <span class="keywordflow">if</span> (hardware &lt; 0) hardware = 0;</div>
<div class="line"><span class="lineno">  260</span> </div>
<div class="line"><span class="lineno">  261</span>    <span class="keywordflow">if</span> (err) {</div>
<div class="line"><span class="lineno">  262</span>            <span class="comment">// do not clean if we have reused (even partially) persistent/hardware-locked buffers</span></div>
<div class="line"><span class="lineno">  263</span>        <span class="keywordflow">if</span> (((persistent)||(hardware))&amp;&amp;(reused != <a class="code hl_enumvalue" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaf41596fde03fab631d50b01a97aa223d">PCILIB_TRISTATE_NO</a>)) {</div>
<div class="line"><span class="lineno">  264</span>            pcilib_cancel_kernel_memory(ctx, kbuf, KMEM_FLAG_REUSE, 0);</div>
<div class="line"><span class="lineno">  265</span>        } <span class="keywordflow">else</span> {</div>
<div class="line"><span class="lineno">  266</span>            <a class="code hl_enumeration" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcd">pcilib_kmem_flags_t</a> free_flags = 0;</div>
<div class="line"><span class="lineno">  267</span>            <span class="keywordflow">if</span> (flags&amp;<a class="code hl_enumvalue" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda7cd91729fe864a6ae9f0192909f8cde6">PCILIB_KMEM_FLAG_PERSISTENT</a>) {</div>
<div class="line"><span class="lineno">  268</span>                free_flags |= <a class="code hl_enumvalue" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda7cd91729fe864a6ae9f0192909f8cde6">PCILIB_KMEM_FLAG_PERSISTENT</a>;</div>
<div class="line"><span class="lineno">  269</span>            }</div>
<div class="line"><span class="lineno">  270</span>            <span class="keywordflow">if</span> (flags&amp;<a class="code hl_enumvalue" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda6dbb3793cb0ed9350d9e9dde1131d7c1">PCILIB_KMEM_FLAG_HARDWARE</a>) {</div>
<div class="line"><span class="lineno">  271</span>                free_flags |= <a class="code hl_enumvalue" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda6dbb3793cb0ed9350d9e9dde1131d7c1">PCILIB_KMEM_FLAG_HARDWARE</a>;</div>
<div class="line"><span class="lineno">  272</span>            }</div>
<div class="line"><span class="lineno">  273</span>                <span class="comment">// err indicates consistensy error. The last ioctl have succeeded and we need to clean it in a special way</span></div>
<div class="line"><span class="lineno">  274</span>            pcilib_cancel_kernel_memory(ctx, kbuf, free_flags, (err == <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caed0e669166d0329e7d2c2b5dedf54240">PCILIB_ERROR_INVALID_STATE</a>)?kh.flags:0);</div>
<div class="line"><span class="lineno">  275</span>        }</div>
<div class="line"><span class="lineno">  276</span> </div>
<div class="line"><span class="lineno">  277</span>        <a class="code hl_define" href="error_8h.html#a62fff84bc7941d1a39700b931716bbe9">pcilib_warning</a>(<span class="stringliteral">&quot;Error %i: %s&quot;</span>, err, error);</div>
<div class="line"><span class="lineno">  278</span>        <span class="keywordflow">return</span> NULL;</div>
<div class="line"><span class="lineno">  279</span>    }</div>
<div class="line"><span class="lineno">  280</span>    </div>
<div class="line"><span class="lineno">  281</span>    <span class="keywordflow">if</span> (nmemb == 1) {</div>
<div class="line"><span class="lineno">  282</span>        memcpy(&amp;kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a435cd00162dc3faa5ab5ee6a32defda4">addr</a>, &amp;kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[0], <span class="keyword">sizeof</span>(<a class="code hl_struct" href="structpcilib__kmem__addr__t.html">pcilib_kmem_addr_t</a>));</div>
<div class="line"><span class="lineno">  283</span>    }</div>
<div class="line"><span class="lineno">  284</span> </div>
<div class="line"><span class="lineno">  285</span>    kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a4b933f74483b36e93a602fb37f99b62a">type</a> = type;</div>
<div class="line"><span class="lineno">  286</span>    kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a8cea631b3d3696d1b3ccdb7d9fb96785">use</a> = use;</div>
<div class="line"><span class="lineno">  287</span>    kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a98b6173c71e7dbaf3dfdbd2504941251">reused</a> = reused|(persistent?<a class="code hl_enumvalue" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48a3554ace3999de348dfa20720cf3a2a76">PCILIB_KMEM_REUSE_PERSISTENT</a>:0)|(hardware?<a class="code hl_enumvalue" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48ac2f1419981871c6e37c31a875adf7610">PCILIB_KMEM_REUSE_HARDWARE</a>:0);</div>
<div class="line"><span class="lineno">  288</span> </div>
<div class="line"><span class="lineno">  289</span>    kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#a0a9a2bc5652cb8b77e772bdf7cbb9157">prev</a> = NULL;</div>
<div class="line"><span class="lineno">  290</span>    kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#af093fdf8a083ba2a9dd76b23cc509995">next</a> = ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a90b4d45dc1e79a725ca1478bbe753b17">kmem_list</a>;</div>
<div class="line"><span class="lineno">  291</span>    <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a90b4d45dc1e79a725ca1478bbe753b17">kmem_list</a>) ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a90b4d45dc1e79a725ca1478bbe753b17">kmem_list</a>-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#a0a9a2bc5652cb8b77e772bdf7cbb9157">prev</a> = kbuf;</div>
<div class="line"><span class="lineno">  292</span>    ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a90b4d45dc1e79a725ca1478bbe753b17">kmem_list</a> = kbuf;</div>
<div class="line"><span class="lineno">  293</span> </div>
<div class="line"><span class="lineno">  294</span>    <span class="keywordflow">return</span> (<a class="code hl_typedef" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a>*)kbuf;</div>
<div class="line"><span class="lineno">  295</span>}</div>
<div class="ttc" id="aerror_8h_html_a0c59f7091fd2446121868635aca9e60ca8a1b45502224b7b2659e0014d9acf50c"><div class="ttname"><a href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca8a1b45502224b7b2659e0014d9acf50c">PCILIB_ERROR_FAILED</a></div><div class="ttdeci">@ PCILIB_ERROR_FAILED</div><div class="ttdef"><b>Definition:</b> error.h:22</div></div>
<div class="ttc" id="aerror_8h_html_a0c59f7091fd2446121868635aca9e60caa30630d7c09a1fe97acd43439032eb00"><div class="ttname"><a href="error_8h.html#a0c59f7091fd2446121868635aca9e60caa30630d7c09a1fe97acd43439032eb00">PCILIB_ERROR_MEMORY</a></div><div class="ttdeci">@ PCILIB_ERROR_MEMORY</div><div class="ttdef"><b>Definition:</b> error.h:14</div></div>
<div class="ttc" id="aerror_8h_html_a0c59f7091fd2446121868635aca9e60caed0e669166d0329e7d2c2b5dedf54240"><div class="ttname"><a href="error_8h.html#a0c59f7091fd2446121868635aca9e60caed0e669166d0329e7d2c2b5dedf54240">PCILIB_ERROR_INVALID_STATE</a></div><div class="ttdeci">@ PCILIB_ERROR_INVALID_STATE</div><div class="ttdef"><b>Definition:</b> error.h:19</div></div>
<div class="ttc" id="aerror_8h_html_a2b06064fecffd095efabb752f7b50021"><div class="ttname"><a href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a></div><div class="ttdeci">#define pcilib_error(...)</div><div class="ttdef"><b>Definition:</b> error.h:68</div></div>
<div class="ttc" id="aerror_8h_html_a62fff84bc7941d1a39700b931716bbe9"><div class="ttname"><a href="error_8h.html#a62fff84bc7941d1a39700b931716bbe9">pcilib_warning</a></div><div class="ttdeci">#define pcilib_warning(...)</div><div class="ttdef"><b>Definition:</b> error.h:69</div></div>
<div class="ttc" id="akmem_8h_html_a45758f64a23ffbaa50a83e41b3342780"><div class="ttname"><a href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a></div><div class="ttdeci">void pcilib_kmem_handle_t</div><div class="ttdef"><b>Definition:</b> kmem.h:93</div></div>
<div class="ttc" id="akmem_8h_html_afa29a33448c2617f0662db45afdbbd32"><div class="ttname"><a href="kmem_8h.html#afa29a33448c2617f0662db45afdbbd32">PCILIB_KMEM_TYPE_MASK</a></div><div class="ttdeci">#define PCILIB_KMEM_TYPE_MASK</div><div class="ttdoc">Mask selecting the general type in pcilib_kmem_type_t.</div><div class="ttdef"><b>Definition:</b> kmem.h:15</div></div>
<div class="ttc" id="alocking_8c_html_adbf250829f88c240473e38fc0224ed5f"><div class="ttname"><a href="locking_8c.html#adbf250829f88c240473e38fc0224ed5f">pcilib_lock_global</a></div><div class="ttdeci">int pcilib_lock_global(pcilib_t *ctx)</div><div class="ttdoc">this function use flock locking mechanism on the ALPS platform device file, to make sure to not creat...</div><div class="ttdef"><b>Definition:</b> locking.c:78</div></div>
<div class="ttc" id="alocking_8c_html_aee7b665a4a015a315d06c5314dc6e1eb"><div class="ttname"><a href="locking_8c.html#aee7b665a4a015a315d06c5314dc6e1eb">pcilib_unlock_global</a></div><div class="ttdeci">void pcilib_unlock_global(pcilib_t *ctx)</div><div class="ttdoc">function to remove the lock created by flock on the ALPS platform device file</div><div class="ttdef"><b>Definition:</b> locking.c:90</div></div>
<div class="ttc" id="astructpcilib__kmem__addr__t_html"><div class="ttname"><a href="structpcilib__kmem__addr__t.html">pcilib_kmem_addr_t</a></div><div class="ttdef"><b>Definition:</b> kmem.h:65</div></div>
<div class="ttc" id="astructpcilib__kmem__addr__t_html_a0b65654ea7f40cc8f77ada141e9b80c3"><div class="ttname"><a href="structpcilib__kmem__addr__t.html#a0b65654ea7f40cc8f77ada141e9b80c3">pcilib_kmem_addr_t::pa</a></div><div class="ttdeci">uintptr_t pa</div><div class="ttdoc">physical address of buffer</div><div class="ttdef"><b>Definition:</b> kmem.h:69</div></div>
<div class="ttc" id="astructpcilib__kmem__addr__t_html_a292f3bd8fa805e91ab6704969c0be8d3"><div class="ttname"><a href="structpcilib__kmem__addr__t.html#a292f3bd8fa805e91ab6704969c0be8d3">pcilib_kmem_addr_t::mmap_offset</a></div><div class="ttdeci">size_t mmap_offset</div><div class="ttdoc">mmap always maps pages, if physical address is not aligned to page boundary, this is the offset of th...</div><div class="ttdef"><b>Definition:</b> kmem.h:75</div></div>
<div class="ttc" id="astructpcilib__kmem__addr__t_html_a6a326278778d23dd307ddf18f5923c2d"><div class="ttname"><a href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">pcilib_kmem_addr_t::alignment_offset</a></div><div class="ttdeci">size_t alignment_offset</div><div class="ttdoc">we may request alignment of allocated buffers.</div><div class="ttdef"><b>Definition:</b> kmem.h:74</div></div>
<div class="ttc" id="astructpcilib__kmem__addr__t_html_a6ef22d1817504c413bb39379eb0ad972"><div class="ttname"><a href="structpcilib__kmem__addr__t.html#a6ef22d1817504c413bb39379eb0ad972">pcilib_kmem_addr_t::ba</a></div><div class="ttdeci">uintptr_t ba</div><div class="ttdoc">bus address of buffer (if it is mapped for DMA operations)</div><div class="ttdef"><b>Definition:</b> kmem.h:70</div></div>
<div class="ttc" id="astructpcilib__kmem__addr__t_html_a9ec9640dd3bf2ffa15728ad7029919cf"><div class="ttname"><a href="structpcilib__kmem__addr__t.html#a9ec9640dd3bf2ffa15728ad7029919cf">pcilib_kmem_addr_t::size</a></div><div class="ttdeci">size_t size</div><div class="ttdoc">size of the buffer in bytes</div><div class="ttdef"><b>Definition:</b> kmem.h:72</div></div>
<div class="ttc" id="astructpcilib__kmem__addr__t_html_adf614dbac3f524456ea56dec3efad01a"><div class="ttname"><a href="structpcilib__kmem__addr__t.html#adf614dbac3f524456ea56dec3efad01a">pcilib_kmem_addr_t::ua</a></div><div class="ttdeci">volatile void * ua</div><div class="ttdoc">pointer to buffer in the process address space</div><div class="ttdef"><b>Definition:</b> kmem.h:71</div></div>
<div class="ttc" id="astructpcilib__kmem__addr__t_html_af01a6dc26454d7600edd4b330ef59544"><div class="ttname"><a href="structpcilib__kmem__addr__t.html#af01a6dc26454d7600edd4b330ef59544">pcilib_kmem_addr_t::handle_id</a></div><div class="ttdeci">int handle_id</div><div class="ttdoc">handled id is used to indentify buffer to kernel module</div><div class="ttdef"><b>Definition:</b> kmem.h:66</div></div>
<div class="ttc" id="astructpcilib__kmem__buffer__t_html_a435cd00162dc3faa5ab5ee6a32defda4"><div class="ttname"><a href="structpcilib__kmem__buffer__t.html#a435cd00162dc3faa5ab5ee6a32defda4">pcilib_kmem_buffer_t::addr</a></div><div class="ttdeci">pcilib_kmem_addr_t addr</div><div class="ttdoc">Information about the buffer of single-buffer kmem.</div><div class="ttdef"><b>Definition:</b> kmem.h:89</div></div>
<div class="ttc" id="astructpcilib__kmem__buffer__t_html_a4b933f74483b36e93a602fb37f99b62a"><div class="ttname"><a href="structpcilib__kmem__buffer__t.html#a4b933f74483b36e93a602fb37f99b62a">pcilib_kmem_buffer_t::type</a></div><div class="ttdeci">pcilib_kmem_type_t type</div><div class="ttdoc">The type of kernel memory (how it is allocated)</div><div class="ttdef"><b>Definition:</b> kmem.h:84</div></div>
<div class="ttc" id="astructpcilib__kmem__buffer__t_html_a8cea631b3d3696d1b3ccdb7d9fb96785"><div class="ttname"><a href="structpcilib__kmem__buffer__t.html#a8cea631b3d3696d1b3ccdb7d9fb96785">pcilib_kmem_buffer_t::use</a></div><div class="ttdeci">pcilib_kmem_use_t use</div><div class="ttdoc">The purpose of kernel memory (how it will be used)</div><div class="ttdef"><b>Definition:</b> kmem.h:85</div></div>
<div class="ttc" id="astructpcilib__kmem__buffer__t_html_a91866edde1d045905724f0e28259bc86"><div class="ttname"><a href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">pcilib_kmem_buffer_t::blocks</a></div><div class="ttdeci">pcilib_kmem_addr_t blocks[]</div><div class="ttdoc">Information about all the buffers in kmem (variable size)</div><div class="ttdef"><b>Definition:</b> kmem.h:90</div></div>
<div class="ttc" id="astructpcilib__kmem__buffer__t_html_a98b6173c71e7dbaf3dfdbd2504941251"><div class="ttname"><a href="structpcilib__kmem__buffer__t.html#a98b6173c71e7dbaf3dfdbd2504941251">pcilib_kmem_buffer_t::reused</a></div><div class="ttdeci">pcilib_kmem_reuse_state_t reused</div><div class="ttdoc">Indicates if kernel memory was allocated anew, reused, or partially re-used.</div><div class="ttdef"><b>Definition:</b> kmem.h:86</div></div>
<div class="ttc" id="astructpcilib__kmem__buffer__t_html_ae726d44c671b0f489c42b9e5835e97c5"><div class="ttname"><a href="structpcilib__kmem__buffer__t.html#ae726d44c671b0f489c42b9e5835e97c5">pcilib_kmem_buffer_t::n_blocks</a></div><div class="ttdeci">size_t n_blocks</div><div class="ttdoc">Number of allocated/re-used buffers in kmem.</div><div class="ttdef"><b>Definition:</b> kmem.h:88</div></div>
<div class="ttc" id="astructpcilib__kmem__list__s_html"><div class="ttname"><a href="structpcilib__kmem__list__s.html">pcilib_kmem_list_s</a></div><div class="ttdef"><b>Definition:</b> kmem.h:96</div></div>
<div class="ttc" id="astructpcilib__kmem__list__s_html_a0a9a2bc5652cb8b77e772bdf7cbb9157"><div class="ttname"><a href="structpcilib__kmem__list__s.html#a0a9a2bc5652cb8b77e772bdf7cbb9157">pcilib_kmem_list_s::prev</a></div><div class="ttdeci">pcilib_kmem_list_t * prev</div><div class="ttdoc">List storring all allocated/re-used kmem's in application.</div><div class="ttdef"><b>Definition:</b> kmem.h:97</div></div>
<div class="ttc" id="astructpcilib__kmem__list__s_html_adc2db171070bd735819d9e6027a1d19d"><div class="ttname"><a href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">pcilib_kmem_list_s::buf</a></div><div class="ttdeci">pcilib_kmem_buffer_t buf</div><div class="ttdoc">The actual kmem context (it is of variable size due to blocks and, hence, should be last item in this...</div><div class="ttdef"><b>Definition:</b> kmem.h:98</div></div>
<div class="ttc" id="astructpcilib__kmem__list__s_html_af093fdf8a083ba2a9dd76b23cc509995"><div class="ttname"><a href="structpcilib__kmem__list__s.html#af093fdf8a083ba2a9dd76b23cc509995">pcilib_kmem_list_s::next</a></div><div class="ttdeci">pcilib_kmem_list_t * next</div><div class="ttdef"><b>Definition:</b> kmem.h:97</div></div>
<div class="ttc" id="astructpcilib__s_html_a3b8d32830b2e29cb8dadcd73bb5fd063"><div class="ttname"><a href="structpcilib__s.html#a3b8d32830b2e29cb8dadcd73bb5fd063">pcilib_s::page_mask</a></div><div class="ttdeci">uintptr_t page_mask</div><div class="ttdoc">Selects bits which define offset within the page.</div><div class="ttdef"><b>Definition:</b> pci.h:52</div></div>
<div class="ttc" id="astructpcilib__s_html_a90b4d45dc1e79a725ca1478bbe753b17"><div class="ttname"><a href="structpcilib__s.html#a90b4d45dc1e79a725ca1478bbe753b17">pcilib_s::kmem_list</a></div><div class="ttdeci">pcilib_kmem_list_t * kmem_list</div><div class="ttdoc">List of currently allocated kernel memory.</div><div class="ttdef"><b>Definition:</b> pci.h:69</div></div>
<div class="ttc" id="astructpcilib__s_html_a97959ae9b1ab77309f0afec2b62d283c"><div class="ttname"><a href="structpcilib__s.html#a97959ae9b1ab77309f0afec2b62d283c">pcilib_s::handle</a></div><div class="ttdeci">int handle</div><div class="ttdoc">file handle of device</div><div class="ttdef"><b>Definition:</b> pci.h:48</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__kmem__buffer__t.html#a435cd00162dc3faa5ab5ee6a32defda4">pcilib_kmem_buffer_t::addr</a>, <a class="el" href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">pcilib_kmem_addr_t::alignment_offset</a>, <a class="el" href="structpcilib__kmem__addr__t.html#a6ef22d1817504c413bb39379eb0ad972">pcilib_kmem_addr_t::ba</a>, <a class="el" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">pcilib_kmem_buffer_t::blocks</a>, <a class="el" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">pcilib_kmem_list_s::buf</a>, <a class="el" href="structpcilib__s.html#a97959ae9b1ab77309f0afec2b62d283c">pcilib_s::handle</a>, <a class="el" href="structpcilib__kmem__addr__t.html#af01a6dc26454d7600edd4b330ef59544">pcilib_kmem_addr_t::handle_id</a>, <a class="el" href="structpcilib__s.html#a90b4d45dc1e79a725ca1478bbe753b17">pcilib_s::kmem_list</a>, <a class="el" href="structpcilib__kmem__addr__t.html#a292f3bd8fa805e91ab6704969c0be8d3">pcilib_kmem_addr_t::mmap_offset</a>, <a class="el" href="structpcilib__kmem__buffer__t.html#ae726d44c671b0f489c42b9e5835e97c5">pcilib_kmem_buffer_t::n_blocks</a>, <a class="el" href="structpcilib__kmem__list__s.html#af093fdf8a083ba2a9dd76b23cc509995">pcilib_kmem_list_s::next</a>, <a class="el" href="structpcilib__kmem__addr__t.html#a0b65654ea7f40cc8f77ada141e9b80c3">pcilib_kmem_addr_t::pa</a>, <a class="el" href="structpcilib__s.html#a3b8d32830b2e29cb8dadcd73bb5fd063">pcilib_s::page_mask</a>, <a class="el" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca8a1b45502224b7b2659e0014d9acf50c">PCILIB_ERROR_FAILED</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caed0e669166d0329e7d2c2b5dedf54240">PCILIB_ERROR_INVALID_STATE</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60caa30630d7c09a1fe97acd43439032eb00">PCILIB_ERROR_MEMORY</a>, <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda6dbb3793cb0ed9350d9e9dde1131d7c1">PCILIB_KMEM_FLAG_HARDWARE</a>, <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdaa65929a5db6e7a0cf48e520d1ab56bfc">PCILIB_KMEM_FLAG_MASS</a>, <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda7cd91729fe864a6ae9f0192909f8cde6">PCILIB_KMEM_FLAG_PERSISTENT</a>, <a class="el" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48ac2f1419981871c6e37c31a875adf7610">PCILIB_KMEM_REUSE_HARDWARE</a>, <a class="el" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48a3554ace3999de348dfa20720cf3a2a76">PCILIB_KMEM_REUSE_PERSISTENT</a>, <a class="el" href="kmem_8h.html#afa29a33448c2617f0662db45afdbbd32">PCILIB_KMEM_TYPE_MASK</a>, <a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a83c7f4b602188c78ddf226498890d331">PCILIB_KMEM_TYPE_PAGE</a>, <a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a5eae6683f379c25954fcdab27284d200">PCILIB_KMEM_TYPE_REGION</a>, <a class="el" href="locking_8c.html#adbf250829f88c240473e38fc0224ed5f">pcilib_lock_global()</a>, <a class="el" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaf41596fde03fab631d50b01a97aa223d">PCILIB_TRISTATE_NO</a>, <a class="el" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76eca70a51fcff782e3178d917f3aa502bb87">PCILIB_TRISTATE_PARTIAL</a>, <a class="el" href="kmem_8h.html#a1dd3f4385e8051d028281c93490b76ecaed2f3179347058cf78c4337036b8e765">PCILIB_TRISTATE_YES</a>, <a class="el" href="locking_8c.html#aee7b665a4a015a315d06c5314dc6e1eb">pcilib_unlock_global()</a>, <a class="el" href="error_8h.html#a62fff84bc7941d1a39700b931716bbe9">pcilib_warning</a>, <a class="el" href="structpcilib__kmem__list__s.html#a0a9a2bc5652cb8b77e772bdf7cbb9157">pcilib_kmem_list_s::prev</a>, <a class="el" href="structpcilib__kmem__buffer__t.html#a98b6173c71e7dbaf3dfdbd2504941251">pcilib_kmem_buffer_t::reused</a>, <a class="el" href="structpcilib__kmem__addr__t.html#a9ec9640dd3bf2ffa15728ad7029919cf">pcilib_kmem_addr_t::size</a>, <a class="el" href="structpcilib__kmem__buffer__t.html#a4b933f74483b36e93a602fb37f99b62a">pcilib_kmem_buffer_t::type</a>, <a class="el" href="structpcilib__kmem__addr__t.html#adf614dbac3f524456ea56dec3efad01a">pcilib_kmem_addr_t::ua</a>, and <a class="el" href="structpcilib__kmem__buffer__t.html#a8cea631b3d3696d1b3ccdb7d9fb96785">pcilib_kmem_buffer_t::use</a>.</p>

<p class="reference">Referenced by <a class="el" href="locking_8c.html#ac379ebe1382f4517496a6da8ca2b0839">pcilib_destroy_all_locks()</a>, and <a class="el" href="locking_8c.html#af688eeaa5170de223b3af7e4e7c211e0">pcilib_init_locking()</a>.</p>

</div>
</div>
<a id="a033d40db26413a78644674d17ad2c506" name="a033d40db26413a78644674d17ad2c506"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a033d40db26413a78644674d17ad2c506">&#9670;&#160;</a></span>pcilib_clean_kernel_memory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pcilib_clean_kernel_memory </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a30160d6ee0113e9eb63b28f62f8bc485">pcilib_kmem_use_t</a>&#160;</td>
          <td class="paramname"><em>use</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcd">pcilib_kmem_flags_t</a>&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free / dereference all kernel memory buffers associated with the specified <code>use</code>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">use</td><td>- use-number to clean </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>- various flags defining which referenes to hold and return and if the memory should be dereferenced or freed </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- error or 0 on success </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">   20</span>                                                                                                {</div>
<div class="line"><span class="lineno">   21</span>    kmem_handle_t kh = {0};</div>
<div class="line"><span class="lineno">   22</span>    kh.use = use;</div>
<div class="line"><span class="lineno">   23</span>    kh.flags = flags|<a class="code hl_enumvalue" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdaa65929a5db6e7a0cf48e520d1ab56bfc">PCILIB_KMEM_FLAG_MASS</a>;</div>
<div class="line"><span class="lineno">   24</span> </div>
<div class="line"><span class="lineno">   25</span>    <span class="keywordflow">return</span> ioctl(ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a97959ae9b1ab77309f0afec2b62d283c">handle</a>, PCIDRIVER_IOC_KMEM_FREE, &amp;kh);</div>
<div class="line"><span class="lineno">   26</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__s.html#a97959ae9b1ab77309f0afec2b62d283c">pcilib_s::handle</a>, and <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdaa65929a5db6e7a0cf48e520d1ab56bfc">PCILIB_KMEM_FLAG_MASS</a>.</p>

</div>
</div>
<a id="a77eed4dcaa5a719b767ed275c332148e" name="a77eed4dcaa5a719b767ed275c332148e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77eed4dcaa5a719b767ed275c332148e">&#9670;&#160;</a></span>pcilib_free_kernel_memory()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pcilib_free_kernel_memory </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcd">pcilib_kmem_flags_t</a>&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function either frees the allocated kernel memory or just releases some of the references. </p>
<p >Only reference tracking is performed If the <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda074f7eaee0589d2d0eb90b9807f755cf" title="Try to reuse existing buffer with the same use &amp; item.">PCILIB_KMEM_FLAG_REUSE</a> flag is passed to the function. Otherwise, non-persistent memory is released when <a class="el" href="kmem_8h.html#a77eed4dcaa5a719b767ed275c332148e" title="This function either frees the allocated kernel memory or just releases some of the references.">pcilib_free_kernel_memory()</a> called. The persistent memory is released if <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda7cd91729fe864a6ae9f0192909f8cde6" title="Sets persistent mode.">PCILIB_KMEM_FLAG_PERSISTENT</a> is passed in <code>flags</code> parameter unless the hold references are preventing us from releasing this memory. The error is reported in this case. The kernel memory can be freed irrespective of hold references if <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdaea45d32d74a90a73de7ce8726d261104" title="Force memory cleanup even if references are present.">PCILIB_KMEM_FLAG_FORCE</a> flag is specified.</p>
<p >There are several types of references:</p><ul>
<li>The hardware reference - indicates that the memory may be used by DMA engine of the device. It is set if <a class="el" href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e" title="This function either allocates new buffers in the kernel space or just re-uses existing buffers.">pcilib_alloc_kernel_memory()</a> is executed with <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda6dbb3793cb0ed9350d9e9dde1131d7c1" title="The buffer may be accessed by hardware, the hardware access will not occur any more if passed to _fre...">PCILIB_KMEM_FLAG_HARDWARE</a> flag. The reference can be released if the same flag is passed to <a class="el" href="kmem_8h.html#a77eed4dcaa5a719b767ed275c332148e" title="This function either frees the allocated kernel memory or just releases some of the references.">pcilib_free_kernel_memory()</a></li>
<li>The software references - are obtained when the memory is reused with <a class="el" href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e" title="This function either allocates new buffers in the kernel space or just re-uses existing buffers.">pcilib_alloc_kernel_memory()</a>. They are released when corresponding <a class="el" href="kmem_8h.html#a77eed4dcaa5a719b767ed275c332148e" title="This function either frees the allocated kernel memory or just releases some of the references.">pcilib_free_kernel_memory()</a> is called.</li>
<li>The mmap references - are obtained when the kernel memory is mapped to the virtual memory of application which is normally happen on <a class="el" href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e" title="This function either allocates new buffers in the kernel space or just re-uses existing buffers.">pcilib_alloc_kernel_memory()</a> and fork of the process. The references are returned when memory is unmapped. This happens on <a class="el" href="kmem_8h.html#a77eed4dcaa5a719b767ed275c332148e" title="This function either frees the allocated kernel memory or just releases some of the references.">pcilib_free_kernel_memory()</a> and termination of the process with still mmaped regions.</li>
</ul>
<p >The software references are in a way replicate functionality of the mmap references. Currently, they are used to keep track of non-persistent memory allocated and re-used within the same application (which is actually discouraged). In this case the number of <a class="el" href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e" title="This function either allocates new buffers in the kernel space or just re-uses existing buffers.">pcilib_alloc_kernel_memory()</a> should be matched by number of <a class="el" href="kmem_8h.html#a77eed4dcaa5a719b767ed275c332148e" title="This function either frees the allocated kernel memory or just releases some of the references.">pcilib_free_kernel_memory()</a> calls and only on a last call the memory will be really released. Normally, all but last calls have to be accompanied by <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcda074f7eaee0589d2d0eb90b9807f755cf" title="Try to reuse existing buffer with the same use &amp; item.">PCILIB_KMEM_FLAG_REUSE</a> flag or the error is reported. But to keep code simpler, the pcilib will not complain until there are software references on hold. When the last software reference is released, we try actually clean up the memory and the error is reported if other types of references are still present. The software references may stuck if application crashes before calling <a class="el" href="kmem_8h.html#a77eed4dcaa5a719b767ed275c332148e" title="This function either frees the allocated kernel memory or just releases some of the references.">pcilib_free_kernel_memory()</a>. pcilib will prevent us from releasing the kernel memory with stuck references. Such memory can be cleaned only with <a class="el" href="kmem_8h.html#ae91539a22992b31d5ecbe338ed230bcdaea45d32d74a90a73de7ce8726d261104" title="Force memory cleanup even if references are present.">PCILIB_KMEM_FLAG_FORCE</a> flag or using <a class="el" href="kmem_8h.html#a033d40db26413a78644674d17ad2c506" title="Free / dereference all kernel memory buffers associated with the specified use.">pcilib_clean_kernel_memory()</a> call.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">k</td><td>- kernel memory handle returned from <a class="el" href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e" title="This function either allocates new buffers in the kernel space or just re-uses existing buffers.">pcilib_alloc_kernel_memory()</a> call </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">flags</td><td>- various flags defining which referenes to hold and return and if the memory should be preserved or freed </td></tr>
  </table>
  </dd>
</dl>
<div class="fragment"><div class="line"><span class="lineno">  297</span>                                                                                                  {</div>
<div class="line"><span class="lineno">  298</span>    <span class="keywordtype">int</span> ret, err = 0; </div>
<div class="line"><span class="lineno">  299</span>    <span class="keywordtype">int</span> i;</div>
<div class="line"><span class="lineno">  300</span>    <a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a> *kbuf = (<a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a>*)k;</div>
<div class="line"><span class="lineno">  301</span> </div>
<div class="line"><span class="lineno">  302</span>        <span class="comment">// if linked in to the list</span></div>
<div class="line"><span class="lineno">  303</span>    <span class="keywordflow">if</span> (kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#af093fdf8a083ba2a9dd76b23cc509995">next</a>) kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#af093fdf8a083ba2a9dd76b23cc509995">next</a>-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#a0a9a2bc5652cb8b77e772bdf7cbb9157">prev</a> = kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#a0a9a2bc5652cb8b77e772bdf7cbb9157">prev</a>;</div>
<div class="line"><span class="lineno">  304</span>    <span class="keywordflow">if</span> (kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#a0a9a2bc5652cb8b77e772bdf7cbb9157">prev</a>) kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#a0a9a2bc5652cb8b77e772bdf7cbb9157">prev</a>-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#af093fdf8a083ba2a9dd76b23cc509995">next</a> = kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#af093fdf8a083ba2a9dd76b23cc509995">next</a>;</div>
<div class="line"><span class="lineno">  305</span>    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a90b4d45dc1e79a725ca1478bbe753b17">kmem_list</a> == kbuf) ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a90b4d45dc1e79a725ca1478bbe753b17">kmem_list</a> = kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#af093fdf8a083ba2a9dd76b23cc509995">next</a>;</div>
<div class="line"><span class="lineno">  306</span> </div>
<div class="line"><span class="lineno">  307</span>    <span class="keywordflow">for</span> (i = 0; i &lt; kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#ae726d44c671b0f489c42b9e5835e97c5">n_blocks</a>; i++) {</div>
<div class="line"><span class="lineno">  308</span>        ret = pcilib_free_kernel_buffer(ctx, kbuf, i, flags);</div>
<div class="line"><span class="lineno">  309</span>        <span class="keywordflow">if</span> ((ret)&amp;&amp;(!err)) err = ret;</div>
<div class="line"><span class="lineno">  310</span>    }</div>
<div class="line"><span class="lineno">  311</span>    </div>
<div class="line"><span class="lineno">  312</span>    free(kbuf);</div>
<div class="line"><span class="lineno">  313</span>    </div>
<div class="line"><span class="lineno">  314</span>    <span class="keywordflow">if</span> (err) {</div>
<div class="line"><span class="lineno">  315</span>        <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;PCIDRIVER_IOC_KMEM_FREE ioctl have failed&quot;</span>);</div>
<div class="line"><span class="lineno">  316</span>    }</div>
<div class="line"><span class="lineno">  317</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">pcilib_kmem_list_s::buf</a>, <a class="el" href="structpcilib__s.html#a90b4d45dc1e79a725ca1478bbe753b17">pcilib_s::kmem_list</a>, <a class="el" href="structpcilib__kmem__buffer__t.html#ae726d44c671b0f489c42b9e5835e97c5">pcilib_kmem_buffer_t::n_blocks</a>, <a class="el" href="structpcilib__kmem__list__s.html#af093fdf8a083ba2a9dd76b23cc509995">pcilib_kmem_list_s::next</a>, <a class="el" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>, and <a class="el" href="structpcilib__kmem__list__s.html#a0a9a2bc5652cb8b77e772bdf7cbb9157">pcilib_kmem_list_s::prev</a>.</p>

<p class="reference">Referenced by <a class="el" href="group__public__api.html#ga809b61586ed9c56a7510c607859e75e3">pcilib_close()</a>, <a class="el" href="locking_8c.html#ac379ebe1382f4517496a6da8ca2b0839">pcilib_destroy_all_locks()</a>, and <a class="el" href="locking_8c.html#a0cc8f6c273bcc2fffce974f686dffee0">pcilib_free_locking()</a>.</p>

</div>
</div>
<a id="a8e98bad106c18f186105d841d2cabf27" name="a8e98bad106c18f186105d841d2cabf27"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e98bad106c18f186105d841d2cabf27">&#9670;&#160;</a></span>pcilib_kmem_get_ba()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uintptr_t pcilib_kmem_get_ba </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *&#160;</td>
          <td class="paramname"><em>k</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a bus address of a single-buffer kernel memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">k</td><td>- kernel memory handle returned from <a class="el" href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e" title="This function either allocates new buffers in the kernel space or just re-uses existing buffers.">pcilib_alloc_kernel_memory()</a> call </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- bus address or 0 if no bus mapping </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  374</span>                                                                     {</div>
<div class="line"><span class="lineno">  375</span>    <a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a> *kbuf = (<a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a>*)k;</div>
<div class="line"><span class="lineno">  376</span> </div>
<div class="line"><span class="lineno">  377</span>    <span class="keywordflow">if</span> (kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a435cd00162dc3faa5ab5ee6a32defda4">addr</a>.<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a6ef22d1817504c413bb39379eb0ad972">ba</a>)</div>
<div class="line"><span class="lineno">  378</span>        <span class="keywordflow">return</span> kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a435cd00162dc3faa5ab5ee6a32defda4">addr</a>.<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a6ef22d1817504c413bb39379eb0ad972">ba</a> + kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a435cd00162dc3faa5ab5ee6a32defda4">addr</a>.<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">alignment_offset</a>;</div>
<div class="line"><span class="lineno">  379</span> </div>
<div class="line"><span class="lineno">  380</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  381</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__kmem__buffer__t.html#a435cd00162dc3faa5ab5ee6a32defda4">pcilib_kmem_buffer_t::addr</a>, <a class="el" href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">pcilib_kmem_addr_t::alignment_offset</a>, <a class="el" href="structpcilib__kmem__addr__t.html#a6ef22d1817504c413bb39379eb0ad972">pcilib_kmem_addr_t::ba</a>, and <a class="el" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">pcilib_kmem_list_s::buf</a>.</p>

</div>
</div>
<a id="a7bd7744b88e9683273772a7e08e276cc" name="a7bd7744b88e9683273772a7e08e276cc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7bd7744b88e9683273772a7e08e276cc">&#9670;&#160;</a></span>pcilib_kmem_get_block_ba()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uintptr_t pcilib_kmem_get_block_ba </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>block</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a bus address of the specified kernel memory buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">k</td><td>- kernel memory handle returned from <a class="el" href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e" title="This function either allocates new buffers in the kernel space or just re-uses existing buffers.">pcilib_alloc_kernel_memory()</a> call </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">block</td><td>- specifies the buffer within the kernel memory (buffers are numbered from 0) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- bus address or 0 if no bus mapping </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  393</span>                                                                                         {</div>
<div class="line"><span class="lineno">  394</span>    <a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a> *kbuf = (<a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a>*)k;</div>
<div class="line"><span class="lineno">  395</span> </div>
<div class="line"><span class="lineno">  396</span>    <span class="keywordflow">if</span> (kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[block].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a6ef22d1817504c413bb39379eb0ad972">ba</a>)</div>
<div class="line"><span class="lineno">  397</span>        <span class="keywordflow">return</span> kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[block].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a6ef22d1817504c413bb39379eb0ad972">ba</a> + kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[block].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">alignment_offset</a>;</div>
<div class="line"><span class="lineno">  398</span> </div>
<div class="line"><span class="lineno">  399</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  400</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">pcilib_kmem_addr_t::alignment_offset</a>, <a class="el" href="structpcilib__kmem__addr__t.html#a6ef22d1817504c413bb39379eb0ad972">pcilib_kmem_addr_t::ba</a>, <a class="el" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">pcilib_kmem_buffer_t::blocks</a>, and <a class="el" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">pcilib_kmem_list_s::buf</a>.</p>

</div>
</div>
<a id="a4762c546213be7a0b7924bf542e1033e" name="a4762c546213be7a0b7924bf542e1033e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4762c546213be7a0b7924bf542e1033e">&#9670;&#160;</a></span>pcilib_kmem_get_block_pa()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uintptr_t pcilib_kmem_get_block_pa </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>block</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a physical address of the specified kernel memory buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">k</td><td>- kernel memory handle returned from <a class="el" href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e" title="This function either allocates new buffers in the kernel space or just re-uses existing buffers.">pcilib_alloc_kernel_memory()</a> call </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">block</td><td>- specifies the buffer within the kernel memory (buffers are numbered from 0) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- physical address </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  388</span>                                                                                         {</div>
<div class="line"><span class="lineno">  389</span>    <a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a> *kbuf = (<a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a>*)k;</div>
<div class="line"><span class="lineno">  390</span>    <span class="keywordflow">return</span> kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[block].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a0b65654ea7f40cc8f77ada141e9b80c3">pa</a> + kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[block].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">alignment_offset</a>;</div>
<div class="line"><span class="lineno">  391</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">pcilib_kmem_addr_t::alignment_offset</a>, <a class="el" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">pcilib_kmem_buffer_t::blocks</a>, <a class="el" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">pcilib_kmem_list_s::buf</a>, and <a class="el" href="structpcilib__kmem__addr__t.html#a0b65654ea7f40cc8f77ada141e9b80c3">pcilib_kmem_addr_t::pa</a>.</p>

</div>
</div>
<a id="aed04929b8d305b5dcb32243a608c7226" name="aed04929b8d305b5dcb32243a608c7226"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aed04929b8d305b5dcb32243a608c7226">&#9670;&#160;</a></span>pcilib_kmem_get_block_size()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t pcilib_kmem_get_block_size </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>block</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get size of the specified kernel memory buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">k</td><td>- kernel memory handle returned from <a class="el" href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e" title="This function either allocates new buffers in the kernel space or just re-uses existing buffers.">pcilib_alloc_kernel_memory()</a> call </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">block</td><td>- specifies the buffer within the kernel memory (buffers are numbered from 0) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- size in bytes </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  402</span>                                                                                        {</div>
<div class="line"><span class="lineno">  403</span>    <a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a> *kbuf = (<a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a>*)k;</div>
<div class="line"><span class="lineno">  404</span>    <span class="keywordflow">return</span> kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[block].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a9ec9640dd3bf2ffa15728ad7029919cf">size</a>;</div>
<div class="line"><span class="lineno">  405</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">pcilib_kmem_buffer_t::blocks</a>, <a class="el" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">pcilib_kmem_list_s::buf</a>, and <a class="el" href="structpcilib__kmem__addr__t.html#a9ec9640dd3bf2ffa15728ad7029919cf">pcilib_kmem_addr_t::size</a>.</p>

</div>
</div>
<a id="aee9f4941b33c0ae87675bffd02a48664" name="aee9f4941b33c0ae87675bffd02a48664"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aee9f4941b33c0ae87675bffd02a48664">&#9670;&#160;</a></span>pcilib_kmem_get_block_ua()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile void * pcilib_kmem_get_block_ua </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>block</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a valid pointer on the user-space mapping of the specified kernel memory buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">k</td><td>- kernel memory handle returned from <a class="el" href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e" title="This function either allocates new buffers in the kernel space or just re-uses existing buffers.">pcilib_alloc_kernel_memory()</a> call </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">block</td><td>- specifies the buffer within the kernel memory (buffers are numbered from 0) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- user-space pointer </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  383</span>                                                                                              {</div>
<div class="line"><span class="lineno">  384</span>    <a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a> *kbuf = (<a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a>*)k;</div>
<div class="line"><span class="lineno">  385</span>    <span class="keywordflow">return</span> kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[block].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#adf614dbac3f524456ea56dec3efad01a">ua</a> + kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[block].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">alignment_offset</a> + kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[block].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a292f3bd8fa805e91ab6704969c0be8d3">mmap_offset</a>;</div>
<div class="line"><span class="lineno">  386</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">pcilib_kmem_addr_t::alignment_offset</a>, <a class="el" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">pcilib_kmem_buffer_t::blocks</a>, <a class="el" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">pcilib_kmem_list_s::buf</a>, <a class="el" href="structpcilib__kmem__addr__t.html#a292f3bd8fa805e91ab6704969c0be8d3">pcilib_kmem_addr_t::mmap_offset</a>, and <a class="el" href="structpcilib__kmem__addr__t.html#adf614dbac3f524456ea56dec3efad01a">pcilib_kmem_addr_t::ua</a>.</p>

<p class="reference">Referenced by <a class="el" href="locking_8c.html#ac379ebe1382f4517496a6da8ca2b0839">pcilib_destroy_all_locks()</a>, <a class="el" href="locking_8c.html#aa761ea9d8c20584689cd2659ba4429f9">pcilib_get_lock_by_id()</a>, and <a class="el" href="locking_8c.html#af688eeaa5170de223b3af7e4e7c211e0">pcilib_init_locking()</a>.</p>

</div>
</div>
<a id="aa4d5af7eae82f2ceb5e9e5d2d52e399a" name="aa4d5af7eae82f2ceb5e9e5d2d52e399a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa4d5af7eae82f2ceb5e9e5d2d52e399a">&#9670;&#160;</a></span>pcilib_kmem_get_pa()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uintptr_t pcilib_kmem_get_pa </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *&#160;</td>
          <td class="paramname"><em>k</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a physical address of a single-buffer kernel memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">k</td><td>- kernel memory handle returned from <a class="el" href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e" title="This function either allocates new buffers in the kernel space or just re-uses existing buffers.">pcilib_alloc_kernel_memory()</a> call </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- physical address </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  369</span>                                                                     {</div>
<div class="line"><span class="lineno">  370</span>    <a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a> *kbuf = (<a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a>*)k;</div>
<div class="line"><span class="lineno">  371</span>    <span class="keywordflow">return</span> kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a435cd00162dc3faa5ab5ee6a32defda4">addr</a>.<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a0b65654ea7f40cc8f77ada141e9b80c3">pa</a> + kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a435cd00162dc3faa5ab5ee6a32defda4">addr</a>.<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">alignment_offset</a>;</div>
<div class="line"><span class="lineno">  372</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__kmem__buffer__t.html#a435cd00162dc3faa5ab5ee6a32defda4">pcilib_kmem_buffer_t::addr</a>, <a class="el" href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">pcilib_kmem_addr_t::alignment_offset</a>, <a class="el" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">pcilib_kmem_list_s::buf</a>, and <a class="el" href="structpcilib__kmem__addr__t.html#a0b65654ea7f40cc8f77ada141e9b80c3">pcilib_kmem_addr_t::pa</a>.</p>

</div>
</div>
<a id="a860cda7556a29ee3dec28af72581f148" name="a860cda7556a29ee3dec28af72581f148"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a860cda7556a29ee3dec28af72581f148">&#9670;&#160;</a></span>pcilib_kmem_get_ua()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">volatile void * pcilib_kmem_get_ua </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *&#160;</td>
          <td class="paramname"><em>k</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get a valid pointer on the user-space mapping of a single-buffer kernel memory. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">k</td><td>- kernel memory handle returned from <a class="el" href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e" title="This function either allocates new buffers in the kernel space or just re-uses existing buffers.">pcilib_alloc_kernel_memory()</a> call </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- user-space pointer </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  364</span>                                                                          {</div>
<div class="line"><span class="lineno">  365</span>    <a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a> *kbuf = (<a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a>*)k;</div>
<div class="line"><span class="lineno">  366</span>    <span class="keywordflow">return</span> kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a435cd00162dc3faa5ab5ee6a32defda4">addr</a>.<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#adf614dbac3f524456ea56dec3efad01a">ua</a> + kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a435cd00162dc3faa5ab5ee6a32defda4">addr</a>.<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">alignment_offset</a> + kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a435cd00162dc3faa5ab5ee6a32defda4">addr</a>.<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a292f3bd8fa805e91ab6704969c0be8d3">mmap_offset</a>;</div>
<div class="line"><span class="lineno">  367</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__kmem__buffer__t.html#a435cd00162dc3faa5ab5ee6a32defda4">pcilib_kmem_buffer_t::addr</a>, <a class="el" href="structpcilib__kmem__addr__t.html#a6a326278778d23dd307ddf18f5923c2d">pcilib_kmem_addr_t::alignment_offset</a>, <a class="el" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">pcilib_kmem_list_s::buf</a>, <a class="el" href="structpcilib__kmem__addr__t.html#a292f3bd8fa805e91ab6704969c0be8d3">pcilib_kmem_addr_t::mmap_offset</a>, and <a class="el" href="structpcilib__kmem__addr__t.html#adf614dbac3f524456ea56dec3efad01a">pcilib_kmem_addr_t::ua</a>.</p>

</div>
</div>
<a id="ac2a3c0d541ee9e45f53ea48904fac65d" name="ac2a3c0d541ee9e45f53ea48904fac65d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac2a3c0d541ee9e45f53ea48904fac65d">&#9670;&#160;</a></span>pcilib_kmem_is_reused()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="kmem_8h.html#ad9593c5ba7752ae78acd1e3164d38d48">pcilib_kmem_reuse_state_t</a> pcilib_kmem_is_reused </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *&#160;</td>
          <td class="paramname"><em>k</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reports if the kernel memory was reused fully, partially, or allocated completely anew. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">k</td><td>- kernel memory handle returned from <a class="el" href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e" title="This function either allocates new buffers in the kernel space or just re-uses existing buffers.">pcilib_alloc_kernel_memory()</a> call </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- re-use information </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  407</span>                                                                                         {</div>
<div class="line"><span class="lineno">  408</span>    <a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a> *kbuf = (<a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a>*)k;</div>
<div class="line"><span class="lineno">  409</span>    <span class="keywordflow">return</span> kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a98b6173c71e7dbaf3dfdbd2504941251">reused</a>;</div>
<div class="line"><span class="lineno">  410</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">pcilib_kmem_list_s::buf</a>, and <a class="el" href="structpcilib__kmem__buffer__t.html#a98b6173c71e7dbaf3dfdbd2504941251">pcilib_kmem_buffer_t::reused</a>.</p>

<p class="reference">Referenced by <a class="el" href="locking_8c.html#ac379ebe1382f4517496a6da8ca2b0839">pcilib_destroy_all_locks()</a>, and <a class="el" href="locking_8c.html#af688eeaa5170de223b3af7e4e7c211e0">pcilib_init_locking()</a>.</p>

</div>
</div>
<a id="a3ceab049700c01499673f4a9123101b4" name="a3ceab049700c01499673f4a9123101b4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ceab049700c01499673f4a9123101b4">&#9670;&#160;</a></span>pcilib_kmem_sync_block()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int pcilib_kmem_sync_block </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a51f63ba035402ca9a2ddd1b11152d7f5">pcilib_t</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a45758f64a23ffbaa50a83e41b3342780">pcilib_kmem_handle_t</a> *&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="kmem_8h.html#a565630a72af55e4cce61925d417dd644">pcilib_kmem_sync_direction_t</a>&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>block</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Synchronizes usage of the specified buffer between hardware and the system. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">ctx</td><td>- pcilib context </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">k</td><td>- kernel memory handle returned from <a class="el" href="kmem_8h.html#ac6559934a4616cbb9125caf2c1f8908e" title="This function either allocates new buffers in the kernel space or just re-uses existing buffers.">pcilib_alloc_kernel_memory()</a> call </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">dir</td><td>- synchronization direction (allows either device or system access) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">block</td><td>- specifies the buffer within the kernel memory (buffers are numbered from 0) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- error or 0 on success </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  337</span>                                                                                                                   {</div>
<div class="line"><span class="lineno">  338</span>    <span class="keywordtype">int</span> ret;</div>
<div class="line"><span class="lineno">  339</span>    kmem_sync_t ks;</div>
<div class="line"><span class="lineno">  340</span>    <a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a> *kbuf = (<a class="code hl_struct" href="structpcilib__kmem__list__s.html">pcilib_kmem_list_t</a>*)k;</div>
<div class="line"><span class="lineno">  341</span> </div>
<div class="line"><span class="lineno">  342</span>    <span class="keywordflow">switch</span> (kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a4b933f74483b36e93a602fb37f99b62a">type</a>) {</div>
<div class="line"><span class="lineno">  343</span>      <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66aaf1e868d635e1a2391b6a95fcc0487e9">PCILIB_KMEM_TYPE_DMA_S2C_PAGE</a>:</div>
<div class="line"><span class="lineno">  344</span>      <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a2dce4064644436c3fbacb4e6f528a164">PCILIB_KMEM_TYPE_DMA_C2S_PAGE</a>:</div>
<div class="line"><span class="lineno">  345</span>      <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a9848db80fded8e8f65817e893d629353">PCILIB_KMEM_TYPE_REGION_S2C</a>:</div>
<div class="line"><span class="lineno">  346</span>      <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66af0e713201866ba74693dbd47260b27ee">PCILIB_KMEM_TYPE_REGION_C2S</a>:</div>
<div class="line"><span class="lineno">  347</span>        ks.dir = dir;</div>
<div class="line"><span class="lineno">  348</span>        ks.handle.handle_id = kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[block].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#af01a6dc26454d7600edd4b330ef59544">handle_id</a>;</div>
<div class="line"><span class="lineno">  349</span>        ks.handle.pa = kbuf-&gt;<a class="code hl_variable" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">buf</a>.<a class="code hl_variable" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">blocks</a>[block].<a class="code hl_variable" href="structpcilib__kmem__addr__t.html#a0b65654ea7f40cc8f77ada141e9b80c3">pa</a>;</div>
<div class="line"><span class="lineno">  350</span>        </div>
<div class="line"><span class="lineno">  351</span>        ret = ioctl(ctx-&gt;<a class="code hl_variable" href="structpcilib__s.html#a97959ae9b1ab77309f0afec2b62d283c">handle</a>, PCIDRIVER_IOC_KMEM_SYNC, &amp;ks);</div>
<div class="line"><span class="lineno">  352</span>        <span class="keywordflow">if</span> (ret) {</div>
<div class="line"><span class="lineno">  353</span>            <a class="code hl_define" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>(<span class="stringliteral">&quot;PCIDRIVER_IOC_KMEM_SYNC ioctl have failed&quot;</span>);</div>
<div class="line"><span class="lineno">  354</span>            <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca8a1b45502224b7b2659e0014d9acf50c">PCILIB_ERROR_FAILED</a>;</div>
<div class="line"><span class="lineno">  355</span>        }</div>
<div class="line"><span class="lineno">  356</span>        <span class="keywordflow">break</span>;</div>
<div class="line"><span class="lineno">  357</span>      <span class="keywordflow">default</span>:</div>
<div class="line"><span class="lineno">  358</span>        ;</div>
<div class="line"><span class="lineno">  359</span>    }</div>
<div class="line"><span class="lineno">  360</span> </div>
<div class="line"><span class="lineno">  361</span>    <span class="keywordflow">return</span> 0;</div>
<div class="line"><span class="lineno">  362</span>}</div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="structpcilib__kmem__buffer__t.html#a91866edde1d045905724f0e28259bc86">pcilib_kmem_buffer_t::blocks</a>, <a class="el" href="structpcilib__kmem__list__s.html#adc2db171070bd735819d9e6027a1d19d">pcilib_kmem_list_s::buf</a>, <a class="el" href="structpcilib__s.html#a97959ae9b1ab77309f0afec2b62d283c">pcilib_s::handle</a>, <a class="el" href="structpcilib__kmem__addr__t.html#af01a6dc26454d7600edd4b330ef59544">pcilib_kmem_addr_t::handle_id</a>, <a class="el" href="structpcilib__kmem__addr__t.html#a0b65654ea7f40cc8f77ada141e9b80c3">pcilib_kmem_addr_t::pa</a>, <a class="el" href="error_8h.html#a2b06064fecffd095efabb752f7b50021">pcilib_error</a>, <a class="el" href="error_8h.html#a0c59f7091fd2446121868635aca9e60ca8a1b45502224b7b2659e0014d9acf50c">PCILIB_ERROR_FAILED</a>, <a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a2dce4064644436c3fbacb4e6f528a164">PCILIB_KMEM_TYPE_DMA_C2S_PAGE</a>, <a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66aaf1e868d635e1a2391b6a95fcc0487e9">PCILIB_KMEM_TYPE_DMA_S2C_PAGE</a>, <a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66af0e713201866ba74693dbd47260b27ee">PCILIB_KMEM_TYPE_REGION_C2S</a>, <a class="el" href="kmem_8h.html#a0026872c63f522459ae8510c9653ba66a9848db80fded8e8f65817e893d629353">PCILIB_KMEM_TYPE_REGION_S2C</a>, and <a class="el" href="structpcilib__kmem__buffer__t.html#a4b933f74483b36e93a602fb37f99b62a">pcilib_kmem_buffer_t::type</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 18 2024 22:02:47 for pcilib by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
