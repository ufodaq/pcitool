<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>pcilib: pagecpy.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">pcilib
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0b5c8f32f3013e7b96dc99509907414c.html">pcilib</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">pagecpy.c File Reference</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;string.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;assert.h&gt;</code><br />
<code>#include &lt;ctype.h&gt;</code><br />
<code>#include &lt;time.h&gt;</code><br />
<code>#include &lt;sched.h&gt;</code><br />
<code>#include &lt;arpa/inet.h&gt;</code><br />
<code>#include &lt;sys/time.h&gt;</code><br />
<code>#include &quot;<a class="el" href="cpu_8h_source.html">cpu.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="pci_8h_source.html">pci.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="tools_8h_source.html">tools.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="error_8h_source.html">error.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a3024ccd4a9af5109d24e6c57565d74a1"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pagecpy_8c.html#a3024ccd4a9af5109d24e6c57565d74a1">_POSIX_C_SOURCE</a>&#160;&#160;&#160;200112L</td></tr>
<tr class="separator:a3024ccd4a9af5109d24e6c57565d74a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a369266c24eacffb87046522897a570d5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pagecpy_8c.html#a369266c24eacffb87046522897a570d5">_GNU_SOURCE</a></td></tr>
<tr class="separator:a369266c24eacffb87046522897a570d5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a5cf01a58160461a141d8aa002804281a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pagecpy_8c.html#a5cf01a58160461a141d8aa002804281a">pcilib_memcpy4k_avx</a> (void *dst, const void *src, size_t size)</td></tr>
<tr class="separator:a5cf01a58160461a141d8aa002804281a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ef302ce8ac57e78f6dc788bf35c21a3"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pagecpy_8c.html#a8ef302ce8ac57e78f6dc788bf35c21a3">pcilib_pagecpy</a> (void *dst, const void *src, size_t size)</td></tr>
<tr class="memdesc:a8ef302ce8ac57e78f6dc788bf35c21a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function should be used to move large blocks of non-cached memory between aligned memory locations.  <a href="pagecpy_8c.html#a8ef302ce8ac57e78f6dc788bf35c21a3">More...</a><br /></td></tr>
<tr class="separator:a8ef302ce8ac57e78f6dc788bf35c21a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a369266c24eacffb87046522897a570d5" name="a369266c24eacffb87046522897a570d5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a369266c24eacffb87046522897a570d5">&#9670;&#160;</a></span>_GNU_SOURCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _GNU_SOURCE</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a3024ccd4a9af5109d24e6c57565d74a1" name="a3024ccd4a9af5109d24e6c57565d74a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3024ccd4a9af5109d24e6c57565d74a1">&#9670;&#160;</a></span>_POSIX_C_SOURCE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _POSIX_C_SOURCE&#160;&#160;&#160;200112L</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a5cf01a58160461a141d8aa002804281a" name="a5cf01a58160461a141d8aa002804281a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5cf01a58160461a141d8aa002804281a">&#9670;&#160;</a></span>pcilib_memcpy4k_avx()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pcilib_memcpy4k_avx </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="fragment"><div class="line"><span class="lineno">   90</span>                                                                  {</div>
<div class="line"><span class="lineno">   91</span>    <span class="keywordtype">size_t</span> sse_size = (size / 512);</div>
<div class="line"><span class="lineno">   92</span> </div>
<div class="line"><span class="lineno">   93</span>    __asm__ __volatile__ (</div>
<div class="line"><span class="lineno">   94</span>            <span class="stringliteral">&quot;push       %2                      \n\t&quot;</span></div>
<div class="line"><span class="lineno">   95</span>            <span class="stringliteral">&quot;mov        $0, %%rax               \n\t&quot;</span></div>
<div class="line"><span class="lineno">   96</span> </div>
<div class="line"><span class="lineno">   97</span>            <span class="stringliteral">&quot;1:                                 \n\t&quot;</span></div>
<div class="line"><span class="lineno">   98</span> </div>
<div class="line"><span class="lineno">   99</span>            <span class="stringliteral">&quot;vmovdqa       (%1,%%rax), %%ymm0   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  100</span>            <span class="stringliteral">&quot;vmovdqa     32(%1,%%rax), %%ymm1   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  101</span>            <span class="stringliteral">&quot;vmovdqa     64(%1,%%rax), %%ymm2   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  102</span>            <span class="stringliteral">&quot;vmovdqa     96(%1,%%rax), %%ymm3   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  103</span>            <span class="stringliteral">&quot;vmovdqa    128(%1,%%rax), %%ymm4   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  104</span>            <span class="stringliteral">&quot;vmovdqa    160(%1,%%rax), %%ymm5   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  105</span>            <span class="stringliteral">&quot;vmovdqa    192(%1,%%rax), %%ymm6   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  106</span>            <span class="stringliteral">&quot;vmovdqa    224(%1,%%rax), %%ymm7   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  107</span> </div>
<div class="line"><span class="lineno">  108</span>            <span class="stringliteral">&quot;vmovdqa    256(%1,%%rax), %%ymm8   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  109</span>            <span class="stringliteral">&quot;vmovdqa    288(%1,%%rax), %%ymm9   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  110</span>            <span class="stringliteral">&quot;vmovdqa    320(%1,%%rax), %%ymm10  \n\t&quot;</span></div>
<div class="line"><span class="lineno">  111</span>            <span class="stringliteral">&quot;vmovdqa    352(%1,%%rax), %%ymm11  \n\t&quot;</span></div>
<div class="line"><span class="lineno">  112</span>            <span class="stringliteral">&quot;vmovdqa    384(%1,%%rax), %%ymm12  \n\t&quot;</span></div>
<div class="line"><span class="lineno">  113</span>            <span class="stringliteral">&quot;vmovdqa    416(%1,%%rax), %%ymm13  \n\t&quot;</span></div>
<div class="line"><span class="lineno">  114</span>            <span class="stringliteral">&quot;vmovdqa    448(%1,%%rax), %%ymm14  \n\t&quot;</span></div>
<div class="line"><span class="lineno">  115</span>            <span class="stringliteral">&quot;vmovdqa    480(%1,%%rax), %%ymm15  \n\t&quot;</span></div>
<div class="line"><span class="lineno">  116</span> </div>
<div class="line"><span class="lineno">  117</span>            <span class="stringliteral">&quot;vmovdqa    %%ymm0,    (%0,%%rax)   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  118</span>            <span class="stringliteral">&quot;vmovdqa    %%ymm1,  32(%0,%%rax)   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  119</span>            <span class="stringliteral">&quot;vmovntps   %%ymm2,  64(%0,%%rax)   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  120</span>            <span class="stringliteral">&quot;vmovntps   %%ymm3,  96(%0,%%rax)   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  121</span>            <span class="stringliteral">&quot;vmovntps   %%ymm4, 128(%0,%%rax)   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  122</span>            <span class="stringliteral">&quot;vmovntps   %%ymm5, 160(%0,%%rax)   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  123</span>            <span class="stringliteral">&quot;vmovntps   %%ymm6, 192(%0,%%rax)   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  124</span>            <span class="stringliteral">&quot;vmovntps   %%ymm7, 224(%0,%%rax)   \n\t&quot;</span></div>
<div class="line"><span class="lineno">  125</span> </div>
<div class="line"><span class="lineno">  126</span>            <span class="stringliteral">&quot;vmovntps   %%ymm8,  256(%0,%%rax)  \n\t&quot;</span></div>
<div class="line"><span class="lineno">  127</span>            <span class="stringliteral">&quot;vmovntps   %%ymm9,  288(%0,%%rax)  \n\t&quot;</span></div>
<div class="line"><span class="lineno">  128</span>            <span class="stringliteral">&quot;vmovntps   %%ymm10, 320(%0,%%rax)  \n\t&quot;</span></div>
<div class="line"><span class="lineno">  129</span>            <span class="stringliteral">&quot;vmovntps   %%ymm11, 352(%0,%%rax)  \n\t&quot;</span></div>
<div class="line"><span class="lineno">  130</span>            <span class="stringliteral">&quot;vmovntps   %%ymm12, 384(%0,%%rax)  \n\t&quot;</span></div>
<div class="line"><span class="lineno">  131</span>            <span class="stringliteral">&quot;vmovntps   %%ymm13, 416(%0,%%rax)  \n\t&quot;</span></div>
<div class="line"><span class="lineno">  132</span>            <span class="stringliteral">&quot;vmovntps   %%ymm14, 448(%0,%%rax)  \n\t&quot;</span></div>
<div class="line"><span class="lineno">  133</span>            <span class="stringliteral">&quot;vmovntps   %%ymm15, 480(%0,%%rax)  \n\t&quot;</span></div>
<div class="line"><span class="lineno">  134</span> </div>
<div class="line"><span class="lineno">  135</span>            <span class="stringliteral">&quot;add        $512, %%rax             \n\t&quot;</span></div>
<div class="line"><span class="lineno">  136</span>            <span class="stringliteral">&quot;dec        %2                      \n\t&quot;</span></div>
<div class="line"><span class="lineno">  137</span>            <span class="stringliteral">&quot;jnz        1b                      \n\t&quot;</span></div>
<div class="line"><span class="lineno">  138</span>            <span class="stringliteral">&quot;pop        %2                      \n\t&quot;</span></div>
<div class="line"><span class="lineno">  139</span> </div>
<div class="line"><span class="lineno">  140</span>            <span class="stringliteral">&quot;mfence&quot;</span></div>
<div class="line"><span class="lineno">  141</span>    :</div>
<div class="line"><span class="lineno">  142</span>    : <span class="stringliteral">&quot;p&quot;</span> (dst), <span class="stringliteral">&quot;p&quot;</span> (src), <span class="stringliteral">&quot;r&quot;</span> (sse_size)</div>
<div class="line"><span class="lineno">  143</span>    : <span class="stringliteral">&quot;%rax&quot;</span></div>
<div class="line"><span class="lineno">  144</span>        );</div>
<div class="line"><span class="lineno">  145</span>}</div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="pagecpy_8c.html#a8ef302ce8ac57e78f6dc788bf35c21a3">pcilib_pagecpy()</a>.</p>

</div>
</div>
<a id="a8ef302ce8ac57e78f6dc788bf35c21a3" name="a8ef302ce8ac57e78f6dc788bf35c21a3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ef302ce8ac57e78f6dc788bf35c21a3">&#9670;&#160;</a></span>pcilib_pagecpy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void pcilib_pagecpy </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>dst</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const void *&#160;</td>
          <td class="paramname"><em>src</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function should be used to move large blocks of non-cached memory between aligned memory locations. </p>
<p >The function will determine the CPU model and alginment and call appropriate implementation. If nothing suitable found, standard memcpy will be used. It is OK to call on small or unligned data, the standard memcpy will be executed in this case. The memory regions should not intersect. Only AVX implementation so far. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">dst</td><td>- destination memory region </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">src</td><td>- source memory region </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>- size of memory region in bytes. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- <code>dst</code> or NULL on error </dd></dl>
<div class="fragment"><div class="line"><span class="lineno">  147</span>                                                             {</div>
<div class="line"><span class="lineno">  148</span>    <span class="keywordtype">int</span> gen = <a class="code hl_function" href="cpu_8c.html#a4b831d1623083bae186eca63e369027f">pcilib_get_cpu_gen</a>();</div>
<div class="line"><span class="lineno">  149</span>    <span class="keywordflow">if</span> ((gen &gt; 3)&amp;&amp;((size%4096)==0)&amp;&amp;(((uintptr_t)dst%32)==0)&amp;&amp;(((uintptr_t)src%32)==0)) {</div>
<div class="line"><span class="lineno">  150</span>        <a class="code hl_function" href="pagecpy_8c.html#a5cf01a58160461a141d8aa002804281a">pcilib_memcpy4k_avx</a>(dst, src, size);</div>
<div class="line"><span class="lineno">  151</span>    } <span class="keywordflow">else</span></div>
<div class="line"><span class="lineno">  152</span>        memcpy(dst, src, size);</div>
<div class="line"><span class="lineno">  153</span>}</div>
<div class="ttc" id="acpu_8c_html_a4b831d1623083bae186eca63e369027f"><div class="ttname"><a href="cpu_8c.html#a4b831d1623083bae186eca63e369027f">pcilib_get_cpu_gen</a></div><div class="ttdeci">int pcilib_get_cpu_gen()</div><div class="ttdoc">Returns the generation of Intel Core architecture Processors up to Intel Core gen4 are recognized.</div><div class="ttdef"><b>Definition:</b> cpu.c:74</div></div>
<div class="ttc" id="apagecpy_8c_html_a5cf01a58160461a141d8aa002804281a"><div class="ttname"><a href="pagecpy_8c.html#a5cf01a58160461a141d8aa002804281a">pcilib_memcpy4k_avx</a></div><div class="ttdeci">void pcilib_memcpy4k_avx(void *dst, const void *src, size_t size)</div><div class="ttdef"><b>Definition:</b> pagecpy.c:90</div></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="cpu_8c.html#a4b831d1623083bae186eca63e369027f">pcilib_get_cpu_gen()</a>, and <a class="el" href="pagecpy_8c.html#a5cf01a58160461a141d8aa002804281a">pcilib_memcpy4k_avx()</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 18 2024 22:02:48 for pcilib by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
